var z1=Object.create;var{defineProperty:l0,getPrototypeOf:D1,getOwnPropertyNames:L1}=Object;var k1=Object.prototype.hasOwnProperty;var E1=($,Z,J)=>{J=$!=null?z1(D1($)):{};const W=Z||!$||!$.__esModule?l0(J,"default",{value:$,enumerable:!0}):J;for(let U of L1($))if(!k1.call(W,U))l0(W,U,{get:()=>$[U],enumerable:!0});return W};var A=($,Z)=>()=>(Z||$((Z={exports:{}}).exports,Z),Z.exports);var e=A((p0)=>{var x1=function($){const Z=$.length;let J=0,W=0;while(W<Z){let U=$.charCodeAt(W++);if((U&4294967168)===0){J++;continue}else if((U&4294965248)===0)J+=2;else{if(U>=55296&&U<=56319){if(W<Z){const X=$.charCodeAt(W);if((X&64512)===56320)++W,U=((U&1023)<<10)+(X&1023)+65536}}if((U&4294901760)===0)J+=3;else J+=4}}return J},u0=function($,Z,J){const W=$.length;let U=J,X=0;while(X<W){let F=$.charCodeAt(X++);if((F&4294967168)===0){Z[U++]=F;continue}else if((F&4294965248)===0)Z[U++]=F>>6&31|192;else{if(F>=55296&&F<=56319){if(X<W){const Q=$.charCodeAt(X);if((Q&64512)===56320)++X,F=((F&1023)<<10)+(Q&1023)+65536}}if((F&4294901760)===0)Z[U++]=F>>12&15|224,Z[U++]=F>>6&63|128;else Z[U++]=F>>18&7|240,Z[U++]=F>>12&63|128,Z[U++]=F>>6&63|128}Z[U++]=F&63|128}},d0=function($,Z,J){j1.encodeInto($,Z.subarray(J))},g1=function($,Z,J){if($.length>_1)d0($,Z,J);else u0($,Z,J)},c0=function($,Z,J){let W=Z;const U=W+J,X=[];let F="";while(W<U){const Q=$[W++];if((Q&128)===0)X.push(Q);else if((Q&224)===192){const V=$[W++]&63;X.push((Q&31)<<6|V)}else if((Q&240)===224){const V=$[W++]&63,N=$[W++]&63;X.push((Q&31)<<12|V<<6|N)}else if((Q&248)===240){const V=$[W++]&63,N=$[W++]&63,K=$[W++]&63;let I=(Q&7)<<18|V<<12|N<<6|K;if(I>65535)I-=65536,X.push(I>>>10&1023|55296),I=56320|I&1023;X.push(I)}else X.push(Q);if(X.length>=y1)F+=String.fromCharCode(...X),X.length=0}if(X.length>0)F+=String.fromCharCode(...X);return F},a0=function($,Z,J){const W=$.subarray(Z,Z+J);return v1.decode(W)},f1=function($,Z,J){if(J>h1)return a0($,Z,J);else return c0($,Z,J)};Object.defineProperty(p0,"__esModule",{value:!0});p0.utf8Decode=p0.utf8DecodeTD=p0.utf8DecodeJs=p0.utf8Encode=p0.utf8EncodeTE=p0.utf8EncodeJs=p0.utf8Count=void 0;p0.utf8Count=x1;p0.utf8EncodeJs=u0;var j1=new TextEncoder,_1=50;p0.utf8EncodeTE=d0;p0.utf8Encode=g1;var y1=4096;p0.utf8DecodeJs=c0;var v1=new TextDecoder,h1=200;p0.utf8DecodeTD=a0;p0.utf8Decode=f1});var w0=A((r0)=>{Object.defineProperty(r0,"__esModule",{value:!0});r0.ExtData=void 0;class n0{constructor($,Z){this.type=$,this.data=Z}}r0.ExtData=n0});var Z0=A((t0)=>{Object.defineProperty(t0,"__esModule",{value:!0});t0.DecodeError=void 0;class $0 extends Error{constructor($){super($);const Z=Object.create($0.prototype);Object.setPrototypeOf(this,Z),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:$0.name})}}t0.DecodeError=$0});var W0=A((e0)=>{var a1=function($,Z,J){const W=J/4294967296,U=J;$.setUint32(Z,W),$.setUint32(Z+4,U)},p1=function($,Z,J){const W=Math.floor(J/4294967296),U=J;$.setUint32(Z,W),$.setUint32(Z+4,U)},i1=function($,Z){const J=$.getInt32(Z),W=$.getUint32(Z+4);return J*4294967296+W},n1=function($,Z){const J=$.getUint32(Z),W=$.getUint32(Z+4);return J*4294967296+W};Object.defineProperty(e0,"__esModule",{value:!0});e0.getUint64=e0.getInt64=e0.setInt64=e0.setUint64=e0.UINT32_MAX=void 0;e0.UINT32_MAX=4294967295;e0.setUint64=a1;e0.setInt64=p1;e0.getInt64=i1;e0.getUint64=n1});var S0=A((Q8)=>{var W8=function({sec:$,nsec:Z}){if($>=0&&Z>=0&&$<=Z6)if(Z===0&&$<=$6){const J=new Uint8Array(4);return new DataView(J.buffer).setUint32(0,$),J}else{const J=$/4294967296,W=$&4294967295,U=new Uint8Array(8),X=new DataView(U.buffer);return X.setUint32(0,Z<<2|J&3),X.setUint32(4,W),U}else{const J=new Uint8Array(12),W=new DataView(J.buffer);return W.setUint32(0,Z),(0,Z8.setInt64)(W,4,$),J}},J8=function($){const Z=$.getTime(),J=Math.floor(Z/1000),W=(Z-J*1000)*1e6,U=Math.floor(W/1e9);return{sec:J+U,nsec:W-U*1e9}},U8=function($){if($ instanceof Date){const Z=J8($);return W8(Z)}else return null},X8=function($){const Z=new DataView($.buffer,$.byteOffset,$.byteLength);switch($.byteLength){case 4:return{sec:Z.getUint32(0),nsec:0};case 8:{const J=Z.getUint32(0),W=Z.getUint32(4),U=(J&3)*4294967296+W,X=J>>>2;return{sec:U,nsec:X}}case 12:{const J=(0,Z8.getInt64)(Z,4),W=Z.getUint32(0);return{sec:J,nsec:W}}default:throw new e1.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${$.length}`)}},F8=function($){const Z=X8($);return new Date(Z.sec*1000+Z.nsec/1e6)};Object.defineProperty(Q8,"__esModule",{value:!0});Q8.timestampExtension=Q8.decodeTimestampExtension=Q8.decodeTimestampToTimeSpec=Q8.encodeTimestampExtension=Q8.encodeDateToTimeSpec=Q8.encodeTimeSpecToTimestamp=Q8.EXT_TIMESTAMP=void 0;var e1=Z0(),Z8=W0();Q8.EXT_TIMESTAMP=-1;var $6=4294967295,Z6=17179869183;Q8.encodeTimeSpecToTimestamp=W8;Q8.encodeDateToTimeSpec=J8;Q8.encodeTimestampExtension=U8;Q8.decodeTimestampToTimeSpec=X8;Q8.decodeTimestampExtension=F8;Q8.timestampExtension={type:Q8.EXT_TIMESTAMP,encode:U8,decode:F8}});var X0=A((G8)=>{Object.defineProperty(G8,"__esModule",{value:!0});G8.ExtensionCodec=void 0;var J0=w0(),Q6=S0();class U0{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Q6.timestampExtension)}register({type:$,encode:Z,decode:J}){if($>=0)this.encoders[$]=Z,this.decoders[$]=J;else{const W=1+$;this.builtInEncoders[W]=Z,this.builtInDecoders[W]=J}}tryToEncode($,Z){for(let J=0;J<this.builtInEncoders.length;J++){const W=this.builtInEncoders[J];if(W!=null){const U=W($,Z);if(U!=null){const X=-1-J;return new J0.ExtData(X,U)}}}for(let J=0;J<this.encoders.length;J++){const W=this.encoders[J];if(W!=null){const U=W($,Z);if(U!=null){const X=J;return new J0.ExtData(X,U)}}}if($ instanceof J0.ExtData)return $;return null}decode($,Z,J){const W=Z<0?this.builtInDecoders[-1-Z]:this.decoders[Z];if(W)return W($,Z,J);else return new J0.ExtData(Z,$)}}U0.defaultCodec=new U0;G8.ExtensionCodec=U0});var O0=A((H8)=>{var I8=function($){if($ instanceof Uint8Array)return $;else if(ArrayBuffer.isView($))return new Uint8Array($.buffer,$.byteOffset,$.byteLength);else if($ instanceof ArrayBuffer)return new Uint8Array($);else return Uint8Array.from($)},V6=function($){if($ instanceof ArrayBuffer)return new DataView($);const Z=I8($);return new DataView(Z.buffer,Z.byteOffset,Z.byteLength)};Object.defineProperty(H8,"__esModule",{value:!0});H8.createDataView=H8.ensureUint8Array=void 0;H8.ensureUint8Array=I8;H8.createDataView=V6});var A0=A((w8)=>{Object.defineProperty(w8,"__esModule",{value:!0});w8.Encoder=w8.DEFAULT_INITIAL_BUFFER_SIZE=w8.DEFAULT_MAX_DEPTH=void 0;var K8=e(),G6=X0(),R8=W0(),Y6=O0();w8.DEFAULT_MAX_DEPTH=100;w8.DEFAULT_INITIAL_BUFFER_SIZE=2048;class P8{constructor($){var Z,J,W,U,X,F,Q,V;this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:G6.ExtensionCodec.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxDepth=(W=$===null||$===void 0?void 0:$.maxDepth)!==null&&W!==void 0?W:w8.DEFAULT_MAX_DEPTH,this.initialBufferSize=(U=$===null||$===void 0?void 0:$.initialBufferSize)!==null&&U!==void 0?U:w8.DEFAULT_INITIAL_BUFFER_SIZE,this.sortKeys=(X=$===null||$===void 0?void 0:$.sortKeys)!==null&&X!==void 0?X:!1,this.forceFloat32=(F=$===null||$===void 0?void 0:$.forceFloat32)!==null&&F!==void 0?F:!1,this.ignoreUndefined=(Q=$===null||$===void 0?void 0:$.ignoreUndefined)!==null&&Q!==void 0?Q:!1,this.forceIntegerToFloat=(V=$===null||$===void 0?void 0:$.forceIntegerToFloat)!==null&&V!==void 0?V:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef($){return this.reinitializeState(),this.doEncode($,1),this.bytes.subarray(0,this.pos)}encode($){return this.reinitializeState(),this.doEncode($,1),this.bytes.slice(0,this.pos)}doEncode($,Z){if(Z>this.maxDepth)throw new Error(`Too deep objects in depth ${Z}`);if($==null)this.encodeNil();else if(typeof $==="boolean")this.encodeBoolean($);else if(typeof $==="number")if(!this.forceIntegerToFloat)this.encodeNumber($);else this.encodeNumberAsFloat($);else if(typeof $==="string")this.encodeString($);else if(this.useBigInt64&&typeof $==="bigint")this.encodeBigInt64($);else this.encodeObject($,Z)}ensureBufferSizeToWrite($){const Z=this.pos+$;if(this.view.byteLength<Z)this.resizeBuffer(Z*2)}resizeBuffer($){const Z=new ArrayBuffer($),J=new Uint8Array(Z),W=new DataView(Z);J.set(this.bytes),this.view=W,this.bytes=J}encodeNil(){this.writeU8(192)}encodeBoolean($){if($===!1)this.writeU8(194);else this.writeU8(195)}encodeNumber($){if(!this.forceIntegerToFloat&&Number.isSafeInteger($))if($>=0)if($<128)this.writeU8($);else if($<256)this.writeU8(204),this.writeU8($);else if($<65536)this.writeU8(205),this.writeU16($);else if($<4294967296)this.writeU8(206),this.writeU32($);else if(!this.useBigInt64)this.writeU8(207),this.writeU64($);else this.encodeNumberAsFloat($);else if($>=-32)this.writeU8(224|$+32);else if($>=-128)this.writeU8(208),this.writeI8($);else if($>=-32768)this.writeU8(209),this.writeI16($);else if($>=-2147483648)this.writeU8(210),this.writeI32($);else if(!this.useBigInt64)this.writeU8(211),this.writeI64($);else this.encodeNumberAsFloat($);else this.encodeNumberAsFloat($)}encodeNumberAsFloat($){if(this.forceFloat32)this.writeU8(202),this.writeF32($);else this.writeU8(203),this.writeF64($)}encodeBigInt64($){if($>=BigInt(0))this.writeU8(207),this.writeBigUint64($);else this.writeU8(211),this.writeBigInt64($)}writeStringHeader($){if($<32)this.writeU8(160+$);else if($<256)this.writeU8(217),this.writeU8($);else if($<65536)this.writeU8(218),this.writeU16($);else if($<4294967296)this.writeU8(219),this.writeU32($);else throw new Error(`Too long string: ${$} bytes in UTF-8`)}encodeString($){const J=(0,K8.utf8Count)($);this.ensureBufferSizeToWrite(5+J),this.writeStringHeader(J),(0,K8.utf8Encode)($,this.bytes,this.pos),this.pos+=J}encodeObject($,Z){const J=this.extensionCodec.tryToEncode($,this.context);if(J!=null)this.encodeExtension(J);else if(Array.isArray($))this.encodeArray($,Z);else if(ArrayBuffer.isView($))this.encodeBinary($);else if(typeof $==="object")this.encodeMap($,Z);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply($)}`)}encodeBinary($){const Z=$.byteLength;if(Z<256)this.writeU8(196),this.writeU8(Z);else if(Z<65536)this.writeU8(197),this.writeU16(Z);else if(Z<4294967296)this.writeU8(198),this.writeU32(Z);else throw new Error(`Too large binary: ${Z}`);const J=(0,Y6.ensureUint8Array)($);this.writeU8a(J)}encodeArray($,Z){const J=$.length;if(J<16)this.writeU8(144+J);else if(J<65536)this.writeU8(220),this.writeU16(J);else if(J<4294967296)this.writeU8(221),this.writeU32(J);else throw new Error(`Too large array: ${J}`);for(let W of $)this.doEncode(W,Z+1)}countWithoutUndefined($,Z){let J=0;for(let W of Z)if($[W]!==void 0)J++;return J}encodeMap($,Z){const J=Object.keys($);if(this.sortKeys)J.sort();const W=this.ignoreUndefined?this.countWithoutUndefined($,J):J.length;if(W<16)this.writeU8(128+W);else if(W<65536)this.writeU8(222),this.writeU16(W);else if(W<4294967296)this.writeU8(223),this.writeU32(W);else throw new Error(`Too large map object: ${W}`);for(let U of J){const X=$[U];if(!(this.ignoreUndefined&&X===void 0))this.encodeString(U),this.doEncode(X,Z+1)}}encodeExtension($){const Z=$.data.length;if(Z===1)this.writeU8(212);else if(Z===2)this.writeU8(213);else if(Z===4)this.writeU8(214);else if(Z===8)this.writeU8(215);else if(Z===16)this.writeU8(216);else if(Z<256)this.writeU8(199),this.writeU8(Z);else if(Z<65536)this.writeU8(200),this.writeU16(Z);else if(Z<4294967296)this.writeU8(201),this.writeU32(Z);else throw new Error(`Too large extension object: ${Z}`);this.writeI8($.type),this.writeU8a($.data)}writeU8($){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,$),this.pos++}writeU8a($){const Z=$.length;this.ensureBufferSizeToWrite(Z),this.bytes.set($,this.pos),this.pos+=Z}writeI8($){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,$),this.pos++}writeU16($){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,$),this.pos+=2}writeI16($){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,$),this.pos+=2}writeU32($){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,$),this.pos+=4}writeI32($){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,$),this.pos+=4}writeF32($){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,$),this.pos+=4}writeF64($){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,$),this.pos+=8}writeU64($){this.ensureBufferSizeToWrite(8),(0,R8.setUint64)(this.view,this.pos,$),this.pos+=8}writeI64($){this.ensureBufferSizeToWrite(8),(0,R8.setInt64)(this.view,this.pos,$),this.pos+=8}writeBigUint64($){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,$),this.pos+=8}writeBigInt64($){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,$),this.pos+=8}}w8.Encoder=P8});var T8=A((q8)=>{var H6=function($,Z){return new I6.Encoder(Z).encodeSharedRef($)};Object.defineProperty(q8,"__esModule",{value:!0});q8.encode=q8.defaultEncodeOptions=void 0;var I6=A0();q8.defaultEncodeOptions=void 0;q8.encode=H6});var D8=A((C8)=>{var K6=function($){return`${$<0?"-":""}0x${Math.abs($).toString(16).padStart(2,"0")}`};Object.defineProperty(C8,"__esModule",{value:!0});C8.prettyByte=void 0;C8.prettyByte=K6});var x8=A((k8)=>{Object.defineProperty(k8,"__esModule",{value:!0});k8.CachedKeyDecoder=void 0;var R6=e(),P6=16,w6=16;class L8{constructor($=P6,Z=w6){this.maxKeyLength=$,this.maxLengthPerKey=Z,this.hit=0,this.miss=0,this.caches=[];for(let J=0;J<this.maxKeyLength;J++)this.caches.push([])}canBeCached($){return $>0&&$<=this.maxKeyLength}find($,Z,J){const W=this.caches[J-1];$:for(let U of W){const X=U.bytes;for(let F=0;F<J;F++)if(X[F]!==$[Z+F])continue $;return U.str}return null}store($,Z){const J=this.caches[$.length-1],W={bytes:$,str:Z};if(J.length>=this.maxLengthPerKey)J[Math.random()*J.length|0]=W;else J.push(W)}decode($,Z,J){const W=this.find($,Z,J);if(W!=null)return this.hit++,W;this.miss++;const U=(0,R6.utf8DecodeJs)($,Z,J),X=Uint8Array.prototype.slice.call($,Z,Z+J);return this.store(X,U),U}}k8.CachedKeyDecoder=L8});var V0=A((y8)=>{Object.defineProperty(y8,"__esModule",{value:!0});y8.Decoder=y8.DataViewIndexOutOfBoundsError=void 0;var q0=D8(),S6=X0(),v=W0(),O6=e(),B0=O0(),A6=x8(),E=Z0(),j8="array",F0="map_key",q6="map_value",B6=($)=>{return typeof $==="string"||typeof $==="number"},p=-1,T0=new DataView(new ArrayBuffer(0)),T6=new Uint8Array(T0.buffer);try{T0.getInt8(0)}catch($){if(!($ instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}y8.DataViewIndexOutOfBoundsError=RangeError;var _8=new y8.DataViewIndexOutOfBoundsError("Insufficient data"),C6=new A6.CachedKeyDecoder;class g8{constructor($){var Z,J,W,U,X,F,Q;this.totalPos=0,this.pos=0,this.view=T0,this.bytes=T6,this.headByte=p,this.stack=[],this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:S6.ExtensionCodec.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxStrLength=(W=$===null||$===void 0?void 0:$.maxStrLength)!==null&&W!==void 0?W:v.UINT32_MAX,this.maxBinLength=(U=$===null||$===void 0?void 0:$.maxBinLength)!==null&&U!==void 0?U:v.UINT32_MAX,this.maxArrayLength=(X=$===null||$===void 0?void 0:$.maxArrayLength)!==null&&X!==void 0?X:v.UINT32_MAX,this.maxMapLength=(F=$===null||$===void 0?void 0:$.maxMapLength)!==null&&F!==void 0?F:v.UINT32_MAX,this.maxExtLength=(Q=$===null||$===void 0?void 0:$.maxExtLength)!==null&&Q!==void 0?Q:v.UINT32_MAX,this.keyDecoder=($===null||$===void 0?void 0:$.keyDecoder)!==void 0?$.keyDecoder:C6}reinitializeState(){this.totalPos=0,this.headByte=p,this.stack.length=0}setBuffer($){this.bytes=(0,B0.ensureUint8Array)($),this.view=(0,B0.createDataView)(this.bytes),this.pos=0}appendBuffer($){if(this.headByte===p&&!this.hasRemaining(1))this.setBuffer($);else{const Z=this.bytes.subarray(this.pos),J=(0,B0.ensureUint8Array)($),W=new Uint8Array(Z.length+J.length);W.set(Z),W.set(J,Z.length),this.setBuffer(W)}}hasRemaining($){return this.view.byteLength-this.pos>=$}createExtraByteError($){const{view:Z,pos:J}=this;return new RangeError(`Extra ${Z.byteLength-J} of ${Z.byteLength} byte(s) found at buffer[${$}]`)}decode($){this.reinitializeState(),this.setBuffer($);const Z=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return Z}*decodeMulti($){this.reinitializeState(),this.setBuffer($);while(this.hasRemaining(1))yield this.doDecodeSync()}async decodeAsync($){let Z=!1,J;for await(let F of $){if(Z)throw this.createExtraByteError(this.totalPos);this.appendBuffer(F);try{J=this.doDecodeSync(),Z=!0}catch(Q){if(!(Q instanceof y8.DataViewIndexOutOfBoundsError))throw Q}this.totalPos+=this.pos}if(Z){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return J}const{headByte:W,pos:U,totalPos:X}=this;throw new RangeError(`Insufficient data in parsing ${(0,q0.prettyByte)(W)} at ${X} (${U} in the current buffer)`)}decodeArrayStream($){return this.decodeMultiAsync($,!0)}decodeStream($){return this.decodeMultiAsync($,!1)}async*decodeMultiAsync($,Z){let J=Z,W=-1;for await(let U of $){if(Z&&W===0)throw this.createExtraByteError(this.totalPos);if(this.appendBuffer(U),J)W=this.readArraySize(),J=!1,this.complete();try{while(!0)if(yield this.doDecodeSync(),--W===0)break}catch(X){if(!(X instanceof y8.DataViewIndexOutOfBoundsError))throw X}this.totalPos+=this.pos}}doDecodeSync(){$:while(!0){const $=this.readHeadByte();let Z;if($>=224)Z=$-256;else if($<192)if($<128)Z=$;else if($<144){const W=$-128;if(W!==0){this.pushMapState(W),this.complete();continue $}else Z={}}else if($<160){const W=$-144;if(W!==0){this.pushArrayState(W),this.complete();continue $}else Z=[]}else{const W=$-160;Z=this.decodeUtf8String(W,0)}else if($===192)Z=null;else if($===194)Z=!1;else if($===195)Z=!0;else if($===202)Z=this.readF32();else if($===203)Z=this.readF64();else if($===204)Z=this.readU8();else if($===205)Z=this.readU16();else if($===206)Z=this.readU32();else if($===207)if(this.useBigInt64)Z=this.readU64AsBigInt();else Z=this.readU64();else if($===208)Z=this.readI8();else if($===209)Z=this.readI16();else if($===210)Z=this.readI32();else if($===211)if(this.useBigInt64)Z=this.readI64AsBigInt();else Z=this.readI64();else if($===217){const W=this.lookU8();Z=this.decodeUtf8String(W,1)}else if($===218){const W=this.lookU16();Z=this.decodeUtf8String(W,2)}else if($===219){const W=this.lookU32();Z=this.decodeUtf8String(W,4)}else if($===220){const W=this.readU16();if(W!==0){this.pushArrayState(W),this.complete();continue $}else Z=[]}else if($===221){const W=this.readU32();if(W!==0){this.pushArrayState(W),this.complete();continue $}else Z=[]}else if($===222){const W=this.readU16();if(W!==0){this.pushMapState(W),this.complete();continue $}else Z={}}else if($===223){const W=this.readU32();if(W!==0){this.pushMapState(W),this.complete();continue $}else Z={}}else if($===196){const W=this.lookU8();Z=this.decodeBinary(W,1)}else if($===197){const W=this.lookU16();Z=this.decodeBinary(W,2)}else if($===198){const W=this.lookU32();Z=this.decodeBinary(W,4)}else if($===212)Z=this.decodeExtension(1,0);else if($===213)Z=this.decodeExtension(2,0);else if($===214)Z=this.decodeExtension(4,0);else if($===215)Z=this.decodeExtension(8,0);else if($===216)Z=this.decodeExtension(16,0);else if($===199){const W=this.lookU8();Z=this.decodeExtension(W,1)}else if($===200){const W=this.lookU16();Z=this.decodeExtension(W,2)}else if($===201){const W=this.lookU32();Z=this.decodeExtension(W,4)}else throw new E.DecodeError(`Unrecognized type byte: ${(0,q0.prettyByte)($)}`);this.complete();const J=this.stack;while(J.length>0){const W=J[J.length-1];if(W.type===j8)if(W.array[W.position]=Z,W.position++,W.position===W.size)J.pop(),Z=W.array;else continue $;else if(W.type===F0){if(!B6(Z))throw new E.DecodeError("The type of key must be string or number but "+typeof Z);if(Z==="__proto__")throw new E.DecodeError("The key __proto__ is not allowed");W.key=Z,W.type=q6;continue $}else if(W.map[W.key]=Z,W.readCount++,W.readCount===W.size)J.pop(),Z=W.map;else{W.key=null,W.type=F0;continue $}}return Z}}readHeadByte(){if(this.headByte===p)this.headByte=this.readU8();return this.headByte}complete(){this.headByte=p}readArraySize(){const $=this.readHeadByte();switch($){case 220:return this.readU16();case 221:return this.readU32();default:if($<160)return $-144;else throw new E.DecodeError(`Unrecognized array type byte: ${(0,q0.prettyByte)($)}`)}}pushMapState($){if($>this.maxMapLength)throw new E.DecodeError(`Max length exceeded: map length (${$}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:F0,size:$,key:null,readCount:0,map:{}})}pushArrayState($){if($>this.maxArrayLength)throw new E.DecodeError(`Max length exceeded: array length (${$}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:j8,size:$,array:new Array($),position:0})}decodeUtf8String($,Z){var J;if($>this.maxStrLength)throw new E.DecodeError(`Max length exceeded: UTF-8 byte length (${$}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+Z+$)throw _8;const W=this.pos+Z;let U;if(this.stateIsMapKey()&&((J=this.keyDecoder)===null||J===void 0?void 0:J.canBeCached($)))U=this.keyDecoder.decode(this.bytes,W,$);else U=(0,O6.utf8Decode)(this.bytes,W,$);return this.pos+=Z+$,U}stateIsMapKey(){if(this.stack.length>0)return this.stack[this.stack.length-1].type===F0;return!1}decodeBinary($,Z){if($>this.maxBinLength)throw new E.DecodeError(`Max length exceeded: bin length (${$}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining($+Z))throw _8;const J=this.pos+Z,W=this.bytes.subarray(J,J+$);return this.pos+=Z+$,W}decodeExtension($,Z){if($>this.maxExtLength)throw new E.DecodeError(`Max length exceeded: ext length (${$}) > maxExtLength (${this.maxExtLength})`);const J=this.view.getInt8(this.pos+Z),W=this.decodeBinary($,Z+1);return this.extensionCodec.decode(W,J,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const $=this.view.getUint8(this.pos);return this.pos++,$}readI8(){const $=this.view.getInt8(this.pos);return this.pos++,$}readU16(){const $=this.view.getUint16(this.pos);return this.pos+=2,$}readI16(){const $=this.view.getInt16(this.pos);return this.pos+=2,$}readU32(){const $=this.view.getUint32(this.pos);return this.pos+=4,$}readI32(){const $=this.view.getInt32(this.pos);return this.pos+=4,$}readU64(){const $=(0,v.getUint64)(this.view,this.pos);return this.pos+=8,$}readI64(){const $=(0,v.getInt64)(this.view,this.pos);return this.pos+=8,$}readU64AsBigInt(){const $=this.view.getBigUint64(this.pos);return this.pos+=8,$}readI64AsBigInt(){const $=this.view.getBigInt64(this.pos);return this.pos+=8,$}readF32(){const $=this.view.getFloat32(this.pos);return this.pos+=4,$}readF64(){const $=this.view.getFloat64(this.pos);return this.pos+=8,$}}y8.Decoder=g8});var b8=A((f8)=>{var z6=function($,Z){return new h8.Decoder(Z).decode($)},D6=function($,Z){return new h8.Decoder(Z).decodeMulti($)};Object.defineProperty(f8,"__esModule",{value:!0});f8.decodeMulti=f8.decode=f8.defaultDecodeOptions=void 0;var h8=V0();f8.defaultDecodeOptions=void 0;f8.decode=z6;f8.decodeMulti=D6});var a8=A((d8)=>{var l8=function($){return $[Symbol.asyncIterator]!=null},E6=function($){if($==null)throw new Error("Assertion Failure: value must not be null nor undefined")};async function*u8($){const Z=$.getReader();try{while(!0){const{done:J,value:W}=await Z.read();if(J)return;E6(W),yield W}}finally{Z.releaseLock()}}var x6=function($){if(l8($))return $;else return u8($)};Object.defineProperty(d8,"__esModule",{value:!0});d8.ensureAsyncIterable=d8.asyncIterableFromStream=d8.isAsyncIterable=void 0;d8.isAsyncIterable=l8;d8.asyncIterableFromStream=u8;d8.ensureAsyncIterable=x6});var n8=A((p8)=>{async function g6($,Z){const J=(0,z0.ensureAsyncIterable)($);return new C0.Decoder(Z).decodeAsync(J)}var y6=function($,Z){const J=(0,z0.ensureAsyncIterable)($);return new C0.Decoder(Z).decodeArrayStream(J)},v6=function($,Z){const J=(0,z0.ensureAsyncIterable)($);return new C0.Decoder(Z).decodeStream(J)};Object.defineProperty(p8,"__esModule",{value:!0});p8.decodeStream=p8.decodeMultiStream=p8.decodeArrayStream=p8.decodeAsync=void 0;var C0=V0(),z0=a8();p8.decodeAsync=g6;p8.decodeArrayStream=y6;p8.decodeMultiStream=v6;p8.decodeStream=void 0});var t8=A((P)=>{Object.defineProperty(P,"__esModule",{value:!0});P.decodeTimestampExtension=P.encodeTimestampExtension=P.decodeTimestampToTimeSpec=P.encodeTimeSpecToTimestamp=P.encodeDateToTimeSpec=P.EXT_TIMESTAMP=P.ExtData=P.ExtensionCodec=P.Encoder=P.DecodeError=P.DataViewIndexOutOfBoundsError=P.Decoder=P.decodeStream=P.decodeMultiStream=P.decodeArrayStream=P.decodeAsync=P.decodeMulti=P.decode=P.encode=void 0;var b6=T8();Object.defineProperty(P,"encode",{enumerable:!0,get:function(){return b6.encode}});var r8=b8();Object.defineProperty(P,"decode",{enumerable:!0,get:function(){return r8.decode}});Object.defineProperty(P,"decodeMulti",{enumerable:!0,get:function(){return r8.decodeMulti}});var N0=n8();Object.defineProperty(P,"decodeAsync",{enumerable:!0,get:function(){return N0.decodeAsync}});Object.defineProperty(P,"decodeArrayStream",{enumerable:!0,get:function(){return N0.decodeArrayStream}});Object.defineProperty(P,"decodeMultiStream",{enumerable:!0,get:function(){return N0.decodeMultiStream}});Object.defineProperty(P,"decodeStream",{enumerable:!0,get:function(){return N0.decodeStream}});var s8=V0();Object.defineProperty(P,"Decoder",{enumerable:!0,get:function(){return s8.Decoder}});Object.defineProperty(P,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return s8.DataViewIndexOutOfBoundsError}});var l6=Z0();Object.defineProperty(P,"DecodeError",{enumerable:!0,get:function(){return l6.DecodeError}});var u6=A0();Object.defineProperty(P,"Encoder",{enumerable:!0,get:function(){return u6.Encoder}});var d6=X0();Object.defineProperty(P,"ExtensionCodec",{enumerable:!0,get:function(){return d6.ExtensionCodec}});var c6=w0();Object.defineProperty(P,"ExtData",{enumerable:!0,get:function(){return c6.ExtData}});var l=S0();Object.defineProperty(P,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return l.EXT_TIMESTAMP}});Object.defineProperty(P,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return l.encodeDateToTimeSpec}});Object.defineProperty(P,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return l.encodeTimeSpecToTimestamp}});Object.defineProperty(P,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return l.decodeTimestampToTimeSpec}});Object.defineProperty(P,"encodeTimestampExtension",{enumerable:!0,get:function(){return l.encodeTimestampExtension}});Object.defineProperty(P,"decodeTimestampExtension",{enumerable:!0,get:function(){return l.decodeTimestampExtension}})});var g=E1(t8(),1);function D0($){const Z=Object.create(null),J=Reflect.ownKeys($).filter((W)=>typeof W==="string");for(let W of J){const U=$[W];Z[W]=U&&U instanceof Object?D0(U):U}return Object.freeze(Z)}function o8($){return[...$].reduce((Z,[J,W])=>{return Z[J]=W instanceof Map?o8(W):W,Z},Object.create(null))}function p6($,Z){if(typeof $!=="string"||typeof $!=="number")return;return Z instanceof Map?Object.fromEntries(Z.entries()):Z}var KZ=($)=>D0(o8($)),RZ=($)=>JSON.stringify($,p6),e8={encode:g.encode},h={decode:g.decode,decodeAsync:g.decodeAsync},D=new g.ExtensionCodec,i6={"Content-Type":"application/x-msgpack"},n6=0;D.register({type:n6,encode($){if($ instanceof Set)return e8.encode([...$],{extensionCodec:D});return null},decode($){const Z=h.decode($,{extensionCodec:D});return new Set(Z)},async decodeAsync($){const Z=await h.decodeAsync($,{extensionCodec:D});return new Set(Z)}});var $1=1;D.register({type:$1,encode($){if($ instanceof Map)return e8.encode([...$],{extensionCodec:D});return},decode($){const Z=h.decode($,{extensionCodec:D});return new Map(Z)},async decodeAsync($){const Z=await h.decodeAsync($,{extensionCodec:D});return new Map(Z)}});var Z1=($)=>$.reduce((Z,[J,W])=>{return Z[J]=W?.type===$1&&W?.data instanceof Uint8Array?Z1(h.decode(W.data,{extensionCodec:D})):W,Z},Object.create(null)),PZ=async($)=>{if($.headers.get("Content-Type")!==i6["Content-Type"]||!$.body)return;return D0(Z1(h.decode((await h.decodeAsync($.body,{extensionCodec:D}))?.data,{extensionCodec:D})))};import C from"gremlin";var q=C.process.statics,G0;(function(J){J["out"]="out";J["in"]="in"})(G0||(G0={}));var r6=($)=>{const Z={both:q.both,bothE:q.bothE,bothV:q.bothV,otherV:q.otherV,inV:q.inV,outV:q.outV,inE:q.inE,in:q.in_,outE:q.outE,out:q.out};switch($){case G0.in:return{...Z,to:{e:q.inE,v:q.in_}};case G0.out:return{...Z,to:{e:q.outE,v:q.out}};default:throw new Error(`invalid: ${$}\nexpected an EDir}`)}},k={...C.process,gremlin:C,p:C.process.P,traversal:C.process.AnonymousTraversalSource.traversal,DriverRemoteConnection:C.driver.DriverRemoteConnection,__:q,textp:C.process.TextP,Direction:{BOTH:C.process.direction.both,from_:C.process.direction.in,IN:C.process.direction.in,OUT:C.process.direction.out,to:C.process.direction.out},go:r6};for(let $ of["P","AnonymousTraversalSource","statics","driver","TextP","direction"])delete k[$];import L0 from"gremlin";var o6=function(){return new k0(null,null,new L0.process.Bytecode)},{GraphTraversal:s6,GraphTraversalSource:t6}=L0.process;class k0 extends s6{constructor(){super(...arguments)}keys(){return this.valueMap().select(L0.process.column.keys)}next(){return super.next()}nextMap(){return this.next()}}var TZ=()=>o6().keys();class Y0 extends t6{constructor($,Z,J){super($,Z,J,Y0,k0)}}import W1 from"stream";import $$ from"util";var E0=($)=>{return{start_time:$.duration?Date.now():null,fixed_size_buffer:"",count_written:0,count_created:0}};var i=function($={}){if($.seed)return $.seed=$.seed*Math.PI*100%100/100;else return Math.random()};var x0={ascii:function({options:$}){const Z=[],J=Math.ceil(i($)*$.maxWordLength);for(let W=0;W<J;W++){const U=Math.floor(i($)*32);Z.push(String.fromCharCode(U+(U<16?65:81)))}return Z.join("")},int:function({options:$}){return Math.floor(i($)*Math.pow(2,52))},bool:function({options:$}){return Math.floor(i($)*2)}};var e6=function($){return $.replace(/_([a-z])/gi,function(Z,J){return J.toUpperCase()})},j0=($)=>{if($.object_mode)$.objectMode=$.object_mode;if($.high_water_mark)$.highWaterMark=$.high_water_mark;const Z={};for(let U in $)Z[e6(U)]=$[U];const J={columns:8,delimiter:",",duration:null,encoding:null,end:null,eof:!1,fixedSize:!1,length:-1,maxWordLength:16,rowDelimiter:"\n",seed:!1,sleep:0};for(let U in J)if(Z[U]===void 0)Z[U]=J[U];if(Z.eof===!0)Z.eof=Z.rowDelimiter;if(typeof Z.columns==="number")Z.columns=new Array(Z.columns);const W=Object.keys(x0).filter((U)=>!["super_","camelize"].includes(U));for(let U=0;U<Z.columns.length;U++){const X=Z.columns[U]||"ascii";if(typeof X==="string"){if(!W.includes(X))throw Error(`Invalid column type: got "${X}", default values are ${JSON.stringify(W)}`);Z.columns[U]=x0[X]}}return Z};var _0=($,Z,J,W,U)=>{const X=[];let F=0;if($.fixedSize){if(F=Z.fixed_size_buffer.length,F!==0)X.push(Z.fixed_size_buffer)}while(!0){if(Z.count_created===$.length||$.end&&Date.now()>$.end||$.duration&&Date.now()>Z.start_time+$.duration){if(X.length){if($.objectMode)for(let N of X)W(N);else W(X.join("")+($.eof?$.eof:""));Z.end=!0}else U();return}let Q=[],V;for(let N of $.columns){const K=N({options:$,state:Z}),I=typeof K;if(K!==null&&I!=="string"&&I!=="number"){U(Error(["INVALID_VALUE:","values returned by column function must be","a string, a number or null,",`got ${JSON.stringify(K)}`].join(" ")));return}Q.push(K)}if($.objectMode){V=0;for(let N of Q)V+=N.length}else Q=(Z.count_created===0?"":$.rowDelimiter)+Q.join($.delimiter),V=Q.length;if(Z.count_created++,F+V>J){if($.objectMode){X.push(Q);for(let N of X)W(N)}else{if($.fixedSize)Z.fixed_size_buffer=Q.substr(J-F),X.push(Q.substr(0,J-F));else X.push(Q);W(X.join(""))}return}F+=V,X.push(Q)}};var u=function($={}){return this.options=j0($),W1.Readable.call(this,this.options),this.state=E0(this.options),this};$$.inherits(u,W1.Readable);u.prototype.end=function(){this.push(null)};u.prototype._read=function($){setImmediate(()=>{this.__read($)})};u.prototype.__read=function($){_0(this.options,this.state,$,(Z)=>{this.__push(Z)},(Z)=>{if(Z)this.destroy(Z);else this.push(null)})};u.prototype.__push=function($){const Z=()=>{if(this.state.count_written++,this.push($),this.state.end===!0)return this.push(null)};this.options.sleep>0?setTimeout(Z,this.options.sleep):Z()};class Y extends Error{constructor($,Z,J,...W){if(Array.isArray(Z))Z=Z.join(" ").trim();super(Z);if(Error.captureStackTrace!==void 0)Error.captureStackTrace(this,Y);this.code=$;for(let U of W)for(let X in U){const F=U[X];this[X]=Buffer.isBuffer(F)?F.toString(J.encoding):F==null?F:JSON.parse(JSON.stringify(F))}}}var J1=function($){return typeof $==="object"&&$!==null&&!Array.isArray($)};var I0=function($){const Z=[];for(let J=0,W=$.length;J<W;J++){const U=$[J];if(U===void 0||U===null||U===!1)Z[J]={disabled:!0};else if(typeof U==="string")Z[J]={name:U};else if(J1(U)){if(typeof U.name!=="string")throw new Y("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${J}`,"when column is an object literal"]);Z[J]=U}else throw new Y("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(U)} at position ${J}`])}return Z};class U1{constructor($=100){this.size=$,this.length=0,this.buf=Buffer.allocUnsafe($)}prepend($){if(Buffer.isBuffer($)){const Z=this.length+$.length;if(Z>=this.size){if(this.resize(),Z>=this.size)throw Error("INVALID_BUFFER_STATE")}const J=this.buf;this.buf=Buffer.allocUnsafe(this.size),$.copy(this.buf,0),J.copy(this.buf,$.length),this.length+=$.length}else{const Z=this.length++;if(Z===this.size)this.resize();const J=this.clone();this.buf[0]=$,J.copy(this.buf,1,0,Z)}}append($){const Z=this.length++;if(Z===this.size)this.resize();this.buf[Z]=$}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const $=this.length;this.size=this.size*2;const Z=Buffer.allocUnsafe(this.size);this.buf.copy(Z,0,0,$),this.buf=Z}toString($){if($)return this.buf.slice(0,this.length).toString($);else return Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}var g0=U1;var Z$=12,W$=13,J$=10,U$=32,X$=9,X1=function($){return{bomSkipped:!1,bufBytesStart:0,castField:$.cast_function,commenting:!1,error:void 0,enabled:$.from_line===1,escaping:!1,escapeIsQuote:Buffer.isBuffer($.escape)&&Buffer.isBuffer($.quote)&&Buffer.compare($.escape,$.quote)===0,expectedRecordLength:Array.isArray($.columns)?$.columns.length:void 0,field:new g0(20),firstLineToHeaders:$.cast_first_line_to_header,needMoreDataSize:Math.max($.comment!==null?$.comment.length:0,...$.delimiter.map((Z)=>Z.length),$.quote!==null?$.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new g0(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:$.record_delimiter.length===0?0:Math.max(...$.record_delimiter.map((Z)=>Z.length)),trimChars:[Buffer.from(" ",$.encoding)[0],Buffer.from("\t",$.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([W$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([J$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([Z$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([U$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([X$],"utf8").toString(),$.encoding)]}};var F1=function($){return $.replace(/([A-Z])/g,function(Z,J){return"_"+J.toLowerCase()})};var y0=function($){const Z={};for(let W in $)Z[F1(W)]=$[W];if(Z.encoding===void 0||Z.encoding===!0)Z.encoding="utf8";else if(Z.encoding===null||Z.encoding===!1)Z.encoding=null;else if(typeof Z.encoding!=="string"&&Z.encoding!==null)throw new Y("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(Z.encoding)}`],Z);if(Z.bom===void 0||Z.bom===null||Z.bom===!1)Z.bom=!1;else if(Z.bom!==!0)throw new Y("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(Z.bom)}`],Z);if(Z.cast_function=null,Z.cast===void 0||Z.cast===null||Z.cast===!1||Z.cast==="")Z.cast=void 0;else if(typeof Z.cast==="function")Z.cast_function=Z.cast,Z.cast=!0;else if(Z.cast!==!0)throw new Y("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(Z.cast)}`],Z);if(Z.cast_date===void 0||Z.cast_date===null||Z.cast_date===!1||Z.cast_date==="")Z.cast_date=!1;else if(Z.cast_date===!0)Z.cast_date=function(W){const U=Date.parse(W);return!isNaN(U)?new Date(U):W};else if(typeof Z.cast_date!=="function")throw new Y("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(Z.cast_date)}`],Z);if(Z.cast_first_line_to_header=null,Z.columns===!0)Z.cast_first_line_to_header=void 0;else if(typeof Z.columns==="function")Z.cast_first_line_to_header=Z.columns,Z.columns=!0;else if(Array.isArray(Z.columns))Z.columns=I0(Z.columns);else if(Z.columns===void 0||Z.columns===null||Z.columns===!1)Z.columns=!1;else throw new Y("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(Z.columns)}`],Z);if(Z.group_columns_by_name===void 0||Z.group_columns_by_name===null||Z.group_columns_by_name===!1)Z.group_columns_by_name=!1;else if(Z.group_columns_by_name!==!0)throw new Y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(Z.group_columns_by_name)}`],Z);else if(Z.columns===!1)throw new Y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],Z);if(Z.comment===void 0||Z.comment===null||Z.comment===!1||Z.comment==="")Z.comment=null;else{if(typeof Z.comment==="string")Z.comment=Buffer.from(Z.comment,Z.encoding);if(!Buffer.isBuffer(Z.comment))throw new Y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(Z.comment)}`],Z)}if(Z.comment_no_infix===void 0||Z.comment_no_infix===null||Z.comment_no_infix===!1)Z.comment_no_infix=!1;else if(Z.comment_no_infix!==!0)throw new Y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(Z.comment_no_infix)}`],Z);const J=JSON.stringify(Z.delimiter);if(!Array.isArray(Z.delimiter))Z.delimiter=[Z.delimiter];if(Z.delimiter.length===0)throw new Y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${J}`],Z);if(Z.delimiter=Z.delimiter.map(function(W){if(W===void 0||W===null||W===!1)return Buffer.from(",",Z.encoding);if(typeof W==="string")W=Buffer.from(W,Z.encoding);if(!Buffer.isBuffer(W)||W.length===0)throw new Y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${J}`],Z);return W}),Z.escape===void 0||Z.escape===!0)Z.escape=Buffer.from('"',Z.encoding);else if(typeof Z.escape==="string")Z.escape=Buffer.from(Z.escape,Z.encoding);else if(Z.escape===null||Z.escape===!1)Z.escape=null;if(Z.escape!==null){if(!Buffer.isBuffer(Z.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(Z.escape)}`)}if(Z.from===void 0||Z.from===null)Z.from=1;else{if(typeof Z.from==="string"&&/\d+/.test(Z.from))Z.from=parseInt(Z.from);if(Number.isInteger(Z.from)){if(Z.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify($.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(Z.from)}`)}if(Z.from_line===void 0||Z.from_line===null)Z.from_line=1;else{if(typeof Z.from_line==="string"&&/\d+/.test(Z.from_line))Z.from_line=parseInt(Z.from_line);if(Number.isInteger(Z.from_line)){if(Z.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify($.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify($.from_line)}`)}if(Z.ignore_last_delimiters===void 0||Z.ignore_last_delimiters===null)Z.ignore_last_delimiters=!1;else if(typeof Z.ignore_last_delimiters==="number"){if(Z.ignore_last_delimiters=Math.floor(Z.ignore_last_delimiters),Z.ignore_last_delimiters===0)Z.ignore_last_delimiters=!1}else if(typeof Z.ignore_last_delimiters!=="boolean")throw new Y("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(Z.ignore_last_delimiters)}`],Z);if(Z.ignore_last_delimiters===!0&&Z.columns===!1)throw new Y("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],Z);if(Z.info===void 0||Z.info===null||Z.info===!1)Z.info=!1;else if(Z.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(Z.info)}`);if(Z.max_record_size===void 0||Z.max_record_size===null||Z.max_record_size===!1)Z.max_record_size=0;else if(Number.isInteger(Z.max_record_size)&&Z.max_record_size>=0);else if(typeof Z.max_record_size==="string"&&/\d+/.test(Z.max_record_size))Z.max_record_size=parseInt(Z.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(Z.max_record_size)}`);if(Z.objname===void 0||Z.objname===null||Z.objname===!1)Z.objname=void 0;else if(Buffer.isBuffer(Z.objname)){if(Z.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");if(Z.encoding===null);else Z.objname=Z.objname.toString(Z.encoding)}else if(typeof Z.objname==="string"){if(Z.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof Z.objname==="number");else throw new Error(`Invalid Option: objname must be a string or a buffer, got ${Z.objname}`);if(Z.objname!==void 0){if(typeof Z.objname==="number"){if(Z.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(Z.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(Z.on_record===void 0||Z.on_record===null)Z.on_record=void 0;else if(typeof Z.on_record!=="function")throw new Y("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(Z.on_record)}`],Z);if(Z.quote===null||Z.quote===!1||Z.quote==="")Z.quote=null;else{if(Z.quote===void 0||Z.quote===!0)Z.quote=Buffer.from('"',Z.encoding);else if(typeof Z.quote==="string")Z.quote=Buffer.from(Z.quote,Z.encoding);if(!Buffer.isBuffer(Z.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(Z.quote)}`)}if(Z.raw===void 0||Z.raw===null||Z.raw===!1)Z.raw=!1;else if(Z.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(Z.raw)}`);if(Z.record_delimiter===void 0)Z.record_delimiter=[];else if(typeof Z.record_delimiter==="string"||Buffer.isBuffer(Z.record_delimiter)){if(Z.record_delimiter.length===0)throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(Z.record_delimiter)}`],Z);Z.record_delimiter=[Z.record_delimiter]}else if(!Array.isArray(Z.record_delimiter))throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(Z.record_delimiter)}`],Z);if(Z.record_delimiter=Z.record_delimiter.map(function(W,U){if(typeof W!=="string"&&!Buffer.isBuffer(W))throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${U},`,`got ${JSON.stringify(W)}`],Z);else if(W.length===0)throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${U},`,`got ${JSON.stringify(W)}`],Z);if(typeof W==="string")W=Buffer.from(W,Z.encoding);return W}),typeof Z.relax_column_count==="boolean");else if(Z.relax_column_count===void 0||Z.relax_column_count===null)Z.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(Z.relax_column_count)}`);if(typeof Z.relax_column_count_less==="boolean");else if(Z.relax_column_count_less===void 0||Z.relax_column_count_less===null)Z.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(Z.relax_column_count_less)}`);if(typeof Z.relax_column_count_more==="boolean");else if(Z.relax_column_count_more===void 0||Z.relax_column_count_more===null)Z.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(Z.relax_column_count_more)}`);if(typeof Z.relax_quotes==="boolean");else if(Z.relax_quotes===void 0||Z.relax_quotes===null)Z.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(Z.relax_quotes)}`);if(typeof Z.skip_empty_lines==="boolean");else if(Z.skip_empty_lines===void 0||Z.skip_empty_lines===null)Z.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(Z.skip_empty_lines)}`);if(typeof Z.skip_records_with_empty_values==="boolean");else if(Z.skip_records_with_empty_values===void 0||Z.skip_records_with_empty_values===null)Z.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(Z.skip_records_with_empty_values)}`);if(typeof Z.skip_records_with_error==="boolean");else if(Z.skip_records_with_error===void 0||Z.skip_records_with_error===null)Z.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(Z.skip_records_with_error)}`);if(Z.rtrim===void 0||Z.rtrim===null||Z.rtrim===!1)Z.rtrim=!1;else if(Z.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(Z.rtrim)}`);if(Z.ltrim===void 0||Z.ltrim===null||Z.ltrim===!1)Z.ltrim=!1;else if(Z.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(Z.ltrim)}`);if(Z.trim===void 0||Z.trim===null||Z.trim===!1)Z.trim=!1;else if(Z.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(Z.trim)}`);if(Z.trim===!0&&$.ltrim!==!1)Z.ltrim=!0;else if(Z.ltrim!==!0)Z.ltrim=!1;if(Z.trim===!0&&$.rtrim!==!1)Z.rtrim=!0;else if(Z.rtrim!==!0)Z.rtrim=!1;if(Z.to===void 0||Z.to===null)Z.to=-1;else{if(typeof Z.to==="string"&&/\d+/.test(Z.to))Z.to=parseInt(Z.to);if(Number.isInteger(Z.to)){if(Z.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify($.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify($.to)}`)}if(Z.to_line===void 0||Z.to_line===null)Z.to_line=-1;else{if(typeof Z.to_line==="string"&&/\d+/.test(Z.to_line))Z.to_line=parseInt(Z.to_line);if(Number.isInteger(Z.to_line)){if(Z.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify($.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify($.to_line)}`)}return Z};var Q1=function($){return $.every((Z)=>Z==null||Z.toString&&Z.toString().trim()==="")},F$=13,Q$=10,d={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},V1=function($={}){const Z={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},J=y0($);return{info:Z,original_options:$,options:J,state:X1(J),__needMoreData:function(W,U,X){if(X)return!1;const{encoding:F,escape:Q,quote:V}=this.options,{quoting:N,needMoreDataSize:K,recordDelimiterMaxLength:I}=this.state,L=U-W-1,b=Math.max(K,I===0?Buffer.from("\r\n",F).length:I,N?(Q===null?0:Q.length)+V.length:0,N?V.length+I:0);return L<b},parse:function(W,U,X,F){const{bom:Q,comment_no_infix:V,encoding:N,from_line:K,ltrim:I,max_record_size:L,raw:b,relax_quotes:s,rtrim:S,skip_empty_lines:x,to:B,to_line:R}=this.options;let{comment:H,escape:T,quote:z,record_delimiter:R0}=this.options;const{bomSkipped:q1,previousBuf:t,rawBuffer:B1,escapeIsQuote:T1}=this.state;let M;if(t===void 0)if(W===void 0){F();return}else M=W;else if(t!==void 0&&W===void 0)M=t;else M=Buffer.concat([t,W]);if(q1===!1)if(Q===!1)this.state.bomSkipped=!0;else if(M.length<3){if(U===!1){this.state.previousBuf=M;return}}else{for(let w in d)if(d[w].compare(M,0,d[w].length)===0){const j=d[w].length;this.state.bufBytesStart+=j,M=M.slice(j),this.options=y0({...this.original_options,encoding:w}),{comment:H,escape:T,quote:z}=this.options;break}this.state.bomSkipped=!0}const P0=M.length;let G;for(G=0;G<P0;G++){if(this.__needMoreData(G,P0,U))break;if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1;if(R!==-1&&this.info.lines>R){this.state.stop=!0,F();return}if(this.state.quoting===!1&&R0.length===0){if(this.__autoDiscoverRecordDelimiter(M,G))R0=this.options.record_delimiter}const w=M[G];if(b===!0)B1.append(w);if((w===F$||w===Q$)&&this.state.wasRowDelimiter===!1)this.state.wasRowDelimiter=!0;if(this.state.escaping===!0)this.state.escaping=!1;else{if(T!==null&&this.state.quoting===!0&&this.__isEscape(M,G,w)&&G+T.length<P0)if(T1){if(this.__isQuote(M,G+T.length)){this.state.escaping=!0,G+=T.length-1;continue}}else{this.state.escaping=!0,G+=T.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(M,G))if(this.state.quoting===!0){const O=M[G+z.length],c=S&&this.__isCharTrimable(M,G+z.length),y=H!==null&&this.__compareBytes(H,M,G+z.length,O),_=this.__isDelimiter(M,G+z.length,O),o=R0.length===0?this.__autoDiscoverRecordDelimiter(M,G+z.length):this.__isRecordDelimiter(O,M,G+z.length);if(T!==null&&this.__isEscape(M,G,w)&&this.__isQuote(M,G+T.length))G+=T.length-1;else if(!O||_||o||y||c){this.state.quoting=!1,this.state.wasQuoting=!0,G+=z.length-1;continue}else if(s===!1){const a=this.__error(new Y("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(O)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(a!==void 0)return a}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(z),G+=z.length-1}else if(this.state.field.length!==0){if(s===!1){const O=this.__infoField(),c=Object.keys(d).map((_)=>d[_].equals(this.state.field.toString())?_:!1).filter(Boolean)[0],y=this.__error(new Y("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(O.column)} at line ${O.lines}, value is ${JSON.stringify(this.state.field.toString(N))}`,c?`(${c} bom)`:void 0],this.options,O,{field:this.state.field}));if(y!==void 0)return y}}else{this.state.quoting=!0,G+=z.length-1;continue}if(this.state.quoting===!1){const O=this.__isRecordDelimiter(w,M,G);if(O!==0){if(this.state.commenting&&(this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0))this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=K){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),G+=O-1;continue}if(x===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,G+=O-1;continue}this.info.bytes=this.state.bufBytesStart+G;const o=this.__onField();if(o!==void 0)return o;this.info.bytes=this.state.bufBytesStart+G+O;const a=this.__onRecord(X);if(a!==void 0)return a;if(B!==-1&&this.info.records>=B){this.state.stop=!0,F();return}}this.state.commenting=!1,G+=O-1;continue}if(this.state.commenting)continue;if((H===null?0:this.__compareBytes(H,M,G,w))!==0&&(V===!1||this.state.field.length===0)){this.state.commenting=!0;continue}const y=this.__isDelimiter(M,G,w);if(y!==0){this.info.bytes=this.state.bufBytesStart+G;const _=this.__onField();if(_!==void 0)return _;G+=y-1;continue}}}if(this.state.commenting===!1){if(L!==0&&this.state.record_length+this.state.field.length>L)return this.__error(new Y("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${L}`,`at line ${this.info.lines}`],this.options,this.__infoField()))}const j=I===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(M,G),C1=S===!1||this.state.wasQuoting===!1;if(j===!0&&C1===!0)this.state.field.append(w);else if(S===!0&&!this.__isCharTrimable(M,G))return this.__error(new Y("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));else{if(j===!1)G+=this.__isCharTrimable(M,G)-1;continue}}if(U===!0){if(this.state.quoting===!0){const w=this.__error(new Y("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(w!==void 0)return w}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+G;const w=this.__onField();if(w!==void 0)return w;const j=this.__onRecord(X);if(j!==void 0)return j}else if(this.state.wasRowDelimiter===!0)this.info.empty_lines++;else if(this.state.commenting===!0)this.info.comment_lines++}else this.state.bufBytesStart+=G,this.state.previousBuf=M.slice(G);if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1},__onRecord:function(W){const{columns:U,group_columns_by_name:X,encoding:F,info:Q,from:V,relax_column_count:N,relax_column_count_less:K,relax_column_count_more:I,raw:L,skip_records_with_empty_values:b}=this.options,{enabled:s,record:S}=this.state;if(s===!1)return this.__resetRecord();const x=S.length;if(U===!0){if(b===!0&&Q1(S)){this.__resetRecord();return}return this.__firstLineToColumns(S)}if(U===!1&&this.info.records===0)this.state.expectedRecordLength=x;if(x!==this.state.expectedRecordLength){const B=U===!1?new Y("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${x} on line ${this.info.lines}`],this.options,this.__infoField(),{record:S}):new Y("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${U.length},`,`got ${x} on line ${this.info.lines}`],this.options,this.__infoField(),{record:S});if(N===!0||K===!0&&x<this.state.expectedRecordLength||I===!0&&x>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=B;else{const R=this.__error(B);if(R)return R}}if(b===!0&&Q1(S)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,V===1||this.info.records>=V){const{objname:B}=this.options;if(U!==!1){const R={};for(let H=0,T=S.length;H<T;H++){if(U[H]===void 0||U[H].disabled)continue;if(X===!0&&R[U[H].name]!==void 0)if(Array.isArray(R[U[H].name]))R[U[H].name]=R[U[H].name].concat(S[H]);else R[U[H].name]=[R[U[H].name],S[H]];else R[U[H].name]=S[H]}if(L===!0||Q===!0){const H=Object.assign({record:R},L===!0?{raw:this.state.rawBuffer.toString(F)}:{},Q===!0?{info:this.__infoRecord()}:{}),T=this.__push(B===void 0?H:[R[B],H],W);if(T)return T}else{const H=this.__push(B===void 0?R:[R[B],R],W);if(H)return H}}else if(L===!0||Q===!0){const R=Object.assign({record:S},L===!0?{raw:this.state.rawBuffer.toString(F)}:{},Q===!0?{info:this.__infoRecord()}:{}),H=this.__push(B===void 0?R:[S[B],R],W);if(H)return H}else{const R=this.__push(B===void 0?S:[S[B],S],W);if(R)return R}}this.__resetRecord()},__firstLineToColumns:function(W){const{firstLineToHeaders:U}=this.state;try{const X=U===void 0?W:U.call(null,W);if(!Array.isArray(X))return this.__error(new Y("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(X)}`],this.options,this.__infoField(),{headers:X}));const F=I0(X);this.state.expectedRecordLength=F.length,this.options.columns=F,this.__resetRecord();return}catch(X){return X}},__resetRecord:function(){if(this.options.raw===!0)this.state.rawBuffer.reset();this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:W,encoding:U,rtrim:X,max_record_size:F}=this.options,{enabled:Q,wasQuoting:V}=this.state;if(Q===!1)return this.__resetField();let N=this.state.field.toString(U);if(X===!0&&V===!1)N=N.trimRight();if(W===!0){const[K,I]=this.__cast(N);if(K!==void 0)return K;N=I}if(this.state.record.push(N),F!==0&&typeof N==="string")this.state.record_length+=N.length;this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(W,U){const{on_record:X}=this.options;if(X!==void 0){const F=this.__infoRecord();try{W=X.call(null,W,F)}catch(Q){return Q}if(W===void 0||W===null)return}U(W)},__cast:function(W){const{columns:U,relax_column_count:X}=this.options;if(Array.isArray(U)===!0&&X&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const Q=this.__infoField();return[void 0,this.state.castField.call(null,W,Q)]}catch(Q){return[Q]}if(this.__isFloat(W))return[void 0,parseFloat(W)];else if(this.options.cast_date!==!1){const Q=this.__infoField();return[void 0,this.options.cast_date.call(null,W,Q)]}return[void 0,W]},__isCharTrimable:function(W,U){return((F,Q)=>{const{timchars:V}=this.state;$:for(let N=0;N<V.length;N++){const K=V[N];for(let I=0;I<K.length;I++)if(K[I]!==F[Q+I])continue $;return K.length}return 0})(W,U)},__isFloat:function(W){return W-parseFloat(W)+1>=0},__compareBytes:function(W,U,X,F){if(W[0]!==F)return 0;const Q=W.length;for(let V=1;V<Q;V++)if(W[V]!==U[X+V])return 0;return Q},__isDelimiter:function(W,U,X){const{delimiter:F,ignore_last_delimiters:Q}=this.options;if(Q===!0&&this.state.record.length===this.options.columns.length-1)return 0;else if(Q!==!1&&typeof Q==="number"&&this.state.record.length===Q-1)return 0;$:for(let V=0;V<F.length;V++){const N=F[V];if(N[0]===X){for(let K=1;K<N.length;K++)if(N[K]!==W[U+K])continue $;return N.length}}return 0},__isRecordDelimiter:function(W,U,X){const{record_delimiter:F}=this.options,Q=F.length;$:for(let V=0;V<Q;V++){const N=F[V],K=N.length;if(N[0]!==W)continue;for(let I=1;I<K;I++)if(N[I]!==U[X+I])continue $;return N.length}return 0},__isEscape:function(W,U,X){const{escape:F}=this.options;if(F===null)return!1;const Q=F.length;if(F[0]===X){for(let V=0;V<Q;V++)if(F[V]!==W[U+V])return!1;return!0}return!1},__isQuote:function(W,U){const{quote:X}=this.options;if(X===null)return!1;const F=X.length;for(let Q=0;Q<F;Q++)if(X[Q]!==W[U+Q])return!1;return!0},__autoDiscoverRecordDelimiter:function(W,U){const{encoding:X}=this.options,F=[Buffer.from("\r\n",X),Buffer.from("\n",X),Buffer.from("\r",X)];$:for(let Q=0;Q<F.length;Q++){const V=F[Q].length;for(let N=0;N<V;N++)if(F[Q][N]!==W[U+N])continue $;return this.options.record_delimiter.push(F[Q]),this.state.recordDelimiterMaxLength=F[Q].length,F[Q].length}return 0},__error:function(W){const{encoding:U,raw:X,skip_records_with_error:F}=this.options,Q=typeof W==="string"?new Error(W):W;if(F){if(this.state.recordHasError=!0,this.options.on_skip!==void 0)this.options.on_skip(Q,X?this.state.rawBuffer.toString(U):void 0);return}else return Q},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:W,raw:U,encoding:X}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:W===!0,index:this.state.record.length,raw:U?this.state.rawBuffer.toString(X):void 0}},__infoField:function(){const{columns:W}=this.options,U=Array.isArray(W);return{...this.__infoRecord(),column:U===!0?W.length>this.state.record.length?W[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}};var v0=function($,Z={}){if(typeof $==="string")$=Buffer.from($);const J=Z&&Z.objname?{}:[],W=V1(Z),U=(V)=>{if(W.options.objname===void 0)J.push(V);else J[V[0]]=V[1]},X=()=>{},F=W.parse($,!1,U,X);if(F!==void 0)throw F;const Q=W.parse(void 0,!0,U,X);if(Q!==void 0)throw Q;return J};var I4=".".charCodeAt(0);var H4=RegExp('[^.[\\]]+|\\[(?:([^"\'][^[]*)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))',"g");var x4=Buffer.from([239,187,191]);import N1 from"stream";import G$ from"util";var n=function($={},Z){if(this.options=$,$.consume===void 0||$.consume===null)this.options.consume=!1;if(this.options.objectMode=!0,$.parallel===void 0||$.parallel===null)this.options.parallel=100;if($.params===void 0||$.params===null)$.params=null;return this.handler=Z,N1.Transform.call(this,this.options),this.state={running:0,started:0,finished:0,paused:!1},this};G$.inherits(n,N1.Transform);n.prototype._transform=function($,Z,J){if(this.state.started++,this.state.running++,!this.state.paused&&this.state.running<this.options.parallel)J(),J=null;try{let W=this.handler.length;if(this.options.params!==null)W--;if(W===1){const U=this.handler.call(this,$,this.options.params);this.__done(null,[U],J)}else if(W===2){const U=(X,...F)=>this.__done(X,F,J);this.handler.call(this,$,U,this.options.params)}else throw Error("Invalid handler arguments");return!1}catch(W){this.__done(W)}};n.prototype._flush=function($){if(this.state.running===0)$();else this._ending=function(){$()}};n.prototype.__done=function($,Z,J){if(this.state.running--,$)return this.emit("error",$);this.state.finished++;for(let W of Z){if(typeof W==="number")W=`${W}`;if(W!==void 0&&W!==null&&W!=="")this.state.paused=!this.push(W)}if(J)J();if(this._ending&&this.state.running===0)this._ending()};import S$ from"node:fs/promises";var f=($,...Z)=>{console.info(`${(new Date()).toString()}\n`,`${$}\n`,...Z,"\n\n")};import Y$ from"node:path";var G1=($)=>Y$.parse($).name,Y1=($,Z="csv")=>`${$}.${Z}`,o4=($)=>new Date($.replaceAll(/['"]+/gu,"")),h0=Object.create(null),e4=($)=>{if(!h0[$])h0[$]=Bun.hash($).toString();return h0[$]},I$=($)=>{if(String($).length===0)throw new Error(`neptune requires edges to have exactly 1 label: ${$} received`);return $},f0=($)=>{if($.length===0)throw new Error("neptune requires at least 1 label for vertices");return $[0]},$7=($)=>$==="v"?f0:I$,I1=($)=>$.reduce((Z,J)=>{if(J.status==="rejected")Z.failure.push(J.reason);else Z.success.push(J.value);return Z},{success:[],failure:[]});var{t:M0,Direction:M1,merge:H0}=k,H$=($)=>$.edges.map((Z)=>{if(!Z.recordId)throw new Error(`all edges require a user supplied recordId\n${JSON.stringify(Z)}`);const J=new Map(Object.entries(Z.p??{}));return J.set(M0.label,Z.l),J.set(M1.OUT,Z.f),J.set(M1.IN,Z.t),[new Map([[M0.id,Z.recordId]]),J]}),M$=($)=>{if(!$.recordId)throw new Error("all vertices require a user supplied recordId");const Z=$.p?new Map(Object.entries($.p)):new Map;if(!$.l)throw new Error(`all vertex require a label: ${$.l}`);return Z.set(M0.label,f0($.l)),[new Map([[M0.id,$.recordId]]),Z]},K1=async($,Z)=>Promise.allSettled($.flatMap((J)=>{if(Z.type==="v"){const[W,U]=M$(J);return m0.mergeV(W).option(H0.onCreate,U).option(H0.onMatch,U).toList()}return H$(J).map(([W,U])=>m0.mergeE(W).option(H0.onCreate,U).option(H0.onMatch,U).toList())}).filter(Boolean)).then(I1);var R1=($)=>{if(typeof $!=="string"||typeof $!=="number")throw new TypeError(`invalid type, expected number|string, received: ${typeof $}`);return $},P1=($,Z,J)=>{const W={...$.inject?.p},U=$.inject?.l?.slice()??[];for(let[X,F]of J.entries()){if($.colMap?.ignoreCols?.includes(X))continue;if($.colMap?.ignoreEmptyCol&&String(F).length===0)continue;const Q=Z[X],V=$.colMap?.transform?.(X,F)??F;if($.colMap?.p?.includes(X))W[Q]=V;else if($.colMap?.l?.includes(X))if(U.length>0)W[Q]=V;else U.push(R1(V));else if($.colMap?.default)switch($.colMap.default){case"p":{W[Q]=V;break}default:if(U.length>0)W[Q]=V;else U.push(R1(V))}}return{p:W,l:U}},R$=($,Z,J)=>Z.map((W)=>{const U=$.transformRecord?.(W)??W,X=P1($,J,U);return{edges:$.edges.map((F)=>({f:F.f(X,U),t:F.t(X,U),l:F.l(X,U),p:F.p?.(X)??{},recordId:F.recordId(X,U)}))}}),P$=($,Z,J)=>Z.map((W)=>{const U=$.transformRecord?.(W)??W,X=P1($,J,U);return{recordId:$.recordId(X,U),...X}}),w1=($,Z)=>{const J=$.transformHeaders?.(Z[0])??Z[0];switch($.type){case"v":return P$($,Z.slice(1),J);case"e":return R$($,Z.slice(1),J);default:throw new Error(`invalid spec type: ${$.type}`)}};var m=($={})=>({files:new Set,parsed:new Map,transformed:new Map,...$}),b0=async($,Z,J,W=m())=>{const U=W.parsed.get($);if(U)W.transformed.set(J||$,{spec:Z,data:await w1(Z,U)});else throw new Error(`csv not parsed: ${$}`)},S1=async($,Z,J=m())=>{try{J.parsed.set($,v0(await Bun.file(Z).text()))}catch(W){const U=W instanceof Error?W.message:"unknown error";throw new Error(`invalid csv ${$}: ${Z}\n${U}`)}},O$=async($,Z=m())=>{for(let J of await S$.readdir($))J.endsWith(".csv")&&Z.files.add(J);f("total csv files found",Z.files.size)},A$=async($,Z=m())=>{if(!$.files)return;for(let[J,W]of $.files){const U=typeof W==="function"?W(J):W;if(U.recursive)await b0(U.recursive,U,J,Z);else{const X=Y1(J);if(!Z.files.has(X))throw new Error(`could not find file: ${X}`);Z.files.delete(X),await S1(J,`${$.csvDir}/${X}`,Z),await b0(J,U,"",Z)}}f("transformed config.files",Z.transformed.size)},q$=async($,Z=m())=>{if(!$.includeUnmappedFiles)return;if(!$.getSpec)throw new Error("Including unmapped files requires config.getSpec to be defined");let J=0;for(let W of Z.files){const U=G1(W),X=$.getSpec(U);if(!X)continue;J++,Z.files.delete(W),await S1(U,`${$.csvDir}/${W}`,Z),await b0(U,X,"",Z)}f(`
    unmapped csvs processed ${J}
    unmapped csvs ignored: ${Z.files.size}
    `)},B$=async($,Z=m())=>{if(Z.transformed.size===0)throw new Error(`
      no CSV files transformed. Did you correctly map CSV filenames to config specs?
      CSVs pared: ${Z.parsed.size}
      CSVs ignored: ${Z.files.size}
      CSVs transformed: ${Z.transformed.size}
      `);for(let[J,W]of Z.transformed.entries()){const U=await K1(W.data,W.spec);if($.persistResultLog){const X=`${$.csvDir}/${J}.csv.json`;Bun.write(X,JSON.stringify(U)),f(`result log saved to ${X}`)}f(`loaded ${J} into tinkergraph`,{success:U.success.length,failure:U.failure.length})}f("total csvs loaded in tinkergraph",Z.transformed.size)},X7=async($,Z=m())=>{await O$($.csvDir,Z),await A$($,Z),await q$($,Z),await B$($,Z)},F7=()=>"not implemented";var{t:r}=k,{keys:T$,values:C$}=k.column,{addAll:O1}=k.operator,{flatMap:z$,identity:K0,project:D$,select:L$,unfold:A1,union:k$,valueMap:E$}=k.__,M7=($)=>({...$,limitX:$.limitX??0,limitY:$.limitY??($.limitX??0)+10}),K7=($,Z)=>{if(!Array.isArray(Z)||Z.length===0)throw new Error(`${$} must be a non empty array\nreceived: ${Z?.toString?.()}`);return!1},R7=($,...Z)=>{throw new Error(`Invalid Query\n${$}\n${JSON.stringify(Z)}`)},P7=({as:$=[],elements:Z=K0(),elKeys:J=[]})=>Z.as(...$,"base").valueMap(...J).by(A1()).sack(O1).select("base").project("id","label").by(r.id).by(r.label).sack(O1),w7=({elements:$=K0(),elKeys:Z=[],traversals:J=[]})=>$.local(k$(D$("id","label").by(r.id).by(r.label),E$(...Z).by(A1()),...J).unfold().group().by(T$).by(L$(C$))),S7=({elements:$=K0(),elKeys:Z=[]})=>$.group().by(Z[0]??r.id).by(z$(K0()));var{traversal:x$,DriverRemoteConnection:j$,gremlin:_$}=k,m0=x$(Y0).withRemote(new j$("ws://0.0.0.0:8182/gremlin")),T7=new _$.driver.Client("ws://0.0.0.0:8182/gremlin",{traversalSource:"g",session:`${Date.now()}`});export{R1 as validateNumStr,q$ as transformUnmappedFiles,P1 as transformPropertiesAndLabels,A$ as transformConfigFiles,b0 as transformAndSaveTinkerData,RZ as toJsonStringified,KZ as toJson,F7 as tinkergraphToNeptuneCsv,M$ as tinkerDataVertex,H$ as tinkerDataEdge,K1 as tinkerData,R7 as throwInvalidQuery,K7 as throwIfEmpty,I1 as recordsCreatedHandler,O$ as readCsvDir,o4 as pgDateToJs,S1 as parseFile,Z1 as msgpackToJsonIterator,PZ as msgpackToJson,p6 as mapTojsonReplacer,o8 as mapToJsonIterator,f as log,B$ as loadTinkerData,TZ as keys,e4 as hashId,S7 as groupByIdentity,r6 as go,f0 as getVertexLabel,m as getStore,$7 as getLabel,I$ as getEdgeLabel,M7 as getBaseOpts,m0 as g,G1 as fnameToBname,D as extensionCodec,e8 as encoder,P7 as elementProps,D0 as deepFreezeCopy,h as decoder,X7 as csvToTinkergraph,P$ as csvToTinkerDataVertex,R$ as csvToTinkerDataEdge,w1 as csvToTinkerData,k as common,w7 as combineProps,T7 as client,Y1 as bnameTofname,n6 as SET_EXT_TYPE,i6 as MSGPACK_HEADERS,$1 as MAP_EXT_TYPE,Y0 as GroovyTraversalSource,k0 as GroovyTraversal,G0 as EDir};

//# debugId=F257E2DAE0321A1864756e2164756e21
