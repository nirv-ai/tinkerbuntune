var D1=Object.create;var{defineProperty:u0,getPrototypeOf:k1,getOwnPropertyNames:x1}=Object;var E1=Object.prototype.hasOwnProperty;var d0=($,Z,J)=>{J=$!=null?D1(k1($)):{};const W=Z||!$||!$.__esModule?u0(J,"default",{value:$,enumerable:!0}):J;for(let U of x1($))if(!E1.call(W,U))u0(W,U,{get:()=>$[U],enumerable:!0});return W};var A=($,Z)=>()=>(Z||$((Z={exports:{}}).exports,Z),Z.exports);var j1=($)=>{return import.meta.require($)};var e=A((n0)=>{var _1=function($){const Z=$.length;let J=0,W=0;while(W<Z){let U=$.charCodeAt(W++);if((U&4294967168)===0){J++;continue}else if((U&4294965248)===0)J+=2;else{if(U>=55296&&U<=56319){if(W<Z){const V=$.charCodeAt(W);if((V&64512)===56320)++W,U=((U&1023)<<10)+(V&1023)+65536}}if((U&4294901760)===0)J+=3;else J+=4}}return J},c0=function($,Z,J){const W=$.length;let U=J,V=0;while(V<W){let X=$.charCodeAt(V++);if((X&4294967168)===0){Z[U++]=X;continue}else if((X&4294965248)===0)Z[U++]=X>>6&31|192;else{if(X>=55296&&X<=56319){if(V<W){const F=$.charCodeAt(V);if((F&64512)===56320)++V,X=((X&1023)<<10)+(F&1023)+65536}}if((X&4294901760)===0)Z[U++]=X>>12&15|224,Z[U++]=X>>6&63|128;else Z[U++]=X>>18&7|240,Z[U++]=X>>12&63|128,Z[U++]=X>>6&63|128}Z[U++]=X&63|128}},a0=function($,Z,J){g1.encodeInto($,Z.subarray(J))},v1=function($,Z,J){if($.length>y1)a0($,Z,J);else c0($,Z,J)},p0=function($,Z,J){let W=Z;const U=W+J,V=[];let X="";while(W<U){const F=$[W++];if((F&128)===0)V.push(F);else if((F&224)===192){const N=$[W++]&63;V.push((F&31)<<6|N)}else if((F&240)===224){const N=$[W++]&63,Q=$[W++]&63;V.push((F&31)<<12|N<<6|Q)}else if((F&248)===240){const N=$[W++]&63,Q=$[W++]&63,K=$[W++]&63;let I=(F&7)<<18|N<<12|Q<<6|K;if(I>65535)I-=65536,V.push(I>>>10&1023|55296),I=56320|I&1023;V.push(I)}else V.push(F);if(V.length>=h1)X+=String.fromCharCode(...V),V.length=0}if(V.length>0)X+=String.fromCharCode(...V);return X},i0=function($,Z,J){const W=$.subarray(Z,Z+J);return f1.decode(W)},b1=function($,Z,J){if(J>m1)return i0($,Z,J);else return p0($,Z,J)};Object.defineProperty(n0,"__esModule",{value:!0});n0.utf8Decode=n0.utf8DecodeTD=n0.utf8DecodeJs=n0.utf8Encode=n0.utf8EncodeTE=n0.utf8EncodeJs=n0.utf8Count=void 0;n0.utf8Count=_1;n0.utf8EncodeJs=c0;var g1=new TextEncoder,y1=50;n0.utf8EncodeTE=a0;n0.utf8Encode=v1;var h1=4096;n0.utf8DecodeJs=p0;var f1=new TextDecoder,m1=200;n0.utf8DecodeTD=i0;n0.utf8Decode=b1});var O0=A((t0)=>{Object.defineProperty(t0,"__esModule",{value:!0});t0.ExtData=void 0;class s0{constructor($,Z){this.type=$,this.data=Z}}t0.ExtData=s0});var Z0=A((e0)=>{Object.defineProperty(e0,"__esModule",{value:!0});e0.DecodeError=void 0;class $0 extends Error{constructor($){super($);const Z=Object.create($0.prototype);Object.setPrototypeOf(this,Z),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:$0.name})}}e0.DecodeError=$0});var W0=A((Z8)=>{var i1=function($,Z,J){const W=J/4294967296,U=J;$.setUint32(Z,W),$.setUint32(Z+4,U)},n1=function($,Z,J){const W=Math.floor(J/4294967296),U=J;$.setUint32(Z,W),$.setUint32(Z+4,U)},r1=function($,Z){const J=$.getInt32(Z),W=$.getUint32(Z+4);return J*4294967296+W},s1=function($,Z){const J=$.getUint32(Z),W=$.getUint32(Z+4);return J*4294967296+W};Object.defineProperty(Z8,"__esModule",{value:!0});Z8.getUint64=Z8.getInt64=Z8.setInt64=Z8.setUint64=Z8.UINT32_MAX=void 0;Z8.UINT32_MAX=4294967295;Z8.setUint64=i1;Z8.setInt64=n1;Z8.getInt64=r1;Z8.getUint64=s1});var S0=A((Q8)=>{var U8=function({sec:$,nsec:Z}){if($>=0&&Z>=0&&$<=J6)if(Z===0&&$<=W6){const J=new Uint8Array(4);return new DataView(J.buffer).setUint32(0,$),J}else{const J=$/4294967296,W=$&4294967295,U=new Uint8Array(8),V=new DataView(U.buffer);return V.setUint32(0,Z<<2|J&3),V.setUint32(4,W),U}else{const J=new Uint8Array(12),W=new DataView(J.buffer);return W.setUint32(0,Z),(0,J8.setInt64)(W,4,$),J}},V8=function($){const Z=$.getTime(),J=Math.floor(Z/1000),W=(Z-J*1000)*1e6,U=Math.floor(W/1e9);return{sec:J+U,nsec:W-U*1e9}},X8=function($){if($ instanceof Date){const Z=V8($);return U8(Z)}else return null},F8=function($){const Z=new DataView($.buffer,$.byteOffset,$.byteLength);switch($.byteLength){case 4:return{sec:Z.getUint32(0),nsec:0};case 8:{const J=Z.getUint32(0),W=Z.getUint32(4),U=(J&3)*4294967296+W,V=J>>>2;return{sec:U,nsec:V}}case 12:{const J=(0,J8.getInt64)(Z,4),W=Z.getUint32(0);return{sec:J,nsec:W}}default:throw new Z6.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${$.length}`)}},N8=function($){const Z=F8($);return new Date(Z.sec*1000+Z.nsec/1e6)};Object.defineProperty(Q8,"__esModule",{value:!0});Q8.timestampExtension=Q8.decodeTimestampExtension=Q8.decodeTimestampToTimeSpec=Q8.encodeTimestampExtension=Q8.encodeDateToTimeSpec=Q8.encodeTimeSpecToTimestamp=Q8.EXT_TIMESTAMP=void 0;var Z6=Z0(),J8=W0();Q8.EXT_TIMESTAMP=-1;var W6=4294967295,J6=17179869183;Q8.encodeTimeSpecToTimestamp=U8;Q8.encodeDateToTimeSpec=V8;Q8.encodeTimestampExtension=X8;Q8.decodeTimestampToTimeSpec=F8;Q8.decodeTimestampExtension=N8;Q8.timestampExtension={type:Q8.EXT_TIMESTAMP,encode:X8,decode:N8}});var V0=A((I8)=>{Object.defineProperty(I8,"__esModule",{value:!0});I8.ExtensionCodec=void 0;var J0=O0(),Q6=S0();class U0{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Q6.timestampExtension)}register({type:$,encode:Z,decode:J}){if($>=0)this.encoders[$]=Z,this.decoders[$]=J;else{const W=1+$;this.builtInEncoders[W]=Z,this.builtInDecoders[W]=J}}tryToEncode($,Z){for(let J=0;J<this.builtInEncoders.length;J++){const W=this.builtInEncoders[J];if(W!=null){const U=W($,Z);if(U!=null){const V=-1-J;return new J0.ExtData(V,U)}}}for(let J=0;J<this.encoders.length;J++){const W=this.encoders[J];if(W!=null){const U=W($,Z);if(U!=null){const V=J;return new J0.ExtData(V,U)}}}if($ instanceof J0.ExtData)return $;return null}decode($,Z,J){const W=Z<0?this.builtInDecoders[-1-Z]:this.decoders[Z];if(W)return W($,Z,J);else return new J0.ExtData(Z,$)}}U0.defaultCodec=new U0;I8.ExtensionCodec=U0});var A0=A((K8)=>{var M8=function($){if($ instanceof Uint8Array)return $;else if(ArrayBuffer.isView($))return new Uint8Array($.buffer,$.byteOffset,$.byteLength);else if($ instanceof ArrayBuffer)return new Uint8Array($);else return Uint8Array.from($)},G6=function($){if($ instanceof ArrayBuffer)return new DataView($);const Z=M8($);return new DataView(Z.buffer,Z.byteOffset,Z.byteLength)};Object.defineProperty(K8,"__esModule",{value:!0});K8.createDataView=K8.ensureUint8Array=void 0;K8.ensureUint8Array=M8;K8.createDataView=G6});var q0=A((S8)=>{Object.defineProperty(S8,"__esModule",{value:!0});S8.Encoder=S8.DEFAULT_INITIAL_BUFFER_SIZE=S8.DEFAULT_MAX_DEPTH=void 0;var P8=e(),I6=V0(),w8=W0(),H6=A0();S8.DEFAULT_MAX_DEPTH=100;S8.DEFAULT_INITIAL_BUFFER_SIZE=2048;class O8{constructor($){var Z,J,W,U,V,X,F,N;this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:I6.ExtensionCodec.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxDepth=(W=$===null||$===void 0?void 0:$.maxDepth)!==null&&W!==void 0?W:S8.DEFAULT_MAX_DEPTH,this.initialBufferSize=(U=$===null||$===void 0?void 0:$.initialBufferSize)!==null&&U!==void 0?U:S8.DEFAULT_INITIAL_BUFFER_SIZE,this.sortKeys=(V=$===null||$===void 0?void 0:$.sortKeys)!==null&&V!==void 0?V:!1,this.forceFloat32=(X=$===null||$===void 0?void 0:$.forceFloat32)!==null&&X!==void 0?X:!1,this.ignoreUndefined=(F=$===null||$===void 0?void 0:$.ignoreUndefined)!==null&&F!==void 0?F:!1,this.forceIntegerToFloat=(N=$===null||$===void 0?void 0:$.forceIntegerToFloat)!==null&&N!==void 0?N:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef($){return this.reinitializeState(),this.doEncode($,1),this.bytes.subarray(0,this.pos)}encode($){return this.reinitializeState(),this.doEncode($,1),this.bytes.slice(0,this.pos)}doEncode($,Z){if(Z>this.maxDepth)throw new Error(`Too deep objects in depth ${Z}`);if($==null)this.encodeNil();else if(typeof $==="boolean")this.encodeBoolean($);else if(typeof $==="number")if(!this.forceIntegerToFloat)this.encodeNumber($);else this.encodeNumberAsFloat($);else if(typeof $==="string")this.encodeString($);else if(this.useBigInt64&&typeof $==="bigint")this.encodeBigInt64($);else this.encodeObject($,Z)}ensureBufferSizeToWrite($){const Z=this.pos+$;if(this.view.byteLength<Z)this.resizeBuffer(Z*2)}resizeBuffer($){const Z=new ArrayBuffer($),J=new Uint8Array(Z),W=new DataView(Z);J.set(this.bytes),this.view=W,this.bytes=J}encodeNil(){this.writeU8(192)}encodeBoolean($){if($===!1)this.writeU8(194);else this.writeU8(195)}encodeNumber($){if(!this.forceIntegerToFloat&&Number.isSafeInteger($))if($>=0)if($<128)this.writeU8($);else if($<256)this.writeU8(204),this.writeU8($);else if($<65536)this.writeU8(205),this.writeU16($);else if($<4294967296)this.writeU8(206),this.writeU32($);else if(!this.useBigInt64)this.writeU8(207),this.writeU64($);else this.encodeNumberAsFloat($);else if($>=-32)this.writeU8(224|$+32);else if($>=-128)this.writeU8(208),this.writeI8($);else if($>=-32768)this.writeU8(209),this.writeI16($);else if($>=-2147483648)this.writeU8(210),this.writeI32($);else if(!this.useBigInt64)this.writeU8(211),this.writeI64($);else this.encodeNumberAsFloat($);else this.encodeNumberAsFloat($)}encodeNumberAsFloat($){if(this.forceFloat32)this.writeU8(202),this.writeF32($);else this.writeU8(203),this.writeF64($)}encodeBigInt64($){if($>=BigInt(0))this.writeU8(207),this.writeBigUint64($);else this.writeU8(211),this.writeBigInt64($)}writeStringHeader($){if($<32)this.writeU8(160+$);else if($<256)this.writeU8(217),this.writeU8($);else if($<65536)this.writeU8(218),this.writeU16($);else if($<4294967296)this.writeU8(219),this.writeU32($);else throw new Error(`Too long string: ${$} bytes in UTF-8`)}encodeString($){const J=(0,P8.utf8Count)($);this.ensureBufferSizeToWrite(5+J),this.writeStringHeader(J),(0,P8.utf8Encode)($,this.bytes,this.pos),this.pos+=J}encodeObject($,Z){const J=this.extensionCodec.tryToEncode($,this.context);if(J!=null)this.encodeExtension(J);else if(Array.isArray($))this.encodeArray($,Z);else if(ArrayBuffer.isView($))this.encodeBinary($);else if(typeof $==="object")this.encodeMap($,Z);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply($)}`)}encodeBinary($){const Z=$.byteLength;if(Z<256)this.writeU8(196),this.writeU8(Z);else if(Z<65536)this.writeU8(197),this.writeU16(Z);else if(Z<4294967296)this.writeU8(198),this.writeU32(Z);else throw new Error(`Too large binary: ${Z}`);const J=(0,H6.ensureUint8Array)($);this.writeU8a(J)}encodeArray($,Z){const J=$.length;if(J<16)this.writeU8(144+J);else if(J<65536)this.writeU8(220),this.writeU16(J);else if(J<4294967296)this.writeU8(221),this.writeU32(J);else throw new Error(`Too large array: ${J}`);for(let W of $)this.doEncode(W,Z+1)}countWithoutUndefined($,Z){let J=0;for(let W of Z)if($[W]!==void 0)J++;return J}encodeMap($,Z){const J=Object.keys($);if(this.sortKeys)J.sort();const W=this.ignoreUndefined?this.countWithoutUndefined($,J):J.length;if(W<16)this.writeU8(128+W);else if(W<65536)this.writeU8(222),this.writeU16(W);else if(W<4294967296)this.writeU8(223),this.writeU32(W);else throw new Error(`Too large map object: ${W}`);for(let U of J){const V=$[U];if(!(this.ignoreUndefined&&V===void 0))this.encodeString(U),this.doEncode(V,Z+1)}}encodeExtension($){const Z=$.data.length;if(Z===1)this.writeU8(212);else if(Z===2)this.writeU8(213);else if(Z===4)this.writeU8(214);else if(Z===8)this.writeU8(215);else if(Z===16)this.writeU8(216);else if(Z<256)this.writeU8(199),this.writeU8(Z);else if(Z<65536)this.writeU8(200),this.writeU16(Z);else if(Z<4294967296)this.writeU8(201),this.writeU32(Z);else throw new Error(`Too large extension object: ${Z}`);this.writeI8($.type),this.writeU8a($.data)}writeU8($){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,$),this.pos++}writeU8a($){const Z=$.length;this.ensureBufferSizeToWrite(Z),this.bytes.set($,this.pos),this.pos+=Z}writeI8($){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,$),this.pos++}writeU16($){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,$),this.pos+=2}writeI16($){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,$),this.pos+=2}writeU32($){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,$),this.pos+=4}writeI32($){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,$),this.pos+=4}writeF32($){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,$),this.pos+=4}writeF64($){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,$),this.pos+=8}writeU64($){this.ensureBufferSizeToWrite(8),(0,w8.setUint64)(this.view,this.pos,$),this.pos+=8}writeI64($){this.ensureBufferSizeToWrite(8),(0,w8.setInt64)(this.view,this.pos,$),this.pos+=8}writeBigUint64($){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,$),this.pos+=8}writeBigInt64($){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,$),this.pos+=8}}S8.Encoder=O8});var z8=A((T8)=>{var K6=function($,Z){return new M6.Encoder(Z).encodeSharedRef($)};Object.defineProperty(T8,"__esModule",{value:!0});T8.encode=T8.defaultEncodeOptions=void 0;var M6=q0();T8.defaultEncodeOptions=void 0;T8.encode=K6});var k8=A((L8)=>{var P6=function($){return`${$<0?"-":""}0x${Math.abs($).toString(16).padStart(2,"0")}`};Object.defineProperty(L8,"__esModule",{value:!0});L8.prettyByte=void 0;L8.prettyByte=P6});var _8=A((E8)=>{Object.defineProperty(E8,"__esModule",{value:!0});E8.CachedKeyDecoder=void 0;var w6=e(),O6=16,S6=16;class x8{constructor($=O6,Z=S6){this.maxKeyLength=$,this.maxLengthPerKey=Z,this.hit=0,this.miss=0,this.caches=[];for(let J=0;J<this.maxKeyLength;J++)this.caches.push([])}canBeCached($){return $>0&&$<=this.maxKeyLength}find($,Z,J){const W=this.caches[J-1];$:for(let U of W){const V=U.bytes;for(let X=0;X<J;X++)if(V[X]!==$[Z+X])continue $;return U.str}return null}store($,Z){const J=this.caches[$.length-1],W={bytes:$,str:Z};if(J.length>=this.maxLengthPerKey)J[Math.random()*J.length|0]=W;else J.push(W)}decode($,Z,J){const W=this.find($,Z,J);if(W!=null)return this.hit++,W;this.miss++;const U=(0,w6.utf8DecodeJs)($,Z,J),V=Uint8Array.prototype.slice.call($,Z,Z+J);return this.store(V,U),U}}E8.CachedKeyDecoder=x8});var N0=A((h8)=>{Object.defineProperty(h8,"__esModule",{value:!0});h8.Decoder=h8.DataViewIndexOutOfBoundsError=void 0;var B0=k8(),A6=V0(),v=W0(),q6=e(),T0=A0(),B6=_8(),x=Z0(),g8="array",X0="map_key",T6="map_value",C6=($)=>{return typeof $==="string"||typeof $==="number"},p=-1,C0=new DataView(new ArrayBuffer(0)),z6=new Uint8Array(C0.buffer);try{C0.getInt8(0)}catch($){if(!($ instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}h8.DataViewIndexOutOfBoundsError=RangeError;var y8=new h8.DataViewIndexOutOfBoundsError("Insufficient data"),L6=new B6.CachedKeyDecoder;class v8{constructor($){var Z,J,W,U,V,X,F;this.totalPos=0,this.pos=0,this.view=C0,this.bytes=z6,this.headByte=p,this.stack=[],this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:A6.ExtensionCodec.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxStrLength=(W=$===null||$===void 0?void 0:$.maxStrLength)!==null&&W!==void 0?W:v.UINT32_MAX,this.maxBinLength=(U=$===null||$===void 0?void 0:$.maxBinLength)!==null&&U!==void 0?U:v.UINT32_MAX,this.maxArrayLength=(V=$===null||$===void 0?void 0:$.maxArrayLength)!==null&&V!==void 0?V:v.UINT32_MAX,this.maxMapLength=(X=$===null||$===void 0?void 0:$.maxMapLength)!==null&&X!==void 0?X:v.UINT32_MAX,this.maxExtLength=(F=$===null||$===void 0?void 0:$.maxExtLength)!==null&&F!==void 0?F:v.UINT32_MAX,this.keyDecoder=($===null||$===void 0?void 0:$.keyDecoder)!==void 0?$.keyDecoder:L6}reinitializeState(){this.totalPos=0,this.headByte=p,this.stack.length=0}setBuffer($){this.bytes=(0,T0.ensureUint8Array)($),this.view=(0,T0.createDataView)(this.bytes),this.pos=0}appendBuffer($){if(this.headByte===p&&!this.hasRemaining(1))this.setBuffer($);else{const Z=this.bytes.subarray(this.pos),J=(0,T0.ensureUint8Array)($),W=new Uint8Array(Z.length+J.length);W.set(Z),W.set(J,Z.length),this.setBuffer(W)}}hasRemaining($){return this.view.byteLength-this.pos>=$}createExtraByteError($){const{view:Z,pos:J}=this;return new RangeError(`Extra ${Z.byteLength-J} of ${Z.byteLength} byte(s) found at buffer[${$}]`)}decode($){this.reinitializeState(),this.setBuffer($);const Z=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return Z}*decodeMulti($){this.reinitializeState(),this.setBuffer($);while(this.hasRemaining(1))yield this.doDecodeSync()}async decodeAsync($){let Z=!1,J;for await(let X of $){if(Z)throw this.createExtraByteError(this.totalPos);this.appendBuffer(X);try{J=this.doDecodeSync(),Z=!0}catch(F){if(!(F instanceof h8.DataViewIndexOutOfBoundsError))throw F}this.totalPos+=this.pos}if(Z){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return J}const{headByte:W,pos:U,totalPos:V}=this;throw new RangeError(`Insufficient data in parsing ${(0,B0.prettyByte)(W)} at ${V} (${U} in the current buffer)`)}decodeArrayStream($){return this.decodeMultiAsync($,!0)}decodeStream($){return this.decodeMultiAsync($,!1)}async*decodeMultiAsync($,Z){let J=Z,W=-1;for await(let U of $){if(Z&&W===0)throw this.createExtraByteError(this.totalPos);if(this.appendBuffer(U),J)W=this.readArraySize(),J=!1,this.complete();try{while(!0)if(yield this.doDecodeSync(),--W===0)break}catch(V){if(!(V instanceof h8.DataViewIndexOutOfBoundsError))throw V}this.totalPos+=this.pos}}doDecodeSync(){$:while(!0){const $=this.readHeadByte();let Z;if($>=224)Z=$-256;else if($<192)if($<128)Z=$;else if($<144){const W=$-128;if(W!==0){this.pushMapState(W),this.complete();continue $}else Z={}}else if($<160){const W=$-144;if(W!==0){this.pushArrayState(W),this.complete();continue $}else Z=[]}else{const W=$-160;Z=this.decodeUtf8String(W,0)}else if($===192)Z=null;else if($===194)Z=!1;else if($===195)Z=!0;else if($===202)Z=this.readF32();else if($===203)Z=this.readF64();else if($===204)Z=this.readU8();else if($===205)Z=this.readU16();else if($===206)Z=this.readU32();else if($===207)if(this.useBigInt64)Z=this.readU64AsBigInt();else Z=this.readU64();else if($===208)Z=this.readI8();else if($===209)Z=this.readI16();else if($===210)Z=this.readI32();else if($===211)if(this.useBigInt64)Z=this.readI64AsBigInt();else Z=this.readI64();else if($===217){const W=this.lookU8();Z=this.decodeUtf8String(W,1)}else if($===218){const W=this.lookU16();Z=this.decodeUtf8String(W,2)}else if($===219){const W=this.lookU32();Z=this.decodeUtf8String(W,4)}else if($===220){const W=this.readU16();if(W!==0){this.pushArrayState(W),this.complete();continue $}else Z=[]}else if($===221){const W=this.readU32();if(W!==0){this.pushArrayState(W),this.complete();continue $}else Z=[]}else if($===222){const W=this.readU16();if(W!==0){this.pushMapState(W),this.complete();continue $}else Z={}}else if($===223){const W=this.readU32();if(W!==0){this.pushMapState(W),this.complete();continue $}else Z={}}else if($===196){const W=this.lookU8();Z=this.decodeBinary(W,1)}else if($===197){const W=this.lookU16();Z=this.decodeBinary(W,2)}else if($===198){const W=this.lookU32();Z=this.decodeBinary(W,4)}else if($===212)Z=this.decodeExtension(1,0);else if($===213)Z=this.decodeExtension(2,0);else if($===214)Z=this.decodeExtension(4,0);else if($===215)Z=this.decodeExtension(8,0);else if($===216)Z=this.decodeExtension(16,0);else if($===199){const W=this.lookU8();Z=this.decodeExtension(W,1)}else if($===200){const W=this.lookU16();Z=this.decodeExtension(W,2)}else if($===201){const W=this.lookU32();Z=this.decodeExtension(W,4)}else throw new x.DecodeError(`Unrecognized type byte: ${(0,B0.prettyByte)($)}`);this.complete();const J=this.stack;while(J.length>0){const W=J[J.length-1];if(W.type===g8)if(W.array[W.position]=Z,W.position++,W.position===W.size)J.pop(),Z=W.array;else continue $;else if(W.type===X0){if(!C6(Z))throw new x.DecodeError("The type of key must be string or number but "+typeof Z);if(Z==="__proto__")throw new x.DecodeError("The key __proto__ is not allowed");W.key=Z,W.type=T6;continue $}else if(W.map[W.key]=Z,W.readCount++,W.readCount===W.size)J.pop(),Z=W.map;else{W.key=null,W.type=X0;continue $}}return Z}}readHeadByte(){if(this.headByte===p)this.headByte=this.readU8();return this.headByte}complete(){this.headByte=p}readArraySize(){const $=this.readHeadByte();switch($){case 220:return this.readU16();case 221:return this.readU32();default:if($<160)return $-144;else throw new x.DecodeError(`Unrecognized array type byte: ${(0,B0.prettyByte)($)}`)}}pushMapState($){if($>this.maxMapLength)throw new x.DecodeError(`Max length exceeded: map length (${$}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:X0,size:$,key:null,readCount:0,map:{}})}pushArrayState($){if($>this.maxArrayLength)throw new x.DecodeError(`Max length exceeded: array length (${$}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:g8,size:$,array:new Array($),position:0})}decodeUtf8String($,Z){var J;if($>this.maxStrLength)throw new x.DecodeError(`Max length exceeded: UTF-8 byte length (${$}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+Z+$)throw y8;const W=this.pos+Z;let U;if(this.stateIsMapKey()&&((J=this.keyDecoder)===null||J===void 0?void 0:J.canBeCached($)))U=this.keyDecoder.decode(this.bytes,W,$);else U=(0,q6.utf8Decode)(this.bytes,W,$);return this.pos+=Z+$,U}stateIsMapKey(){if(this.stack.length>0)return this.stack[this.stack.length-1].type===X0;return!1}decodeBinary($,Z){if($>this.maxBinLength)throw new x.DecodeError(`Max length exceeded: bin length (${$}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining($+Z))throw y8;const J=this.pos+Z,W=this.bytes.subarray(J,J+$);return this.pos+=Z+$,W}decodeExtension($,Z){if($>this.maxExtLength)throw new x.DecodeError(`Max length exceeded: ext length (${$}) > maxExtLength (${this.maxExtLength})`);const J=this.view.getInt8(this.pos+Z),W=this.decodeBinary($,Z+1);return this.extensionCodec.decode(W,J,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const $=this.view.getUint8(this.pos);return this.pos++,$}readI8(){const $=this.view.getInt8(this.pos);return this.pos++,$}readU16(){const $=this.view.getUint16(this.pos);return this.pos+=2,$}readI16(){const $=this.view.getInt16(this.pos);return this.pos+=2,$}readU32(){const $=this.view.getUint32(this.pos);return this.pos+=4,$}readI32(){const $=this.view.getInt32(this.pos);return this.pos+=4,$}readU64(){const $=(0,v.getUint64)(this.view,this.pos);return this.pos+=8,$}readI64(){const $=(0,v.getInt64)(this.view,this.pos);return this.pos+=8,$}readU64AsBigInt(){const $=this.view.getBigUint64(this.pos);return this.pos+=8,$}readI64AsBigInt(){const $=this.view.getBigInt64(this.pos);return this.pos+=8,$}readF32(){const $=this.view.getFloat32(this.pos);return this.pos+=4,$}readF64(){const $=this.view.getFloat64(this.pos);return this.pos+=8,$}}h8.Decoder=v8});var u8=A((b8)=>{var D6=function($,Z){return new m8.Decoder(Z).decode($)},k6=function($,Z){return new m8.Decoder(Z).decodeMulti($)};Object.defineProperty(b8,"__esModule",{value:!0});b8.decodeMulti=b8.decode=b8.defaultDecodeOptions=void 0;var m8=N0();b8.defaultDecodeOptions=void 0;b8.decode=D6;b8.decodeMulti=k6});var i8=A((a8)=>{var d8=function($){return $[Symbol.asyncIterator]!=null},j6=function($){if($==null)throw new Error("Assertion Failure: value must not be null nor undefined")};async function*c8($){const Z=$.getReader();try{while(!0){const{done:J,value:W}=await Z.read();if(J)return;j6(W),yield W}}finally{Z.releaseLock()}}var _6=function($){if(d8($))return $;else return c8($)};Object.defineProperty(a8,"__esModule",{value:!0});a8.ensureAsyncIterable=a8.asyncIterableFromStream=a8.isAsyncIterable=void 0;a8.isAsyncIterable=d8;a8.asyncIterableFromStream=c8;a8.ensureAsyncIterable=_6});var s8=A((n8)=>{async function v6($,Z){const J=(0,L0.ensureAsyncIterable)($);return new z0.Decoder(Z).decodeAsync(J)}var h6=function($,Z){const J=(0,L0.ensureAsyncIterable)($);return new z0.Decoder(Z).decodeArrayStream(J)},f6=function($,Z){const J=(0,L0.ensureAsyncIterable)($);return new z0.Decoder(Z).decodeStream(J)};Object.defineProperty(n8,"__esModule",{value:!0});n8.decodeStream=n8.decodeMultiStream=n8.decodeArrayStream=n8.decodeAsync=void 0;var z0=N0(),L0=i8();n8.decodeAsync=v6;n8.decodeArrayStream=h6;n8.decodeMultiStream=f6;n8.decodeStream=void 0});var e8=A((P)=>{Object.defineProperty(P,"__esModule",{value:!0});P.decodeTimestampExtension=P.encodeTimestampExtension=P.decodeTimestampToTimeSpec=P.encodeTimeSpecToTimestamp=P.encodeDateToTimeSpec=P.EXT_TIMESTAMP=P.ExtData=P.ExtensionCodec=P.Encoder=P.DecodeError=P.DataViewIndexOutOfBoundsError=P.Decoder=P.decodeStream=P.decodeMultiStream=P.decodeArrayStream=P.decodeAsync=P.decodeMulti=P.decode=P.encode=void 0;var u6=z8();Object.defineProperty(P,"encode",{enumerable:!0,get:function(){return u6.encode}});var t8=u8();Object.defineProperty(P,"decode",{enumerable:!0,get:function(){return t8.decode}});Object.defineProperty(P,"decodeMulti",{enumerable:!0,get:function(){return t8.decodeMulti}});var Q0=s8();Object.defineProperty(P,"decodeAsync",{enumerable:!0,get:function(){return Q0.decodeAsync}});Object.defineProperty(P,"decodeArrayStream",{enumerable:!0,get:function(){return Q0.decodeArrayStream}});Object.defineProperty(P,"decodeMultiStream",{enumerable:!0,get:function(){return Q0.decodeMultiStream}});Object.defineProperty(P,"decodeStream",{enumerable:!0,get:function(){return Q0.decodeStream}});var o8=N0();Object.defineProperty(P,"Decoder",{enumerable:!0,get:function(){return o8.Decoder}});Object.defineProperty(P,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return o8.DataViewIndexOutOfBoundsError}});var d6=Z0();Object.defineProperty(P,"DecodeError",{enumerable:!0,get:function(){return d6.DecodeError}});var c6=q0();Object.defineProperty(P,"Encoder",{enumerable:!0,get:function(){return c6.Encoder}});var a6=V0();Object.defineProperty(P,"ExtensionCodec",{enumerable:!0,get:function(){return a6.ExtensionCodec}});var p6=O0();Object.defineProperty(P,"ExtData",{enumerable:!0,get:function(){return p6.ExtData}});var l=S0();Object.defineProperty(P,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return l.EXT_TIMESTAMP}});Object.defineProperty(P,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return l.encodeDateToTimeSpec}});Object.defineProperty(P,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return l.encodeTimeSpecToTimestamp}});Object.defineProperty(P,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return l.decodeTimestampToTimeSpec}});Object.defineProperty(P,"encodeTimestampExtension",{enumerable:!0,get:function(){return l.encodeTimestampExtension}});Object.defineProperty(P,"decodeTimestampExtension",{enumerable:!0,get:function(){return l.decodeTimestampExtension}})});var g=d0(e8(),1);function D0($){const Z=Object.create(null),J=Reflect.ownKeys($).filter((W)=>typeof W==="string");for(let W of J){const U=$[W];Z[W]=U&&U instanceof Object?D0(U):U}return Object.freeze(Z)}function $1($){return Array.from($).reduce((Z,[J,W])=>{return Z[J]=W instanceof Map?$1(W):W,Z},Object.create(null))}function n6($,Z){if(Z instanceof Map)return Object.fromEntries(Z.entries());else return Z}var G0=import.meta.resolveSync("bun:jsc")&&await import("bun:jsc"),PZ=($)=>D0($1($)),wZ=($)=>JSON.stringify($,n6),OZ=($)=>{if(!G0)throw new Error("toBunBuffer requires the bun runtime");return G0.serialize($)},SZ=($)=>{if(!G0)throw new Error("fromBunBuffer requires the bun runtime");return G0.deserialize($)},Z1={encode:g.encode},h={decode:g.decode,decodeAsync:g.decodeAsync},L=new g.ExtensionCodec,r6={"Content-Type":"application/x-msgpack"},s6=0;L.register({type:s6,encode:($)=>{if($ instanceof Set)return Z1.encode([...$],{extensionCodec:L});else return null},decode:($)=>{const Z=h.decode($,{extensionCodec:L});return new Set(Z)},decodeAsync:async($)=>{const Z=await h.decodeAsync($,{extensionCodec:L});return new Set(Z)}});var W1=1;L.register({type:W1,encode:($)=>{if($ instanceof Map)return Z1.encode([...$],{extensionCodec:L});else return null},decode:($)=>{const Z=h.decode($,{extensionCodec:L});return new Map(Z)},decodeAsync:async($)=>{const Z=await h.decodeAsync($,{extensionCodec:L});return new Map(Z)}});var J1=($)=>{return $.reduce((Z,[J,W])=>{return Z[J]=W?.type===W1&&W?.data instanceof Uint8Array?J1(h.decode(W.data,{extensionCodec:L})):W,Z},Object.create(null))},AZ=async($)=>{if($.headers.get("Content-Type")!==r6["Content-Type"]||!$.body)return null;return D0(J1(h.decode((await h.decodeAsync($.body,{extensionCodec:L})).data,{extensionCodec:L})))};import C from"gremlin";var q=C.process.statics,Y0;(function(J){J["out"]="out";J["in"]="in"})(Y0||(Y0={}));var t6=($)=>{const Z={both:q.both,bothE:q.bothE,bothV:q.bothV,otherV:q.otherV,inV:q.inV,outV:q.outV,inE:q.inE,in:q.in_,outE:q.outE,out:q.out};switch($){case Y0.in:return{...Z,to:{e:q.inE,v:q.in_}};case Y0.out:return{...Z,to:{e:q.outE,v:q.out}};default:throw new Error(`invalid: ${$}\nexpected an EDir}`)}},D={...C.process,gremlin:C,p:C.process.P,traversal:C.process.AnonymousTraversalSource.traversal,DriverRemoteConnection:C.driver.DriverRemoteConnection,__:q,textp:C.process.TextP,Direction:{BOTH:C.process.direction.both,from_:C.process.direction.in,IN:C.process.direction.in,OUT:C.process.direction.out,to:C.process.direction.out},go:t6};["P","AnonymousTraversalSource","statics","driver","TextP","direction"].forEach(($)=>delete D[$]);import k0 from"gremlin";var $$=function(){return new x0(null,null,new k0.process.Bytecode)},{GraphTraversal:o6,GraphTraversalSource:e6}=k0.process;class x0 extends o6{constructor($,Z,J){super($,Z,J)}keys(){return this.valueMap().select(k0.process.column.keys)}next(){return super.next()}nextMap(){return this.next()}}var DZ=()=>$$().keys();class I0 extends e6{constructor($,Z,J){super($,Z,J,I0,x0)}}import U1 from"stream";import W$ from"util";var E0=($)=>{return{start_time:$.duration?Date.now():null,fixed_size_buffer:"",count_written:0,count_created:0}};var i=function($={}){if($.seed)return $.seed=$.seed*Math.PI*100%100/100;else return Math.random()};var j0={ascii:function({options:$}){const Z=[],J=Math.ceil(i($)*$.maxWordLength);for(let W=0;W<J;W++){const U=Math.floor(i($)*32);Z.push(String.fromCharCode(U+(U<16?65:81)))}return Z.join("")},int:function({options:$}){return Math.floor(i($)*Math.pow(2,52))},bool:function({options:$}){return Math.floor(i($)*2)}};var Z$=function($){return $.replace(/_([a-z])/gi,function(Z,J){return J.toUpperCase()})},_0=($)=>{if($.object_mode)$.objectMode=$.object_mode;if($.high_water_mark)$.highWaterMark=$.high_water_mark;const Z={};for(let U in $)Z[Z$(U)]=$[U];const J={columns:8,delimiter:",",duration:null,encoding:null,end:null,eof:!1,fixedSize:!1,length:-1,maxWordLength:16,rowDelimiter:"\n",seed:!1,sleep:0};for(let U in J)if(Z[U]===void 0)Z[U]=J[U];if(Z.eof===!0)Z.eof=Z.rowDelimiter;if(typeof Z.columns==="number")Z.columns=new Array(Z.columns);const W=Object.keys(j0).filter((U)=>!["super_","camelize"].includes(U));for(let U=0;U<Z.columns.length;U++){const V=Z.columns[U]||"ascii";if(typeof V==="string"){if(!W.includes(V))throw Error(`Invalid column type: got "${V}", default values are ${JSON.stringify(W)}`);Z.columns[U]=j0[V]}}return Z};var g0=($,Z,J,W,U)=>{const V=[];let X=0;if($.fixedSize){if(X=Z.fixed_size_buffer.length,X!==0)V.push(Z.fixed_size_buffer)}while(!0){if(Z.count_created===$.length||$.end&&Date.now()>$.end||$.duration&&Date.now()>Z.start_time+$.duration){if(V.length){if($.objectMode)for(let Q of V)W(Q);else W(V.join("")+($.eof?$.eof:""));Z.end=!0}else U();return}let F=[],N;for(let Q of $.columns){const K=Q({options:$,state:Z}),I=typeof K;if(K!==null&&I!=="string"&&I!=="number"){U(Error(["INVALID_VALUE:","values returned by column function must be","a string, a number or null,",`got ${JSON.stringify(K)}`].join(" ")));return}F.push(K)}if($.objectMode){N=0;for(let Q of F)N+=Q.length}else F=(Z.count_created===0?"":$.rowDelimiter)+F.join($.delimiter),N=F.length;if(Z.count_created++,X+N>J){if($.objectMode){V.push(F);for(let Q of V)W(Q)}else{if($.fixedSize)Z.fixed_size_buffer=F.substr(J-X),V.push(F.substr(0,J-X));else V.push(F);W(V.join(""))}return}X+=N,V.push(F)}};var u=function($={}){return this.options=_0($),U1.Readable.call(this,this.options),this.state=E0(this.options),this};W$.inherits(u,U1.Readable);u.prototype.end=function(){this.push(null)};u.prototype._read=function($){setImmediate(()=>{this.__read($)})};u.prototype.__read=function($){g0(this.options,this.state,$,(Z)=>{this.__push(Z)},(Z)=>{if(Z)this.destroy(Z);else this.push(null)})};u.prototype.__push=function($){const Z=()=>{if(this.state.count_written++,this.push($),this.state.end===!0)return this.push(null)};this.options.sleep>0?setTimeout(Z,this.options.sleep):Z()};class Y extends Error{constructor($,Z,J,...W){if(Array.isArray(Z))Z=Z.join(" ").trim();super(Z);if(Error.captureStackTrace!==void 0)Error.captureStackTrace(this,Y);this.code=$;for(let U of W)for(let V in U){const X=U[V];this[V]=Buffer.isBuffer(X)?X.toString(J.encoding):X==null?X:JSON.parse(JSON.stringify(X))}}}var V1=function($){return typeof $==="object"&&$!==null&&!Array.isArray($)};var H0=function($){const Z=[];for(let J=0,W=$.length;J<W;J++){const U=$[J];if(U===void 0||U===null||U===!1)Z[J]={disabled:!0};else if(typeof U==="string")Z[J]={name:U};else if(V1(U)){if(typeof U.name!=="string")throw new Y("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${J}`,"when column is an object literal"]);Z[J]=U}else throw new Y("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(U)} at position ${J}`])}return Z};class X1{constructor($=100){this.size=$,this.length=0,this.buf=Buffer.allocUnsafe($)}prepend($){if(Buffer.isBuffer($)){const Z=this.length+$.length;if(Z>=this.size){if(this.resize(),Z>=this.size)throw Error("INVALID_BUFFER_STATE")}const J=this.buf;this.buf=Buffer.allocUnsafe(this.size),$.copy(this.buf,0),J.copy(this.buf,$.length),this.length+=$.length}else{const Z=this.length++;if(Z===this.size)this.resize();const J=this.clone();this.buf[0]=$,J.copy(this.buf,1,0,Z)}}append($){const Z=this.length++;if(Z===this.size)this.resize();this.buf[Z]=$}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const $=this.length;this.size=this.size*2;const Z=Buffer.allocUnsafe(this.size);this.buf.copy(Z,0,0,$),this.buf=Z}toString($){if($)return this.buf.slice(0,this.length).toString($);else return Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}var y0=X1;var J$=12,U$=13,V$=10,X$=32,F$=9,F1=function($){return{bomSkipped:!1,bufBytesStart:0,castField:$.cast_function,commenting:!1,error:void 0,enabled:$.from_line===1,escaping:!1,escapeIsQuote:Buffer.isBuffer($.escape)&&Buffer.isBuffer($.quote)&&Buffer.compare($.escape,$.quote)===0,expectedRecordLength:Array.isArray($.columns)?$.columns.length:void 0,field:new y0(20),firstLineToHeaders:$.cast_first_line_to_header,needMoreDataSize:Math.max($.comment!==null?$.comment.length:0,...$.delimiter.map((Z)=>Z.length),$.quote!==null?$.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new y0(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:$.record_delimiter.length===0?0:Math.max(...$.record_delimiter.map((Z)=>Z.length)),trimChars:[Buffer.from(" ",$.encoding)[0],Buffer.from("\t",$.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([U$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([V$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([J$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([X$],"utf8").toString(),$.encoding),Buffer.from(Buffer.from([F$],"utf8").toString(),$.encoding)]}};var N1=function($){return $.replace(/([A-Z])/g,function(Z,J){return"_"+J.toLowerCase()})};var v0=function($){const Z={};for(let W in $)Z[N1(W)]=$[W];if(Z.encoding===void 0||Z.encoding===!0)Z.encoding="utf8";else if(Z.encoding===null||Z.encoding===!1)Z.encoding=null;else if(typeof Z.encoding!=="string"&&Z.encoding!==null)throw new Y("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(Z.encoding)}`],Z);if(Z.bom===void 0||Z.bom===null||Z.bom===!1)Z.bom=!1;else if(Z.bom!==!0)throw new Y("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(Z.bom)}`],Z);if(Z.cast_function=null,Z.cast===void 0||Z.cast===null||Z.cast===!1||Z.cast==="")Z.cast=void 0;else if(typeof Z.cast==="function")Z.cast_function=Z.cast,Z.cast=!0;else if(Z.cast!==!0)throw new Y("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(Z.cast)}`],Z);if(Z.cast_date===void 0||Z.cast_date===null||Z.cast_date===!1||Z.cast_date==="")Z.cast_date=!1;else if(Z.cast_date===!0)Z.cast_date=function(W){const U=Date.parse(W);return!isNaN(U)?new Date(U):W};else if(typeof Z.cast_date!=="function")throw new Y("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(Z.cast_date)}`],Z);if(Z.cast_first_line_to_header=null,Z.columns===!0)Z.cast_first_line_to_header=void 0;else if(typeof Z.columns==="function")Z.cast_first_line_to_header=Z.columns,Z.columns=!0;else if(Array.isArray(Z.columns))Z.columns=H0(Z.columns);else if(Z.columns===void 0||Z.columns===null||Z.columns===!1)Z.columns=!1;else throw new Y("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(Z.columns)}`],Z);if(Z.group_columns_by_name===void 0||Z.group_columns_by_name===null||Z.group_columns_by_name===!1)Z.group_columns_by_name=!1;else if(Z.group_columns_by_name!==!0)throw new Y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(Z.group_columns_by_name)}`],Z);else if(Z.columns===!1)throw new Y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],Z);if(Z.comment===void 0||Z.comment===null||Z.comment===!1||Z.comment==="")Z.comment=null;else{if(typeof Z.comment==="string")Z.comment=Buffer.from(Z.comment,Z.encoding);if(!Buffer.isBuffer(Z.comment))throw new Y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(Z.comment)}`],Z)}if(Z.comment_no_infix===void 0||Z.comment_no_infix===null||Z.comment_no_infix===!1)Z.comment_no_infix=!1;else if(Z.comment_no_infix!==!0)throw new Y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(Z.comment_no_infix)}`],Z);const J=JSON.stringify(Z.delimiter);if(!Array.isArray(Z.delimiter))Z.delimiter=[Z.delimiter];if(Z.delimiter.length===0)throw new Y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${J}`],Z);if(Z.delimiter=Z.delimiter.map(function(W){if(W===void 0||W===null||W===!1)return Buffer.from(",",Z.encoding);if(typeof W==="string")W=Buffer.from(W,Z.encoding);if(!Buffer.isBuffer(W)||W.length===0)throw new Y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${J}`],Z);return W}),Z.escape===void 0||Z.escape===!0)Z.escape=Buffer.from('"',Z.encoding);else if(typeof Z.escape==="string")Z.escape=Buffer.from(Z.escape,Z.encoding);else if(Z.escape===null||Z.escape===!1)Z.escape=null;if(Z.escape!==null){if(!Buffer.isBuffer(Z.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(Z.escape)}`)}if(Z.from===void 0||Z.from===null)Z.from=1;else{if(typeof Z.from==="string"&&/\d+/.test(Z.from))Z.from=parseInt(Z.from);if(Number.isInteger(Z.from)){if(Z.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify($.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(Z.from)}`)}if(Z.from_line===void 0||Z.from_line===null)Z.from_line=1;else{if(typeof Z.from_line==="string"&&/\d+/.test(Z.from_line))Z.from_line=parseInt(Z.from_line);if(Number.isInteger(Z.from_line)){if(Z.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify($.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify($.from_line)}`)}if(Z.ignore_last_delimiters===void 0||Z.ignore_last_delimiters===null)Z.ignore_last_delimiters=!1;else if(typeof Z.ignore_last_delimiters==="number"){if(Z.ignore_last_delimiters=Math.floor(Z.ignore_last_delimiters),Z.ignore_last_delimiters===0)Z.ignore_last_delimiters=!1}else if(typeof Z.ignore_last_delimiters!=="boolean")throw new Y("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(Z.ignore_last_delimiters)}`],Z);if(Z.ignore_last_delimiters===!0&&Z.columns===!1)throw new Y("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],Z);if(Z.info===void 0||Z.info===null||Z.info===!1)Z.info=!1;else if(Z.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(Z.info)}`);if(Z.max_record_size===void 0||Z.max_record_size===null||Z.max_record_size===!1)Z.max_record_size=0;else if(Number.isInteger(Z.max_record_size)&&Z.max_record_size>=0);else if(typeof Z.max_record_size==="string"&&/\d+/.test(Z.max_record_size))Z.max_record_size=parseInt(Z.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(Z.max_record_size)}`);if(Z.objname===void 0||Z.objname===null||Z.objname===!1)Z.objname=void 0;else if(Buffer.isBuffer(Z.objname)){if(Z.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");if(Z.encoding===null);else Z.objname=Z.objname.toString(Z.encoding)}else if(typeof Z.objname==="string"){if(Z.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof Z.objname==="number");else throw new Error(`Invalid Option: objname must be a string or a buffer, got ${Z.objname}`);if(Z.objname!==void 0){if(typeof Z.objname==="number"){if(Z.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(Z.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(Z.on_record===void 0||Z.on_record===null)Z.on_record=void 0;else if(typeof Z.on_record!=="function")throw new Y("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(Z.on_record)}`],Z);if(Z.quote===null||Z.quote===!1||Z.quote==="")Z.quote=null;else{if(Z.quote===void 0||Z.quote===!0)Z.quote=Buffer.from('"',Z.encoding);else if(typeof Z.quote==="string")Z.quote=Buffer.from(Z.quote,Z.encoding);if(!Buffer.isBuffer(Z.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(Z.quote)}`)}if(Z.raw===void 0||Z.raw===null||Z.raw===!1)Z.raw=!1;else if(Z.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(Z.raw)}`);if(Z.record_delimiter===void 0)Z.record_delimiter=[];else if(typeof Z.record_delimiter==="string"||Buffer.isBuffer(Z.record_delimiter)){if(Z.record_delimiter.length===0)throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(Z.record_delimiter)}`],Z);Z.record_delimiter=[Z.record_delimiter]}else if(!Array.isArray(Z.record_delimiter))throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(Z.record_delimiter)}`],Z);if(Z.record_delimiter=Z.record_delimiter.map(function(W,U){if(typeof W!=="string"&&!Buffer.isBuffer(W))throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${U},`,`got ${JSON.stringify(W)}`],Z);else if(W.length===0)throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${U},`,`got ${JSON.stringify(W)}`],Z);if(typeof W==="string")W=Buffer.from(W,Z.encoding);return W}),typeof Z.relax_column_count==="boolean");else if(Z.relax_column_count===void 0||Z.relax_column_count===null)Z.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(Z.relax_column_count)}`);if(typeof Z.relax_column_count_less==="boolean");else if(Z.relax_column_count_less===void 0||Z.relax_column_count_less===null)Z.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(Z.relax_column_count_less)}`);if(typeof Z.relax_column_count_more==="boolean");else if(Z.relax_column_count_more===void 0||Z.relax_column_count_more===null)Z.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(Z.relax_column_count_more)}`);if(typeof Z.relax_quotes==="boolean");else if(Z.relax_quotes===void 0||Z.relax_quotes===null)Z.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(Z.relax_quotes)}`);if(typeof Z.skip_empty_lines==="boolean");else if(Z.skip_empty_lines===void 0||Z.skip_empty_lines===null)Z.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(Z.skip_empty_lines)}`);if(typeof Z.skip_records_with_empty_values==="boolean");else if(Z.skip_records_with_empty_values===void 0||Z.skip_records_with_empty_values===null)Z.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(Z.skip_records_with_empty_values)}`);if(typeof Z.skip_records_with_error==="boolean");else if(Z.skip_records_with_error===void 0||Z.skip_records_with_error===null)Z.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(Z.skip_records_with_error)}`);if(Z.rtrim===void 0||Z.rtrim===null||Z.rtrim===!1)Z.rtrim=!1;else if(Z.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(Z.rtrim)}`);if(Z.ltrim===void 0||Z.ltrim===null||Z.ltrim===!1)Z.ltrim=!1;else if(Z.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(Z.ltrim)}`);if(Z.trim===void 0||Z.trim===null||Z.trim===!1)Z.trim=!1;else if(Z.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(Z.trim)}`);if(Z.trim===!0&&$.ltrim!==!1)Z.ltrim=!0;else if(Z.ltrim!==!0)Z.ltrim=!1;if(Z.trim===!0&&$.rtrim!==!1)Z.rtrim=!0;else if(Z.rtrim!==!0)Z.rtrim=!1;if(Z.to===void 0||Z.to===null)Z.to=-1;else{if(typeof Z.to==="string"&&/\d+/.test(Z.to))Z.to=parseInt(Z.to);if(Number.isInteger(Z.to)){if(Z.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify($.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify($.to)}`)}if(Z.to_line===void 0||Z.to_line===null)Z.to_line=-1;else{if(typeof Z.to_line==="string"&&/\d+/.test(Z.to_line))Z.to_line=parseInt(Z.to_line);if(Number.isInteger(Z.to_line)){if(Z.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify($.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify($.to_line)}`)}return Z};var Q1=function($){return $.every((Z)=>Z==null||Z.toString&&Z.toString().trim()==="")},N$=13,Q$=10,d={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},G1=function($={}){const Z={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},J=v0($);return{info:Z,original_options:$,options:J,state:F1(J),__needMoreData:function(W,U,V){if(V)return!1;const{encoding:X,escape:F,quote:N}=this.options,{quoting:Q,needMoreDataSize:K,recordDelimiterMaxLength:I}=this.state,k=U-W-1,b=Math.max(K,I===0?Buffer.from("\r\n",X).length:I,Q?(F===null?0:F.length)+N.length:0,Q?N.length+I:0);return k<b},parse:function(W,U,V,X){const{bom:F,comment_no_infix:N,encoding:Q,from_line:K,ltrim:I,max_record_size:k,raw:b,relax_quotes:s,rtrim:O,skip_empty_lines:E,to:B,to_line:R}=this.options;let{comment:H,escape:T,quote:z,record_delimiter:P0}=this.options;const{bomSkipped:T1,previousBuf:t,rawBuffer:C1,escapeIsQuote:z1}=this.state;let M;if(t===void 0)if(W===void 0){X();return}else M=W;else if(t!==void 0&&W===void 0)M=t;else M=Buffer.concat([t,W]);if(T1===!1)if(F===!1)this.state.bomSkipped=!0;else if(M.length<3){if(U===!1){this.state.previousBuf=M;return}}else{for(let w in d)if(d[w].compare(M,0,d[w].length)===0){const j=d[w].length;this.state.bufBytesStart+=j,M=M.slice(j),this.options=v0({...this.original_options,encoding:w}),{comment:H,escape:T,quote:z}=this.options;break}this.state.bomSkipped=!0}const w0=M.length;let G;for(G=0;G<w0;G++){if(this.__needMoreData(G,w0,U))break;if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1;if(R!==-1&&this.info.lines>R){this.state.stop=!0,X();return}if(this.state.quoting===!1&&P0.length===0){if(this.__autoDiscoverRecordDelimiter(M,G))P0=this.options.record_delimiter}const w=M[G];if(b===!0)C1.append(w);if((w===N$||w===Q$)&&this.state.wasRowDelimiter===!1)this.state.wasRowDelimiter=!0;if(this.state.escaping===!0)this.state.escaping=!1;else{if(T!==null&&this.state.quoting===!0&&this.__isEscape(M,G,w)&&G+T.length<w0)if(z1){if(this.__isQuote(M,G+T.length)){this.state.escaping=!0,G+=T.length-1;continue}}else{this.state.escaping=!0,G+=T.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(M,G))if(this.state.quoting===!0){const S=M[G+z.length],c=O&&this.__isCharTrimable(M,G+z.length),y=H!==null&&this.__compareBytes(H,M,G+z.length,S),_=this.__isDelimiter(M,G+z.length,S),o=P0.length===0?this.__autoDiscoverRecordDelimiter(M,G+z.length):this.__isRecordDelimiter(S,M,G+z.length);if(T!==null&&this.__isEscape(M,G,w)&&this.__isQuote(M,G+T.length))G+=T.length-1;else if(!S||_||o||y||c){this.state.quoting=!1,this.state.wasQuoting=!0,G+=z.length-1;continue}else if(s===!1){const a=this.__error(new Y("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(S)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(a!==void 0)return a}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(z),G+=z.length-1}else if(this.state.field.length!==0){if(s===!1){const S=this.__infoField(),c=Object.keys(d).map((_)=>d[_].equals(this.state.field.toString())?_:!1).filter(Boolean)[0],y=this.__error(new Y("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(S.column)} at line ${S.lines}, value is ${JSON.stringify(this.state.field.toString(Q))}`,c?`(${c} bom)`:void 0],this.options,S,{field:this.state.field}));if(y!==void 0)return y}}else{this.state.quoting=!0,G+=z.length-1;continue}if(this.state.quoting===!1){const S=this.__isRecordDelimiter(w,M,G);if(S!==0){if(this.state.commenting&&(this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0))this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=K){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),G+=S-1;continue}if(E===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,G+=S-1;continue}this.info.bytes=this.state.bufBytesStart+G;const o=this.__onField();if(o!==void 0)return o;this.info.bytes=this.state.bufBytesStart+G+S;const a=this.__onRecord(V);if(a!==void 0)return a;if(B!==-1&&this.info.records>=B){this.state.stop=!0,X();return}}this.state.commenting=!1,G+=S-1;continue}if(this.state.commenting)continue;if((H===null?0:this.__compareBytes(H,M,G,w))!==0&&(N===!1||this.state.field.length===0)){this.state.commenting=!0;continue}const y=this.__isDelimiter(M,G,w);if(y!==0){this.info.bytes=this.state.bufBytesStart+G;const _=this.__onField();if(_!==void 0)return _;G+=y-1;continue}}}if(this.state.commenting===!1){if(k!==0&&this.state.record_length+this.state.field.length>k)return this.__error(new Y("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${k}`,`at line ${this.info.lines}`],this.options,this.__infoField()))}const j=I===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(M,G),L1=O===!1||this.state.wasQuoting===!1;if(j===!0&&L1===!0)this.state.field.append(w);else if(O===!0&&!this.__isCharTrimable(M,G))return this.__error(new Y("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));else{if(j===!1)G+=this.__isCharTrimable(M,G)-1;continue}}if(U===!0){if(this.state.quoting===!0){const w=this.__error(new Y("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(w!==void 0)return w}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+G;const w=this.__onField();if(w!==void 0)return w;const j=this.__onRecord(V);if(j!==void 0)return j}else if(this.state.wasRowDelimiter===!0)this.info.empty_lines++;else if(this.state.commenting===!0)this.info.comment_lines++}else this.state.bufBytesStart+=G,this.state.previousBuf=M.slice(G);if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1},__onRecord:function(W){const{columns:U,group_columns_by_name:V,encoding:X,info:F,from:N,relax_column_count:Q,relax_column_count_less:K,relax_column_count_more:I,raw:k,skip_records_with_empty_values:b}=this.options,{enabled:s,record:O}=this.state;if(s===!1)return this.__resetRecord();const E=O.length;if(U===!0){if(b===!0&&Q1(O)){this.__resetRecord();return}return this.__firstLineToColumns(O)}if(U===!1&&this.info.records===0)this.state.expectedRecordLength=E;if(E!==this.state.expectedRecordLength){const B=U===!1?new Y("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${E} on line ${this.info.lines}`],this.options,this.__infoField(),{record:O}):new Y("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${U.length},`,`got ${E} on line ${this.info.lines}`],this.options,this.__infoField(),{record:O});if(Q===!0||K===!0&&E<this.state.expectedRecordLength||I===!0&&E>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=B;else{const R=this.__error(B);if(R)return R}}if(b===!0&&Q1(O)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,N===1||this.info.records>=N){const{objname:B}=this.options;if(U!==!1){const R={};for(let H=0,T=O.length;H<T;H++){if(U[H]===void 0||U[H].disabled)continue;if(V===!0&&R[U[H].name]!==void 0)if(Array.isArray(R[U[H].name]))R[U[H].name]=R[U[H].name].concat(O[H]);else R[U[H].name]=[R[U[H].name],O[H]];else R[U[H].name]=O[H]}if(k===!0||F===!0){const H=Object.assign({record:R},k===!0?{raw:this.state.rawBuffer.toString(X)}:{},F===!0?{info:this.__infoRecord()}:{}),T=this.__push(B===void 0?H:[R[B],H],W);if(T)return T}else{const H=this.__push(B===void 0?R:[R[B],R],W);if(H)return H}}else if(k===!0||F===!0){const R=Object.assign({record:O},k===!0?{raw:this.state.rawBuffer.toString(X)}:{},F===!0?{info:this.__infoRecord()}:{}),H=this.__push(B===void 0?R:[O[B],R],W);if(H)return H}else{const R=this.__push(B===void 0?O:[O[B],O],W);if(R)return R}}this.__resetRecord()},__firstLineToColumns:function(W){const{firstLineToHeaders:U}=this.state;try{const V=U===void 0?W:U.call(null,W);if(!Array.isArray(V))return this.__error(new Y("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(V)}`],this.options,this.__infoField(),{headers:V}));const X=H0(V);this.state.expectedRecordLength=X.length,this.options.columns=X,this.__resetRecord();return}catch(V){return V}},__resetRecord:function(){if(this.options.raw===!0)this.state.rawBuffer.reset();this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:W,encoding:U,rtrim:V,max_record_size:X}=this.options,{enabled:F,wasQuoting:N}=this.state;if(F===!1)return this.__resetField();let Q=this.state.field.toString(U);if(V===!0&&N===!1)Q=Q.trimRight();if(W===!0){const[K,I]=this.__cast(Q);if(K!==void 0)return K;Q=I}if(this.state.record.push(Q),X!==0&&typeof Q==="string")this.state.record_length+=Q.length;this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(W,U){const{on_record:V}=this.options;if(V!==void 0){const X=this.__infoRecord();try{W=V.call(null,W,X)}catch(F){return F}if(W===void 0||W===null)return}U(W)},__cast:function(W){const{columns:U,relax_column_count:V}=this.options;if(Array.isArray(U)===!0&&V&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const F=this.__infoField();return[void 0,this.state.castField.call(null,W,F)]}catch(F){return[F]}if(this.__isFloat(W))return[void 0,parseFloat(W)];else if(this.options.cast_date!==!1){const F=this.__infoField();return[void 0,this.options.cast_date.call(null,W,F)]}return[void 0,W]},__isCharTrimable:function(W,U){return((X,F)=>{const{timchars:N}=this.state;$:for(let Q=0;Q<N.length;Q++){const K=N[Q];for(let I=0;I<K.length;I++)if(K[I]!==X[F+I])continue $;return K.length}return 0})(W,U)},__isFloat:function(W){return W-parseFloat(W)+1>=0},__compareBytes:function(W,U,V,X){if(W[0]!==X)return 0;const F=W.length;for(let N=1;N<F;N++)if(W[N]!==U[V+N])return 0;return F},__isDelimiter:function(W,U,V){const{delimiter:X,ignore_last_delimiters:F}=this.options;if(F===!0&&this.state.record.length===this.options.columns.length-1)return 0;else if(F!==!1&&typeof F==="number"&&this.state.record.length===F-1)return 0;$:for(let N=0;N<X.length;N++){const Q=X[N];if(Q[0]===V){for(let K=1;K<Q.length;K++)if(Q[K]!==W[U+K])continue $;return Q.length}}return 0},__isRecordDelimiter:function(W,U,V){const{record_delimiter:X}=this.options,F=X.length;$:for(let N=0;N<F;N++){const Q=X[N],K=Q.length;if(Q[0]!==W)continue;for(let I=1;I<K;I++)if(Q[I]!==U[V+I])continue $;return Q.length}return 0},__isEscape:function(W,U,V){const{escape:X}=this.options;if(X===null)return!1;const F=X.length;if(X[0]===V){for(let N=0;N<F;N++)if(X[N]!==W[U+N])return!1;return!0}return!1},__isQuote:function(W,U){const{quote:V}=this.options;if(V===null)return!1;const X=V.length;for(let F=0;F<X;F++)if(V[F]!==W[U+F])return!1;return!0},__autoDiscoverRecordDelimiter:function(W,U){const{encoding:V}=this.options,X=[Buffer.from("\r\n",V),Buffer.from("\n",V),Buffer.from("\r",V)];$:for(let F=0;F<X.length;F++){const N=X[F].length;for(let Q=0;Q<N;Q++)if(X[F][Q]!==W[U+Q])continue $;return this.options.record_delimiter.push(X[F]),this.state.recordDelimiterMaxLength=X[F].length,X[F].length}return 0},__error:function(W){const{encoding:U,raw:V,skip_records_with_error:X}=this.options,F=typeof W==="string"?new Error(W):W;if(X){if(this.state.recordHasError=!0,this.options.on_skip!==void 0)this.options.on_skip(F,V?this.state.rawBuffer.toString(U):void 0);return}else return F},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:W,raw:U,encoding:V}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:W===!0,index:this.state.record.length,raw:U?this.state.rawBuffer.toString(V):void 0}},__infoField:function(){const{columns:W}=this.options,U=Array.isArray(W);return{...this.__infoRecord(),column:U===!0?W.length>this.state.record.length?W[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}};var h0=function($,Z={}){if(typeof $==="string")$=Buffer.from($);const J=Z&&Z.objname?{}:[],W=G1(Z),U=(N)=>{if(W.options.objname===void 0)J.push(N);else J[N[0]]=N[1]},V=()=>{},X=W.parse($,!1,U,V);if(X!==void 0)throw X;const F=W.parse(void 0,!0,U,V);if(F!==void 0)throw F;return J};var R4=".".charCodeAt(0);var P4=RegExp('[^.[\\]]+|\\[(?:([^"\'][^[]*)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))',"g");var y4=Buffer.from([239,187,191]);import Y1 from"stream";import I$ from"util";var n=function($={},Z){if(this.options=$,$.consume===void 0||$.consume===null)this.options.consume=!1;if(this.options.objectMode=!0,$.parallel===void 0||$.parallel===null)this.options.parallel=100;if($.params===void 0||$.params===null)$.params=null;return this.handler=Z,Y1.Transform.call(this,this.options),this.state={running:0,started:0,finished:0,paused:!1},this};I$.inherits(n,Y1.Transform);n.prototype._transform=function($,Z,J){if(this.state.started++,this.state.running++,!this.state.paused&&this.state.running<this.options.parallel)J(),J=null;try{let W=this.handler.length;if(this.options.params!==null)W--;if(W===1){const U=this.handler.call(this,$,this.options.params);this.__done(null,[U],J)}else if(W===2){const U=(V,...X)=>this.__done(V,X,J);this.handler.call(this,$,U,this.options.params)}else throw Error("Invalid handler arguments");return!1}catch(W){this.__done(W)}};n.prototype._flush=function($){if(this.state.running===0)$();else this._ending=function(){$()}};n.prototype.__done=function($,Z,J){if(this.state.running--,$)return this.emit("error",$);this.state.finished++;for(let W of Z){if(typeof W==="number")W=`${W}`;if(W!==void 0&&W!==null&&W!=="")this.state.paused=!this.push(W)}if(J)J();if(this._ending&&this.state.running===0)this._ending()};import A$ from"node:fs/promises";var f=($,...Z)=>console.info(`${Date()}\n`,`${$}\n`,...Z,"\n\n");import H$ from"node:path";var I1=($)=>H$.parse($).name,H1=($,Z="csv")=>`${$}.${Z}`,J7=($)=>new Date($.replace(/['"]+/g,"")),f0=Object.create(null),U7=($)=>{if(!f0[$])f0[$]=Bun.hash($).toString();return f0[$]},M$=($)=>{if(!String($).length)throw new Error(`neptune requires edges to have exactly 1 label: ${$} received`);return $},m0=($)=>{if(!$.length)throw new Error("neptune requires at least 1 label for vertices");return $[0]},V7=($)=>$==="v"?m0:M$,M1=($)=>$.reduce((Z,J)=>{if(J.status==="rejected")Z.failure.push(J.reason);else Z.success.push(J.value);return Z},{success:[],failure:[]});var{t:K0,Direction:R1,merge:M0}=D,K$=($)=>{return $.edges.map((Z)=>{if(!Z.recordId)throw new Error(`all edges require a user supplied recordId\n${JSON.stringify(Z)}`);const J=new Map(Object.entries(Z.p||{}));return J.set(K0.label,Z.l),J.set(R1.OUT,Z.f),J.set(R1.IN,Z.t),[new Map([[K0.id,Z.recordId]]),J]})},R$=($)=>{if(!$.recordId)throw new Error("all vertices require a user supplied recordId");const Z=new Map(Object.entries($.p));return Z.set(K0.label,m0($.l)),[new Map([[K0.id,$.recordId]]),Z]},P1=async($,Z)=>{return Promise.allSettled($.flatMap((J)=>{if(Z.type==="v"){const[W,U]=R$(J);return b0.mergeV(W).option(M0.onCreate,U).option(M0.onMatch,U).toList()}return K$(J).map(([W,U])=>b0.mergeE(W).option(M0.onCreate,U).option(M0.onMatch,U).toList())}).filter(Boolean)).then(M1)};var w1=($)=>{if(typeof $!=="string"||typeof $!=="number")throw new Error(`invalid type, expected number|string, received: ${typeof $}`);return $},O1=($,Z,J)=>{const W={...$.inject?.p||{}},U=$.inject?.l?.slice()??[];return J.forEach((V,X)=>{if($.colMap?.ignoreCols?.includes(X))return;if($.colMap?.ignoreEmptyCol&&String(V).length===0)return;const F=Z[X],N=$.colMap?.transform?.(X,V)??V;if($.colMap?.p?.includes(X))W[F]=N;else if($.colMap?.l?.includes(X))if(U.length)W[F]=N;else U.push(w1(N));else if($.colMap?.default)switch($.colMap.default){case"p":W[F]=N;break;default:if(U.length)W[F]=N;else U.push(w1(N))}}),{p:W,l:U}},w$=($,Z,J)=>{return Z.map((W,U)=>{const V=$.transformRecord?.(W)??W,X=O1($,J,V);return{edges:$.edges.map((F)=>{return{f:F.f(X,V),t:F.t(X,V),l:F.l(X,V),p:F.p?.(X)??{},recordId:F.recordId(X,V)}})}})},O$=($,Z,J)=>{return Z.map((W,U)=>{const V=$.transformRecord?.(W)??W,X=O1($,J,V);return{recordId:$.recordId(X,V),...X}})},S1=async($,Z)=>{const J=$.transformHeaders?.(Z[0])??Z[0];switch($.type){case"v":return O$($,Z.slice(1),J);case"e":return w$($,Z.slice(1),J)}};var m=($={})=>({files:new Set,parsed:new Map,transformed:new Map,...$}),l0=async($,Z,J,W=m())=>{if(!W.parsed.has($))throw new Error(`csv not parsed: ${$}`);W.transformed.set(J||$,{spec:Z,data:await S1(Z,W.parsed.get($))})},A1=async($,Z,J=m())=>{try{J.parsed.set($,h0(await Bun.file(Z).text()))}catch(W){throw new Error(`invalid csv ${$}: ${Z}\n${W}`)}},q$=async($,Z=m())=>{(await A$.readdir($)).forEach((J)=>J.endsWith(".csv")&&Z.files.add(J)),f("total csv files found",Z.files.size)},B$=async($,Z=m())=>{if(!$.files)return;for(let[J,W]of $.files){const U=typeof W==="function"?W(J):W;if(U.recursive)await l0(U.recursive,U,J,Z);else{const V=H1(J);if(!Z.files.has(V))throw new Error(`could not find file: ${V}`);Z.files.delete(V),await A1(J,`${$.csvDir}/${V}`,Z),await l0(J,U,void 0,Z)}}f("transformed config.files",Z.transformed.size)},T$=async($,Z=m())=>{if(!$.includeUnmappedFiles)return;if(!$.getSpec)throw new Error("Including unmapped files requires config.getSpec to be defined");let J=0;for(let W of Z.files){const U=I1(W),V=$.getSpec(U);if(!V)continue;J++,Z.files.delete(W),await A1(U,`${$.csvDir}/${W}`,Z),await l0(U,V,void 0,Z)}f(`
    unmapped csvs processed ${J}
    unmapped csvs ignored: ${Z.files.size}
    `)},C$=async($,Z=m())=>{if(!Z.transformed.size)throw new Error(`
      no CSV files transformed. Did you correctly map CSV filenames to config specs?
      CSVs pared: ${Z.parsed.size}
      CSVs ignored: ${Z.files.size}
      CSVs transformed: ${Z.transformed.size}
      `);for(let[J,W]of Z.transformed.entries()){const U=await P1(W.data,W.spec);if($.persistResultLog){const V=`${$.csvDir}/${J}.csv.json`;Bun.write(V,JSON.stringify(U||"result is empty")),f(`result log saved to ${V}`)}f(`loaded ${J} into tinkergraph`,{success:U?.success.length??0,failure:U?.failure.length??0})}f("total csvs loaded in tinkergraph",Z.transformed.size)},G7=async($,Z=m())=>{await q$($.csvDir,Z),await B$($,Z),await T$($,Z),await C$($,Z)},Y7=()=>null;var{t:r}=D,{keys:z$,values:L$}=D.column,{addAll:q1}=D.operator,{flatMap:D$,identity:R0,project:k$,select:x$,unfold:B1,union:E$,valueMap:j$}=D.__,S7=($)=>({...$,limitX:$.limitX??0,limitY:$.limitY??($.limitX??0)+10}),A7=($,Z)=>{if(!Array.isArray(Z)||!Z.length)throw new Error(`${$} must be a non empty array\nreceived: ${Z}`);return!1},q7=($,...Z)=>{throw new Error(`Invalid Query\n${$}\n${JSON.stringify(Z)}`)},B7=({as:$=[],elements:Z=R0(),elKeys:J=[]})=>{return Z.as(...$.concat("base")).valueMap(...J).by(B1()).sack(q1).select("base").project("id","label").by(r.id).by(r.label).sack(q1)},T7=({elements:$=R0(),elKeys:Z=[],traversals:J=[]})=>{return $.local(E$(k$("id","label").by(r.id).by(r.label),j$(...Z).by(B1()),...J).unfold().group().by(z$).by(x$(L$)))},C7=({elements:$=R0(),elKeys:Z=[]})=>$.group().by(Z[0]??r.id).by(D$(R0()));var{traversal:_$,DriverRemoteConnection:g$,gremlin:y$}=D,b0=_$(I0).withRemote(new g$("ws://0.0.0.0:8182/gremlin")),x7=new y$.driver.Client("ws://0.0.0.0:8182/gremlin",{traversalSource:"g",session:`${Date.now()}`});export{w1 as validateNumStr,T$ as transformUnmappedFiles,O1 as transformPropsAndLabels,B$ as transformConfigFiles,l0 as transformAndSaveTinkerData,wZ as toJsonStringified,PZ as toJson,OZ as toBunBuffer,Y7 as tinkergraphToNeptuneCsv,R$ as tinkerDataVertex,K$ as tinkerDataEdge,P1 as tinkerData,q7 as throwInvalidQuery,A7 as throwIfEmpty,M1 as recordsCreatedHandler,q$ as readCsvDir,J7 as pgDateToJs,A1 as parseFile,J1 as msgpackToJsonIterator,AZ as msgpackToJson,$1 as mapToJsonIterator,f as log,C$ as loadTinkerData,DZ as keys,n6 as jsonReplacer,U7 as hashId,C7 as groupByIdentity,t6 as go,m0 as getVertexLabel,m as getStore,V7 as getLabel,M$ as getEdgeLabel,S7 as getBaseOpts,b0 as g,SZ as fromBunBuffer,I1 as fnameToBname,L as extensionCodec,Z1 as encoder,B7 as elementProps,D0 as deepFreezeCopy,h as decoder,G7 as csvToTinkergraph,O$ as csvToTinkerDataVertex,w$ as csvToTinkerDataEdge,S1 as csvToTinkerData,D as common,T7 as combineProps,x7 as client,H1 as bnameTofname,s6 as SET_EXT_TYPE,r6 as MSGPACK_HEADERS,W1 as MAP_EXT_TYPE,I0 as GroovyTraversalSource,x0 as GroovyTraversal,Y0 as EDir};
