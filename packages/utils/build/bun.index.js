// @bun
var T1=Object.create;var{defineProperty:f0,getPrototypeOf:C1,getOwnPropertyNames:z1}=Object;var B1=Object.prototype.hasOwnProperty;var x1=(W,$,Z)=>{Z=W!=null?T1(C1(W)):{};const J=$||!W||!W.__esModule?f0(Z,"default",{value:W,enumerable:!0}):Z;for(let Q of z1(W))if(!B1.call(J,Q))f0(J,Q,{get:()=>W[Q],enumerable:!0});return J};var L1=(W)=>{return import.meta.require(W)};function h0(W){var $=W.length,Z=0,J=0;while(J<$){var Q=W.charCodeAt(J++);if((Q&4294967168)===0){Z++;continue}else if((Q&4294965248)===0)Z+=2;else{if(Q>=55296&&Q<=56319){if(J<$){var U=W.charCodeAt(J);if((U&64512)===56320)++J,Q=((Q&1023)<<10)+(U&1023)+65536}}if((Q&4294901760)===0)Z+=3;else Z+=4}}return Z}function k1(W,$,Z){var J=W.length,Q=Z,U=0;while(U<J){var X=W.charCodeAt(U++);if((X&4294967168)===0){$[Q++]=X;continue}else if((X&4294965248)===0)$[Q++]=X>>6&31|192;else{if(X>=55296&&X<=56319){if(U<J){var G=W.charCodeAt(U);if((G&64512)===56320)++U,X=((X&1023)<<10)+(G&1023)+65536}}if((X&4294901760)===0)$[Q++]=X>>12&15|224,$[Q++]=X>>6&63|128;else $[Q++]=X>>18&7|240,$[Q++]=X>>12&63|128,$[Q++]=X>>6&63|128}$[Q++]=X&63|128}}function j1(W,$,Z){D1.encodeInto(W,$.subarray(Z))}function m0(W,$,Z){if(W.length>E1)j1(W,$,Z);else k1(W,$,Z)}function R0(W,$,Z){var J=$,Q=J+Z,U=[],X="";while(J<Q){var G=W[J++];if((G&128)===0)U.push(G);else if((G&224)===192){var V=W[J++]&63;U.push((G&31)<<6|V)}else if((G&240)===224){var V=W[J++]&63,F=W[J++]&63;U.push((G&31)<<12|V<<6|F)}else if((G&248)===240){var V=W[J++]&63,F=W[J++]&63,N=W[J++]&63,H=(G&7)<<18|V<<12|F<<6|N;if(H>65535)H-=65536,U.push(H>>>10&1023|55296),H=56320|H&1023;U.push(H)}else U.push(G);if(U.length>=g1)X+=String.fromCharCode.apply(String,U),U.length=0}if(U.length>0)X+=String.fromCharCode.apply(String,U);return X}function h1(W,$,Z){var J=W.subarray($,$+Z);return y1.decode(J)}function v0(W,$,Z){if(Z>f1)return h1(W,$,Z);else return R0(W,$,Z)}var D1=new TextEncoder,E1=50,g1=4096,y1=new TextDecoder,f1=200;var i=function(){function W($,Z){this.type=$,this.data=Z}return W}();var m1=function(){var W=function($,Z){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,Q){J.__proto__=Q}||function(J,Q){for(var U in Q)if(Object.prototype.hasOwnProperty.call(Q,U))J[U]=Q[U]},W($,Z)};return function($,Z){if(typeof Z!=="function"&&Z!==null)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");W($,Z);function J(){this.constructor=$}$.prototype=Z===null?Object.create(Z):(J.prototype=Z.prototype,new J)}}(),x=function(W){m1($,W);function $(Z){var J=W.call(this,Z)||this,Q=Object.create($.prototype);return Object.setPrototypeOf(J,Q),Object.defineProperty(J,"name",{configurable:!0,enumerable:!1,value:$.name}),J}return $}(Error);function _0(W,$,Z){var J=Z/4294967296,Q=Z;W.setUint32($,J),W.setUint32($+4,Q)}function $0(W,$,Z){var J=Math.floor(Z/4294967296),Q=Z;W.setUint32($,J),W.setUint32($+4,Q)}function W0(W,$){var Z=W.getInt32($),J=W.getUint32($+4);return Z*4294967296+J}function b0(W,$){var Z=W.getUint32($),J=W.getUint32($+4);return Z*4294967296+J}var _=4294967295;function l1(W){var{sec:$,nsec:Z}=W;if($>=0&&Z>=0&&$<=b1)if(Z===0&&$<=_1){var J=new Uint8Array(4),Q=new DataView(J.buffer);return Q.setUint32(0,$),J}else{var U=$/4294967296,X=$&4294967295,J=new Uint8Array(8),Q=new DataView(J.buffer);return Q.setUint32(0,Z<<2|U&3),Q.setUint32(4,X),J}else{var J=new Uint8Array(12),Q=new DataView(J.buffer);return Q.setUint32(0,Z),$0(Q,4,$),J}}function u1(W){var $=W.getTime(),Z=Math.floor($/1000),J=($-Z*1000)*1e6,Q=Math.floor(J/1e9);return{sec:Z+Q,nsec:J-Q*1e9}}function d1(W){if(W instanceof Date){var $=u1(W);return l1($)}else return null}function c1(W){var $=new DataView(W.buffer,W.byteOffset,W.byteLength);switch(W.byteLength){case 4:{var Z=$.getUint32(0),J=0;return{sec:Z,nsec:J}}case 8:{var Q=$.getUint32(0),U=$.getUint32(4),Z=(Q&3)*4294967296+U,J=Q>>>2;return{sec:Z,nsec:J}}case 12:{var Z=W0($,4),J=$.getUint32(0);return{sec:Z,nsec:J}}default:throw new x("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(W.length))}}function p1(W){var $=c1(W);return new Date($.sec*1000+$.nsec/1e6)}var v1=-1,_1=4294967295,b1=17179869183,l0={type:v1,encode:d1,decode:p1};var f=function(){function W(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(l0)}return W.prototype.register=function($){var{type:Z,encode:J,decode:Q}=$;if(Z>=0)this.encoders[Z]=J,this.decoders[Z]=Q;else{var U=1+Z;this.builtInEncoders[U]=J,this.builtInDecoders[U]=Q}},W.prototype.tryToEncode=function($,Z){for(var J=0;J<this.builtInEncoders.length;J++){var Q=this.builtInEncoders[J];if(Q!=null){var U=Q($,Z);if(U!=null){var X=-1-J;return new i(X,U)}}}for(var J=0;J<this.encoders.length;J++){var Q=this.encoders[J];if(Q!=null){var U=Q($,Z);if(U!=null){var X=J;return new i(X,U)}}}if($ instanceof i)return $;return null},W.prototype.decode=function($,Z,J){var Q=Z<0?this.builtInDecoders[-1-Z]:this.decoders[Z];if(Q)return Q($,Z,J);else return new i(Z,$)},W.defaultCodec=new W,W}();function b(W){if(W instanceof Uint8Array)return W;else if(ArrayBuffer.isView(W))return new Uint8Array(W.buffer,W.byteOffset,W.byteLength);else if(W instanceof ArrayBuffer)return new Uint8Array(W);else return Uint8Array.from(W)}function u0(W){if(W instanceof ArrayBuffer)return new DataView(W);var $=b(W);return new DataView($.buffer,$.byteOffset,$.byteLength)}var a1=100,i1=2048,d0=function(){function W($){var Z,J,Q,U,X,G,V,F;this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:f.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxDepth=(Q=$===null||$===void 0?void 0:$.maxDepth)!==null&&Q!==void 0?Q:a1,this.initialBufferSize=(U=$===null||$===void 0?void 0:$.initialBufferSize)!==null&&U!==void 0?U:i1,this.sortKeys=(X=$===null||$===void 0?void 0:$.sortKeys)!==null&&X!==void 0?X:!1,this.forceFloat32=(G=$===null||$===void 0?void 0:$.forceFloat32)!==null&&G!==void 0?G:!1,this.ignoreUndefined=(V=$===null||$===void 0?void 0:$.ignoreUndefined)!==null&&V!==void 0?V:!1,this.forceIntegerToFloat=(F=$===null||$===void 0?void 0:$.forceIntegerToFloat)!==null&&F!==void 0?F:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return W.prototype.reinitializeState=function(){this.pos=0},W.prototype.encodeSharedRef=function($){return this.reinitializeState(),this.doEncode($,1),this.bytes.subarray(0,this.pos)},W.prototype.encode=function($){return this.reinitializeState(),this.doEncode($,1),this.bytes.slice(0,this.pos)},W.prototype.doEncode=function($,Z){if(Z>this.maxDepth)throw new Error("Too deep objects in depth ".concat(Z));if($==null)this.encodeNil();else if(typeof $==="boolean")this.encodeBoolean($);else if(typeof $==="number")if(!this.forceIntegerToFloat)this.encodeNumber($);else this.encodeNumberAsFloat($);else if(typeof $==="string")this.encodeString($);else if(this.useBigInt64&&typeof $==="bigint")this.encodeBigInt64($);else this.encodeObject($,Z)},W.prototype.ensureBufferSizeToWrite=function($){var Z=this.pos+$;if(this.view.byteLength<Z)this.resizeBuffer(Z*2)},W.prototype.resizeBuffer=function($){var Z=new ArrayBuffer($),J=new Uint8Array(Z),Q=new DataView(Z);J.set(this.bytes),this.view=Q,this.bytes=J},W.prototype.encodeNil=function(){this.writeU8(192)},W.prototype.encodeBoolean=function($){if($===!1)this.writeU8(194);else this.writeU8(195)},W.prototype.encodeNumber=function($){if(!this.forceIntegerToFloat&&Number.isSafeInteger($))if($>=0)if($<128)this.writeU8($);else if($<256)this.writeU8(204),this.writeU8($);else if($<65536)this.writeU8(205),this.writeU16($);else if($<4294967296)this.writeU8(206),this.writeU32($);else if(!this.useBigInt64)this.writeU8(207),this.writeU64($);else this.encodeNumberAsFloat($);else if($>=-32)this.writeU8(224|$+32);else if($>=-128)this.writeU8(208),this.writeI8($);else if($>=-32768)this.writeU8(209),this.writeI16($);else if($>=-2147483648)this.writeU8(210),this.writeI32($);else if(!this.useBigInt64)this.writeU8(211),this.writeI64($);else this.encodeNumberAsFloat($);else this.encodeNumberAsFloat($)},W.prototype.encodeNumberAsFloat=function($){if(this.forceFloat32)this.writeU8(202),this.writeF32($);else this.writeU8(203),this.writeF64($)},W.prototype.encodeBigInt64=function($){if($>=BigInt(0))this.writeU8(207),this.writeBigUint64($);else this.writeU8(211),this.writeBigInt64($)},W.prototype.writeStringHeader=function($){if($<32)this.writeU8(160+$);else if($<256)this.writeU8(217),this.writeU8($);else if($<65536)this.writeU8(218),this.writeU16($);else if($<4294967296)this.writeU8(219),this.writeU32($);else throw new Error("Too long string: ".concat($," bytes in UTF-8"))},W.prototype.encodeString=function($){var Z=5,J=h0($);this.ensureBufferSizeToWrite(Z+J),this.writeStringHeader(J),m0($,this.bytes,this.pos),this.pos+=J},W.prototype.encodeObject=function($,Z){var J=this.extensionCodec.tryToEncode($,this.context);if(J!=null)this.encodeExtension(J);else if(Array.isArray($))this.encodeArray($,Z);else if(ArrayBuffer.isView($))this.encodeBinary($);else if(typeof $==="object")this.encodeMap($,Z);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply($)))},W.prototype.encodeBinary=function($){var Z=$.byteLength;if(Z<256)this.writeU8(196),this.writeU8(Z);else if(Z<65536)this.writeU8(197),this.writeU16(Z);else if(Z<4294967296)this.writeU8(198),this.writeU32(Z);else throw new Error("Too large binary: ".concat(Z));var J=b($);this.writeU8a(J)},W.prototype.encodeArray=function($,Z){var J=$.length;if(J<16)this.writeU8(144+J);else if(J<65536)this.writeU8(220),this.writeU16(J);else if(J<4294967296)this.writeU8(221),this.writeU32(J);else throw new Error("Too large array: ".concat(J));for(var Q=0,U=$;Q<U.length;Q++){var X=U[Q];this.doEncode(X,Z+1)}},W.prototype.countWithoutUndefined=function($,Z){var J=0;for(var Q=0,U=Z;Q<U.length;Q++){var X=U[Q];if($[X]!==void 0)J++}return J},W.prototype.encodeMap=function($,Z){var J=Object.keys($);if(this.sortKeys)J.sort();var Q=this.ignoreUndefined?this.countWithoutUndefined($,J):J.length;if(Q<16)this.writeU8(128+Q);else if(Q<65536)this.writeU8(222),this.writeU16(Q);else if(Q<4294967296)this.writeU8(223),this.writeU32(Q);else throw new Error("Too large map object: ".concat(Q));for(var U=0,X=J;U<X.length;U++){var G=X[U],V=$[G];if(!(this.ignoreUndefined&&V===void 0))this.encodeString(G),this.doEncode(V,Z+1)}},W.prototype.encodeExtension=function($){var Z=$.data.length;if(Z===1)this.writeU8(212);else if(Z===2)this.writeU8(213);else if(Z===4)this.writeU8(214);else if(Z===8)this.writeU8(215);else if(Z===16)this.writeU8(216);else if(Z<256)this.writeU8(199),this.writeU8(Z);else if(Z<65536)this.writeU8(200),this.writeU16(Z);else if(Z<4294967296)this.writeU8(201),this.writeU32(Z);else throw new Error("Too large extension object: ".concat(Z));this.writeI8($.type),this.writeU8a($.data)},W.prototype.writeU8=function($){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,$),this.pos++},W.prototype.writeU8a=function($){var Z=$.length;this.ensureBufferSizeToWrite(Z),this.bytes.set($,this.pos),this.pos+=Z},W.prototype.writeI8=function($){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,$),this.pos++},W.prototype.writeU16=function($){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,$),this.pos+=2},W.prototype.writeI16=function($){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,$),this.pos+=2},W.prototype.writeU32=function($){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,$),this.pos+=4},W.prototype.writeI32=function($){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,$),this.pos+=4},W.prototype.writeF32=function($){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,$),this.pos+=4},W.prototype.writeF64=function($){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,$),this.pos+=8},W.prototype.writeU64=function($){this.ensureBufferSizeToWrite(8),_0(this.view,this.pos,$),this.pos+=8},W.prototype.writeI64=function($){this.ensureBufferSizeToWrite(8),$0(this.view,this.pos,$),this.pos+=8},W.prototype.writeBigUint64=function($){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,$),this.pos+=8},W.prototype.writeBigInt64=function($){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,$),this.pos+=8},W}();function K0(W,$){var Z=new d0($);return Z.encodeSharedRef(W)}function Z0(W){return"".concat(W<0?"-":"","0x").concat(Math.abs(W).toString(16).padStart(2,"0"))}var n1=16,r1=16,c0=function(){function W($,Z){if($===void 0)$=n1;if(Z===void 0)Z=r1;this.maxKeyLength=$,this.maxLengthPerKey=Z,this.hit=0,this.miss=0,this.caches=[];for(var J=0;J<this.maxKeyLength;J++)this.caches.push([])}return W.prototype.canBeCached=function($){return $>0&&$<=this.maxKeyLength},W.prototype.find=function($,Z,J){var Q=this.caches[J-1];$:for(var U=0,X=Q;U<X.length;U++){var G=X[U],V=G.bytes;for(var F=0;F<J;F++)if(V[F]!==$[Z+F])continue $;return G.str}return null},W.prototype.store=function($,Z){var J=this.caches[$.length-1],Q={bytes:$,str:Z};if(J.length>=this.maxLengthPerKey)J[Math.random()*J.length|0]=Q;else J.push(Q)},W.prototype.decode=function($,Z,J){var Q=this.find($,Z,J);if(Q!=null)return this.hit++,Q;this.miss++;var U=R0($,Z,J),X=Uint8Array.prototype.slice.call($,Z,Z+J);return this.store(X,U),U},W}();var s1=function(W,$,Z,J){function Q(U){return U instanceof Z?U:new Z(function(X){X(U)})}return new(Z||(Z=Promise))(function(U,X){function G(N){try{F(J.next(N))}catch(H){X(H)}}function V(N){try{F(J.throw(N))}catch(H){X(H)}}function F(N){N.done?U(N.value):Q(N.value).then(G,V)}F((J=J.apply(W,$||[])).next())})},M0=function(W,$){var Z={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},J,Q,U,X;return X={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(X[Symbol.iterator]=function(){return this}),X;function G(F){return function(N){return V([F,N])}}function V(F){if(J)throw new TypeError("Generator is already executing.");while(X&&(X=0,F[0]&&(Z=0)),Z)try{if(J=1,Q&&(U=F[0]&2?Q.return:F[0]?Q.throw||((U=Q.return)&&U.call(Q),0):Q.next)&&!(U=U.call(Q,F[1])).done)return U;if(Q=0,U)F=[F[0]&2,U.value];switch(F[0]){case 0:case 1:U=F;break;case 4:return Z.label++,{value:F[1],done:!1};case 5:Z.label++,Q=F[1],F=[0];continue;case 7:F=Z.ops.pop(),Z.trys.pop();continue;default:if((U=Z.trys,!(U=U.length>0&&U[U.length-1]))&&(F[0]===6||F[0]===2)){Z=0;continue}if(F[0]===3&&(!U||F[1]>U[0]&&F[1]<U[3])){Z.label=F[1];break}if(F[0]===6&&Z.label<U[1]){Z.label=U[1],U=F;break}if(U&&Z.label<U[2]){Z.label=U[2],Z.ops.push(F);break}if(U[2])Z.ops.pop();Z.trys.pop();continue}F=$.call(W,Z)}catch(N){F=[6,N],Q=0}finally{J=U=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}},p0=function(W){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=W[Symbol.asyncIterator],Z;return $?$.call(W):(W=typeof __values==="function"?__values(W):W[Symbol.iterator](),Z={},J("next"),J("throw"),J("return"),Z[Symbol.asyncIterator]=function(){return this},Z);function J(U){Z[U]=W[U]&&function(X){return new Promise(function(G,V){X=W[U](X),Q(G,V,X.done,X.value)})}}function Q(U,X,G,V){Promise.resolve(V).then(function(F){U({value:F,done:G})},X)}},l=function(W){return this instanceof l?(this.v=W,this):new l(W)},t1=function(W,$,Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J=Z.apply(W,$||[]),Q,U=[];return Q={},X("next"),X("throw"),X("return"),Q[Symbol.asyncIterator]=function(){return this},Q;function X(Y){if(J[Y])Q[Y]=function(K){return new Promise(function(T,M){U.push([Y,K,T,M])>1||G(Y,K)})}}function G(Y,K){try{V(J[Y](K))}catch(T){H(U[0][3],T)}}function V(Y){Y.value instanceof l?Promise.resolve(Y.value.v).then(F,N):H(U[0][2],Y)}function F(Y){G("next",Y)}function N(Y){G("throw",Y)}function H(Y,K){if(Y(K),U.shift(),U.length)G(U[0][0],U[0][1])}},a0="array",J0="map_key",o1="map_value",e1=function(W){return typeof W==="string"||typeof W==="number"},n=-1,S0=new DataView(new ArrayBuffer(0)),$8=new Uint8Array(S0.buffer);try{S0.getInt8(0)}catch(W){if(!(W instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var O0=RangeError,i0=new O0("Insufficient data"),W8=new c0,Q0=function(){function W($){var Z,J,Q,U,X,G,V;this.totalPos=0,this.pos=0,this.view=S0,this.bytes=$8,this.headByte=n,this.stack=[],this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:f.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxStrLength=(Q=$===null||$===void 0?void 0:$.maxStrLength)!==null&&Q!==void 0?Q:_,this.maxBinLength=(U=$===null||$===void 0?void 0:$.maxBinLength)!==null&&U!==void 0?U:_,this.maxArrayLength=(X=$===null||$===void 0?void 0:$.maxArrayLength)!==null&&X!==void 0?X:_,this.maxMapLength=(G=$===null||$===void 0?void 0:$.maxMapLength)!==null&&G!==void 0?G:_,this.maxExtLength=(V=$===null||$===void 0?void 0:$.maxExtLength)!==null&&V!==void 0?V:_,this.keyDecoder=($===null||$===void 0?void 0:$.keyDecoder)!==void 0?$.keyDecoder:W8}return W.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=n,this.stack.length=0},W.prototype.setBuffer=function($){this.bytes=b($),this.view=u0(this.bytes),this.pos=0},W.prototype.appendBuffer=function($){if(this.headByte===n&&!this.hasRemaining(1))this.setBuffer($);else{var Z=this.bytes.subarray(this.pos),J=b($),Q=new Uint8Array(Z.length+J.length);Q.set(Z),Q.set(J,Z.length),this.setBuffer(Q)}},W.prototype.hasRemaining=function($){return this.view.byteLength-this.pos>=$},W.prototype.createExtraByteError=function($){var Z=this,J=Z.view,Q=Z.pos;return new RangeError("Extra ".concat(J.byteLength-Q," of ").concat(J.byteLength," byte(s) found at buffer[").concat($,"]"))},W.prototype.decode=function($){this.reinitializeState(),this.setBuffer($);var Z=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return Z},W.prototype.decodeMulti=function($){return M0(this,function(Z){switch(Z.label){case 0:this.reinitializeState(),this.setBuffer($),Z.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return Z.sent(),[3,1];case 3:return[2]}})},W.prototype.decodeAsync=function($){var Z,J,Q,U,X,G,V;return s1(this,void 0,void 0,function(){var F,N,H,Y,K,T,M,O;return M0(this,function(w){switch(w.label){case 0:F=!1,w.label=1;case 1:w.trys.push([1,6,7,12]),Z=!0,J=p0($),w.label=2;case 2:return[4,J.next()];case 3:if(Q=w.sent(),U=Q.done,!!U)return[3,5];V=Q.value,Z=!1;try{if(H=V,F)throw this.createExtraByteError(this.totalPos);this.appendBuffer(H);try{N=this.doDecodeSync(),F=!0}catch(A){if(!(A instanceof O0))throw A}this.totalPos+=this.pos}finally{Z=!0}w.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Y=w.sent(),X={error:Y},[3,12];case 7:if(w.trys.push([7,,10,11]),!(!Z&&!U&&(G=J.return)))return[3,9];return[4,G.call(J)];case 8:w.sent(),w.label=9;case 9:return[3,11];case 10:if(X)throw X.error;return[7];case 11:return[7];case 12:if(F){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,N]}throw K=this,T=K.headByte,M=K.pos,O=K.totalPos,new RangeError("Insufficient data in parsing ".concat(Z0(T)," at ").concat(O," (").concat(M," in the current buffer)"))}})})},W.prototype.decodeArrayStream=function($){return this.decodeMultiAsync($,!0)},W.prototype.decodeStream=function($){return this.decodeMultiAsync($,!1)},W.prototype.decodeMultiAsync=function($,Z){return t1(this,arguments,function J(){var Q,U,X,G,V,F,N,H,Y,K,T,M;return M0(this,function(O){switch(O.label){case 0:Q=Z,U=-1,O.label=1;case 1:O.trys.push([1,15,16,21]),X=!0,G=p0($),O.label=2;case 2:return[4,l(G.next())];case 3:if(V=O.sent(),Y=V.done,!!Y)return[3,14];M=V.value,X=!1,O.label=4;case 4:if(O.trys.push([4,,12,13]),F=M,Z&&U===0)throw this.createExtraByteError(this.totalPos);if(this.appendBuffer(F),Q)U=this.readArraySize(),Q=!1,this.complete();O.label=5;case 5:O.trys.push([5,10,,11]),O.label=6;case 6:return[4,l(this.doDecodeSync())];case 7:return[4,O.sent()];case 8:if(O.sent(),--U===0)return[3,9];return[3,6];case 9:return[3,11];case 10:if(N=O.sent(),!(N instanceof O0))throw N;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return X=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return H=O.sent(),K={error:H},[3,21];case 16:if(O.trys.push([16,,19,20]),!(!X&&!Y&&(T=G.return)))return[3,18];return[4,l(T.call(G))];case 17:O.sent(),O.label=18;case 18:return[3,20];case 19:if(K)throw K.error;return[7];case 20:return[7];case 21:return[2]}})})},W.prototype.doDecodeSync=function(){$:while(!0){var $=this.readHeadByte(),Z=void 0;if($>=224)Z=$-256;else if($<192)if($<128)Z=$;else if($<144){var J=$-128;if(J!==0){this.pushMapState(J),this.complete();continue $}else Z={}}else if($<160){var J=$-144;if(J!==0){this.pushArrayState(J),this.complete();continue $}else Z=[]}else{var Q=$-160;Z=this.decodeUtf8String(Q,0)}else if($===192)Z=null;else if($===194)Z=!1;else if($===195)Z=!0;else if($===202)Z=this.readF32();else if($===203)Z=this.readF64();else if($===204)Z=this.readU8();else if($===205)Z=this.readU16();else if($===206)Z=this.readU32();else if($===207)if(this.useBigInt64)Z=this.readU64AsBigInt();else Z=this.readU64();else if($===208)Z=this.readI8();else if($===209)Z=this.readI16();else if($===210)Z=this.readI32();else if($===211)if(this.useBigInt64)Z=this.readI64AsBigInt();else Z=this.readI64();else if($===217){var Q=this.lookU8();Z=this.decodeUtf8String(Q,1)}else if($===218){var Q=this.lookU16();Z=this.decodeUtf8String(Q,2)}else if($===219){var Q=this.lookU32();Z=this.decodeUtf8String(Q,4)}else if($===220){var J=this.readU16();if(J!==0){this.pushArrayState(J),this.complete();continue $}else Z=[]}else if($===221){var J=this.readU32();if(J!==0){this.pushArrayState(J),this.complete();continue $}else Z=[]}else if($===222){var J=this.readU16();if(J!==0){this.pushMapState(J),this.complete();continue $}else Z={}}else if($===223){var J=this.readU32();if(J!==0){this.pushMapState(J),this.complete();continue $}else Z={}}else if($===196){var J=this.lookU8();Z=this.decodeBinary(J,1)}else if($===197){var J=this.lookU16();Z=this.decodeBinary(J,2)}else if($===198){var J=this.lookU32();Z=this.decodeBinary(J,4)}else if($===212)Z=this.decodeExtension(1,0);else if($===213)Z=this.decodeExtension(2,0);else if($===214)Z=this.decodeExtension(4,0);else if($===215)Z=this.decodeExtension(8,0);else if($===216)Z=this.decodeExtension(16,0);else if($===199){var J=this.lookU8();Z=this.decodeExtension(J,1)}else if($===200){var J=this.lookU16();Z=this.decodeExtension(J,2)}else if($===201){var J=this.lookU32();Z=this.decodeExtension(J,4)}else throw new x("Unrecognized type byte: ".concat(Z0($)));this.complete();var U=this.stack;while(U.length>0){var X=U[U.length-1];if(X.type===a0)if(X.array[X.position]=Z,X.position++,X.position===X.size)U.pop(),Z=X.array;else continue $;else if(X.type===J0){if(!e1(Z))throw new x("The type of key must be string or number but "+typeof Z);if(Z==="__proto__")throw new x("The key __proto__ is not allowed");X.key=Z,X.type=o1;continue $}else if(X.map[X.key]=Z,X.readCount++,X.readCount===X.size)U.pop(),Z=X.map;else{X.key=null,X.type=J0;continue $}}return Z}},W.prototype.readHeadByte=function(){if(this.headByte===n)this.headByte=this.readU8();return this.headByte},W.prototype.complete=function(){this.headByte=n},W.prototype.readArraySize=function(){var $=this.readHeadByte();switch($){case 220:return this.readU16();case 221:return this.readU32();default:if($<160)return $-144;else throw new x("Unrecognized array type byte: ".concat(Z0($)))}},W.prototype.pushMapState=function($){if($>this.maxMapLength)throw new x("Max length exceeded: map length (".concat($,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:J0,size:$,key:null,readCount:0,map:{}})},W.prototype.pushArrayState=function($){if($>this.maxArrayLength)throw new x("Max length exceeded: array length (".concat($,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:a0,size:$,array:new Array($),position:0})},W.prototype.decodeUtf8String=function($,Z){var J;if($>this.maxStrLength)throw new x("Max length exceeded: UTF-8 byte length (".concat($,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+Z+$)throw i0;var Q=this.pos+Z,U;if(this.stateIsMapKey()&&((J=this.keyDecoder)===null||J===void 0?void 0:J.canBeCached($)))U=this.keyDecoder.decode(this.bytes,Q,$);else U=v0(this.bytes,Q,$);return this.pos+=Z+$,U},W.prototype.stateIsMapKey=function(){if(this.stack.length>0){var $=this.stack[this.stack.length-1];return $.type===J0}return!1},W.prototype.decodeBinary=function($,Z){if($>this.maxBinLength)throw new x("Max length exceeded: bin length (".concat($,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining($+Z))throw i0;var J=this.pos+Z,Q=this.bytes.subarray(J,J+$);return this.pos+=Z+$,Q},W.prototype.decodeExtension=function($,Z){if($>this.maxExtLength)throw new x("Max length exceeded: ext length (".concat($,") > maxExtLength (").concat(this.maxExtLength,")"));var J=this.view.getInt8(this.pos+Z),Q=this.decodeBinary($,Z+1);return this.extensionCodec.decode(Q,J,this.context)},W.prototype.lookU8=function(){return this.view.getUint8(this.pos)},W.prototype.lookU16=function(){return this.view.getUint16(this.pos)},W.prototype.lookU32=function(){return this.view.getUint32(this.pos)},W.prototype.readU8=function(){var $=this.view.getUint8(this.pos);return this.pos++,$},W.prototype.readI8=function(){var $=this.view.getInt8(this.pos);return this.pos++,$},W.prototype.readU16=function(){var $=this.view.getUint16(this.pos);return this.pos+=2,$},W.prototype.readI16=function(){var $=this.view.getInt16(this.pos);return this.pos+=2,$},W.prototype.readU32=function(){var $=this.view.getUint32(this.pos);return this.pos+=4,$},W.prototype.readI32=function(){var $=this.view.getInt32(this.pos);return this.pos+=4,$},W.prototype.readU64=function(){var $=b0(this.view,this.pos);return this.pos+=8,$},W.prototype.readI64=function(){var $=W0(this.view,this.pos);return this.pos+=8,$},W.prototype.readU64AsBigInt=function(){var $=this.view.getBigUint64(this.pos);return this.pos+=8,$},W.prototype.readI64AsBigInt=function(){var $=this.view.getBigInt64(this.pos);return this.pos+=8,$},W.prototype.readF32=function(){var $=this.view.getFloat32(this.pos);return this.pos+=4,$},W.prototype.readF64=function(){var $=this.view.getFloat64(this.pos);return this.pos+=8,$},W}();function P0(W,$){var Z=new Q0($);return Z.decode(W)}function Q8(W){return W[Symbol.asyncIterator]!=null}var U8=function(W){if(W==null)throw new Error("Assertion Failure: value must not be null nor undefined")};function X8(W){return J8(this,arguments,function $(){var Z,J,Q,U;return Z8(this,function(X){switch(X.label){case 0:Z=W.getReader(),X.label=1;case 1:X.trys.push([1,,9,10]),X.label=2;case 2:return[4,u(Z.read())];case 3:if(J=X.sent(),Q=J.done,U=J.value,!Q)return[3,5];return[4,u(void 0)];case 4:return[2,X.sent()];case 5:return U8(U),[4,u(U)];case 6:return[4,X.sent()];case 7:return X.sent(),[3,2];case 8:return[3,10];case 9:return Z.releaseLock(),[7];case 10:return[2]}})})}function n0(W){if(Q8(W))return W;else return X8(W)}var Z8=function(W,$){var Z={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},J,Q,U,X;return X={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(X[Symbol.iterator]=function(){return this}),X;function G(F){return function(N){return V([F,N])}}function V(F){if(J)throw new TypeError("Generator is already executing.");while(X&&(X=0,F[0]&&(Z=0)),Z)try{if(J=1,Q&&(U=F[0]&2?Q.return:F[0]?Q.throw||((U=Q.return)&&U.call(Q),0):Q.next)&&!(U=U.call(Q,F[1])).done)return U;if(Q=0,U)F=[F[0]&2,U.value];switch(F[0]){case 0:case 1:U=F;break;case 4:return Z.label++,{value:F[1],done:!1};case 5:Z.label++,Q=F[1],F=[0];continue;case 7:F=Z.ops.pop(),Z.trys.pop();continue;default:if((U=Z.trys,!(U=U.length>0&&U[U.length-1]))&&(F[0]===6||F[0]===2)){Z=0;continue}if(F[0]===3&&(!U||F[1]>U[0]&&F[1]<U[3])){Z.label=F[1];break}if(F[0]===6&&Z.label<U[1]){Z.label=U[1],U=F;break}if(U&&Z.label<U[2]){Z.label=U[2],Z.ops.push(F);break}if(U[2])Z.ops.pop();Z.trys.pop();continue}F=$.call(W,Z)}catch(N){F=[6,N],Q=0}finally{J=U=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}},u=function(W){return this instanceof u?(this.v=W,this):new u(W)},J8=function(W,$,Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J=Z.apply(W,$||[]),Q,U=[];return Q={},X("next"),X("throw"),X("return"),Q[Symbol.asyncIterator]=function(){return this},Q;function X(Y){if(J[Y])Q[Y]=function(K){return new Promise(function(T,M){U.push([Y,K,T,M])>1||G(Y,K)})}}function G(Y,K){try{V(J[Y](K))}catch(T){H(U[0][3],T)}}function V(Y){Y.value instanceof u?Promise.resolve(Y.value.v).then(F,N):H(U[0][2],Y)}function F(Y){G("next",Y)}function N(Y){G("throw",Y)}function H(Y,K){if(Y(K),U.shift(),U.length)G(U[0][0],U[0][1])}};function A0(W,$){return F8(this,void 0,void 0,function(){var Z,J;return G8(this,function(Q){return Z=n0(W),J=new Q0($),[2,J.decodeAsync(Z)]})})}var F8=function(W,$,Z,J){function Q(U){return U instanceof Z?U:new Z(function(X){X(U)})}return new(Z||(Z=Promise))(function(U,X){function G(N){try{F(J.next(N))}catch(H){X(H)}}function V(N){try{F(J.throw(N))}catch(H){X(H)}}function F(N){N.done?U(N.value):Q(N.value).then(G,V)}F((J=J.apply(W,$||[])).next())})},G8=function(W,$){var Z={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},J,Q,U,X;return X={next:G(0),throw:G(1),return:G(2)},typeof Symbol==="function"&&(X[Symbol.iterator]=function(){return this}),X;function G(F){return function(N){return V([F,N])}}function V(F){if(J)throw new TypeError("Generator is already executing.");while(X&&(X=0,F[0]&&(Z=0)),Z)try{if(J=1,Q&&(U=F[0]&2?Q.return:F[0]?Q.throw||((U=Q.return)&&U.call(Q),0):Q.next)&&!(U=U.call(Q,F[1])).done)return U;if(Q=0,U)F=[F[0]&2,U.value];switch(F[0]){case 0:case 1:U=F;break;case 4:return Z.label++,{value:F[1],done:!1};case 5:Z.label++,Q=F[1],F=[0];continue;case 7:F=Z.ops.pop(),Z.trys.pop();continue;default:if((U=Z.trys,!(U=U.length>0&&U[U.length-1]))&&(F[0]===6||F[0]===2)){Z=0;continue}if(F[0]===3&&(!U||F[1]>U[0]&&F[1]<U[3])){Z.label=F[1];break}if(F[0]===6&&Z.label<U[1]){Z.label=U[1],U=F;break}if(U&&Z.label<U[2]){Z.label=U[2],Z.ops.push(F);break}if(U[2])Z.ops.pop();Z.trys.pop();continue}F=$.call(W,Z)}catch(N){F=[6,N],Q=0}finally{J=U=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};function w0(W){const $=Object.create(null),Z=Reflect.ownKeys(W).filter((J)=>typeof J==="string");for(let J of Z){const Q=W[J];$[J]=Q&&Q instanceof Object?w0(Q):Q}return Object.freeze($)}function r0(W){return Array.from(W).reduce(($,[Z,J])=>{return $[Z]=J instanceof Map?r0(J):J,$},Object.create(null))}function V8(W,$){if(typeof W!=="string"||typeof W!=="number")return;return $ instanceof Map?Object.fromEntries($.entries()):$}var U0=import.meta.resolveSync("bun:jsc")&&await import("bun:jsc"),d6=(W)=>w0(r0(W)),c6=(W)=>JSON.stringify(W,V8),p6=(W)=>{if(!U0)throw new Error("toBunBuffer requires the bun runtime");return U0.serialize(W)},a6=(W)=>{if(!U0)throw new Error("fromBunBuffer requires the bun runtime");return U0.deserialize(W)},s0={encode:K0},h={decode:P0,decodeAsync:A0},D=new f,N8={"Content-Type":"application/x-msgpack"},Y8=0;D.register({type:Y8,encode(W){if(W instanceof Set)return s0.encode([...W],{extensionCodec:D});return null},decode(W){const $=h.decode(W,{extensionCodec:D});return new Set($)},async decodeAsync(W){const $=await h.decodeAsync(W,{extensionCodec:D});return new Set($)}});var t0=1;D.register({type:t0,encode(W){if(W instanceof Map)return s0.encode([...W],{extensionCodec:D});return null},decode(W){const $=h.decode(W,{extensionCodec:D});return new Map($)},async decodeAsync(W){const $=await h.decodeAsync(W,{extensionCodec:D});return new Map($)}});var o0=(W)=>W.reduce(($,[Z,J])=>{return $[Z]=J?.type===t0&&J?.data instanceof Uint8Array?o0(h.decode(J.data,{extensionCodec:D})):J,$},Object.create(null)),i6=async(W)=>{if(W.headers.get("Content-Type")!==N8["Content-Type"]||!W.body)return null;return w0(o0(h.decode((await h.decodeAsync(W.body,{extensionCodec:D})).data,{extensionCodec:D})))};import L from"gremlin";var z=L.process.statics,X0;(function(Z){Z["out"]="out";Z["in"]="in"})(X0||(X0={}));var H8=(W)=>{const $={both:z.both,bothE:z.bothE,bothV:z.bothV,otherV:z.otherV,inV:z.inV,outV:z.outV,inE:z.inE,in:z.in_,outE:z.outE,out:z.out};switch(W){case X0.in:return{...$,to:{e:z.inE,v:z.in_}};case X0.out:return{...$,to:{e:z.outE,v:z.out}};default:throw new Error(`invalid: ${W}\nexpected an EDir}`)}},E={...L.process,gremlin:L,p:L.process.P,traversal:L.process.AnonymousTraversalSource.traversal,DriverRemoteConnection:L.driver.DriverRemoteConnection,__:z,textp:L.process.TextP,Direction:{BOTH:L.process.direction.both,from_:L.process.direction.in,IN:L.process.direction.in,OUT:L.process.direction.out,to:L.process.direction.out},go:H8};["P","AnonymousTraversalSource","statics","driver","TextP","direction"].forEach((W)=>delete E[W]);import q0 from"gremlin";var K8=function(){return new T0(null,null,new q0.process.Bytecode)},{GraphTraversal:I8,GraphTraversalSource:R8}=q0.process;class T0 extends I8{constructor(W,$,Z){super(W,$,Z)}keys(){return this.valueMap().select(q0.process.column.keys)}next(){return super.next()}nextMap(){return this.next()}}var $$=()=>K8().keys();class F0 extends R8{constructor(W,$,Z){super(W,$,Z,F0,T0)}}import e0 from"stream";import O8 from"util";var C0=(W)=>{return{start_time:W.duration?Date.now():null,fixed_size_buffer:"",count_written:0,count_created:0}};var r=function(W={}){if(W.seed)return W.seed=W.seed*Math.PI*100%100/100;else return Math.random()};var z0={ascii:function({options:W}){const $=[],Z=Math.ceil(r(W)*W.maxWordLength);for(let J=0;J<Z;J++){const Q=Math.floor(r(W)*32);$.push(String.fromCharCode(Q+(Q<16?65:81)))}return $.join("")},int:function({options:W}){return Math.floor(r(W)*Math.pow(2,52))},bool:function({options:W}){return Math.floor(r(W)*2)}};var M8=function(W){return W.replace(/_([a-z])/gi,function($,Z){return Z.toUpperCase()})},B0=(W)=>{if(W.object_mode)W.objectMode=W.object_mode;if(W.high_water_mark)W.highWaterMark=W.high_water_mark;const $={};for(let Q in W)$[M8(Q)]=W[Q];const Z={columns:8,delimiter:",",duration:null,encoding:null,end:null,eof:!1,fixedSize:!1,length:-1,maxWordLength:16,rowDelimiter:"\n",seed:!1,sleep:0};for(let Q in Z)if($[Q]===void 0)$[Q]=Z[Q];if($.eof===!0)$.eof=$.rowDelimiter;if(typeof $.columns==="number")$.columns=new Array($.columns);const J=Object.keys(z0).filter((Q)=>!["super_","camelize"].includes(Q));for(let Q=0;Q<$.columns.length;Q++){const U=$.columns[Q]||"ascii";if(typeof U==="string"){if(!J.includes(U))throw Error(`Invalid column type: got "${U}", default values are ${JSON.stringify(J)}`);$.columns[Q]=z0[U]}}return $};var x0=(W,$,Z,J,Q)=>{const U=[];let X=0;if(W.fixedSize){if(X=$.fixed_size_buffer.length,X!==0)U.push($.fixed_size_buffer)}while(!0){if($.count_created===W.length||W.end&&Date.now()>W.end||W.duration&&Date.now()>$.start_time+W.duration){if(U.length){if(W.objectMode)for(let F of U)J(F);else J(U.join("")+(W.eof?W.eof:""));$.end=!0}else Q();return}let G=[],V;for(let F of W.columns){const N=F({options:W,state:$}),H=typeof N;if(N!==null&&H!=="string"&&H!=="number"){Q(Error(["INVALID_VALUE:","values returned by column function must be","a string, a number or null,",`got ${JSON.stringify(N)}`].join(" ")));return}G.push(N)}if(W.objectMode){V=0;for(let F of G)V+=F.length}else G=($.count_created===0?"":W.rowDelimiter)+G.join(W.delimiter),V=G.length;if($.count_created++,X+V>Z){if(W.objectMode){U.push(G);for(let F of U)J(F)}else{if(W.fixedSize)$.fixed_size_buffer=G.substr(Z-X),U.push(G.substr(0,Z-X));else U.push(G);J(U.join(""))}return}X+=V,U.push(G)}};var d=function(W={}){return this.options=B0(W),e0.Readable.call(this,this.options),this.state=C0(this.options),this};O8.inherits(d,e0.Readable);d.prototype.end=function(){this.push(null)};d.prototype._read=function(W){setImmediate(()=>{this.__read(W)})};d.prototype.__read=function(W){x0(this.options,this.state,W,($)=>{this.__push($)},($)=>{if($)this.destroy($);else this.push(null)})};d.prototype.__push=function(W){const $=()=>{if(this.state.count_written++,this.push(W),this.state.end===!0)return this.push(null)};this.options.sleep>0?setTimeout($,this.options.sleep):$()};class R extends Error{constructor(W,$,Z,...J){if(Array.isArray($))$=$.join(" ").trim();super($);if(Error.captureStackTrace!==void 0)Error.captureStackTrace(this,R);this.code=W;for(let Q of J)for(let U in Q){const X=Q[U];this[U]=Buffer.isBuffer(X)?X.toString(Z.encoding):X==null?X:JSON.parse(JSON.stringify(X))}}}var $1=function(W){return typeof W==="object"&&W!==null&&!Array.isArray(W)};var G0=function(W){const $=[];for(let Z=0,J=W.length;Z<J;Z++){const Q=W[Z];if(Q===void 0||Q===null||Q===!1)$[Z]={disabled:!0};else if(typeof Q==="string")$[Z]={name:Q};else if($1(Q)){if(typeof Q.name!=="string")throw new R("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${Z}`,"when column is an object literal"]);$[Z]=Q}else throw new R("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(Q)} at position ${Z}`])}return $};class W1{constructor(W=100){this.size=W,this.length=0,this.buf=Buffer.allocUnsafe(W)}prepend(W){if(Buffer.isBuffer(W)){const $=this.length+W.length;if($>=this.size){if(this.resize(),$>=this.size)throw Error("INVALID_BUFFER_STATE")}const Z=this.buf;this.buf=Buffer.allocUnsafe(this.size),W.copy(this.buf,0),Z.copy(this.buf,W.length),this.length+=W.length}else{const $=this.length++;if($===this.size)this.resize();const Z=this.clone();this.buf[0]=W,Z.copy(this.buf,1,0,$)}}append(W){const $=this.length++;if($===this.size)this.resize();this.buf[$]=W}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const W=this.length;this.size=this.size*2;const $=Buffer.allocUnsafe(this.size);this.buf.copy($,0,0,W),this.buf=$}toString(W){if(W)return this.buf.slice(0,this.length).toString(W);else return Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}var L0=W1;var S8=12,P8=13,A8=10,w8=32,q8=9,Z1=function(W){return{bomSkipped:!1,bufBytesStart:0,castField:W.cast_function,commenting:!1,error:void 0,enabled:W.from_line===1,escaping:!1,escapeIsQuote:Buffer.isBuffer(W.escape)&&Buffer.isBuffer(W.quote)&&Buffer.compare(W.escape,W.quote)===0,expectedRecordLength:Array.isArray(W.columns)?W.columns.length:void 0,field:new L0(20),firstLineToHeaders:W.cast_first_line_to_header,needMoreDataSize:Math.max(W.comment!==null?W.comment.length:0,...W.delimiter.map(($)=>$.length),W.quote!==null?W.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new L0(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:W.record_delimiter.length===0?0:Math.max(...W.record_delimiter.map(($)=>$.length)),trimChars:[Buffer.from(" ",W.encoding)[0],Buffer.from("\t",W.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([P8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([A8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([S8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([w8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([q8],"utf8").toString(),W.encoding)]}};var J1=function(W){return W.replace(/([A-Z])/g,function($,Z){return"_"+Z.toLowerCase()})};var k0=function(W){const $={};for(let J in W)$[J1(J)]=W[J];if($.encoding===void 0||$.encoding===!0)$.encoding="utf8";else if($.encoding===null||$.encoding===!1)$.encoding=null;else if(typeof $.encoding!=="string"&&$.encoding!==null)throw new R("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify($.encoding)}`],$);if($.bom===void 0||$.bom===null||$.bom===!1)$.bom=!1;else if($.bom!==!0)throw new R("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify($.bom)}`],$);if($.cast_function=null,$.cast===void 0||$.cast===null||$.cast===!1||$.cast==="")$.cast=void 0;else if(typeof $.cast==="function")$.cast_function=$.cast,$.cast=!0;else if($.cast!==!0)throw new R("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify($.cast)}`],$);if($.cast_date===void 0||$.cast_date===null||$.cast_date===!1||$.cast_date==="")$.cast_date=!1;else if($.cast_date===!0)$.cast_date=function(J){const Q=Date.parse(J);return!isNaN(Q)?new Date(Q):J};else if(typeof $.cast_date!=="function")throw new R("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify($.cast_date)}`],$);if($.cast_first_line_to_header=null,$.columns===!0)$.cast_first_line_to_header=void 0;else if(typeof $.columns==="function")$.cast_first_line_to_header=$.columns,$.columns=!0;else if(Array.isArray($.columns))$.columns=G0($.columns);else if($.columns===void 0||$.columns===null||$.columns===!1)$.columns=!1;else throw new R("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify($.columns)}`],$);if($.group_columns_by_name===void 0||$.group_columns_by_name===null||$.group_columns_by_name===!1)$.group_columns_by_name=!1;else if($.group_columns_by_name!==!0)throw new R("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify($.group_columns_by_name)}`],$);else if($.columns===!1)throw new R("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],$);if($.comment===void 0||$.comment===null||$.comment===!1||$.comment==="")$.comment=null;else{if(typeof $.comment==="string")$.comment=Buffer.from($.comment,$.encoding);if(!Buffer.isBuffer($.comment))throw new R("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify($.comment)}`],$)}if($.comment_no_infix===void 0||$.comment_no_infix===null||$.comment_no_infix===!1)$.comment_no_infix=!1;else if($.comment_no_infix!==!0)throw new R("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify($.comment_no_infix)}`],$);const Z=JSON.stringify($.delimiter);if(!Array.isArray($.delimiter))$.delimiter=[$.delimiter];if($.delimiter.length===0)throw new R("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${Z}`],$);if($.delimiter=$.delimiter.map(function(J){if(J===void 0||J===null||J===!1)return Buffer.from(",",$.encoding);if(typeof J==="string")J=Buffer.from(J,$.encoding);if(!Buffer.isBuffer(J)||J.length===0)throw new R("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${Z}`],$);return J}),$.escape===void 0||$.escape===!0)$.escape=Buffer.from('"',$.encoding);else if(typeof $.escape==="string")$.escape=Buffer.from($.escape,$.encoding);else if($.escape===null||$.escape===!1)$.escape=null;if($.escape!==null){if(!Buffer.isBuffer($.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify($.escape)}`)}if($.from===void 0||$.from===null)$.from=1;else{if(typeof $.from==="string"&&/\d+/.test($.from))$.from=parseInt($.from);if(Number.isInteger($.from)){if($.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(W.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify($.from)}`)}if($.from_line===void 0||$.from_line===null)$.from_line=1;else{if(typeof $.from_line==="string"&&/\d+/.test($.from_line))$.from_line=parseInt($.from_line);if(Number.isInteger($.from_line)){if($.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(W.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(W.from_line)}`)}if($.ignore_last_delimiters===void 0||$.ignore_last_delimiters===null)$.ignore_last_delimiters=!1;else if(typeof $.ignore_last_delimiters==="number"){if($.ignore_last_delimiters=Math.floor($.ignore_last_delimiters),$.ignore_last_delimiters===0)$.ignore_last_delimiters=!1}else if(typeof $.ignore_last_delimiters!=="boolean")throw new R("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify($.ignore_last_delimiters)}`],$);if($.ignore_last_delimiters===!0&&$.columns===!1)throw new R("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],$);if($.info===void 0||$.info===null||$.info===!1)$.info=!1;else if($.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify($.info)}`);if($.max_record_size===void 0||$.max_record_size===null||$.max_record_size===!1)$.max_record_size=0;else if(Number.isInteger($.max_record_size)&&$.max_record_size>=0);else if(typeof $.max_record_size==="string"&&/\d+/.test($.max_record_size))$.max_record_size=parseInt($.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify($.max_record_size)}`);if($.objname===void 0||$.objname===null||$.objname===!1)$.objname=void 0;else if(Buffer.isBuffer($.objname)){if($.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");if($.encoding===null);else $.objname=$.objname.toString($.encoding)}else if(typeof $.objname==="string"){if($.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof $.objname==="number");else throw new Error(`Invalid Option: objname must be a string or a buffer, got ${$.objname}`);if($.objname!==void 0){if(typeof $.objname==="number"){if($.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if($.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if($.on_record===void 0||$.on_record===null)$.on_record=void 0;else if(typeof $.on_record!=="function")throw new R("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify($.on_record)}`],$);if($.quote===null||$.quote===!1||$.quote==="")$.quote=null;else{if($.quote===void 0||$.quote===!0)$.quote=Buffer.from('"',$.encoding);else if(typeof $.quote==="string")$.quote=Buffer.from($.quote,$.encoding);if(!Buffer.isBuffer($.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify($.quote)}`)}if($.raw===void 0||$.raw===null||$.raw===!1)$.raw=!1;else if($.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify($.raw)}`);if($.record_delimiter===void 0)$.record_delimiter=[];else if(typeof $.record_delimiter==="string"||Buffer.isBuffer($.record_delimiter)){if($.record_delimiter.length===0)throw new R("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify($.record_delimiter)}`],$);$.record_delimiter=[$.record_delimiter]}else if(!Array.isArray($.record_delimiter))throw new R("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify($.record_delimiter)}`],$);if($.record_delimiter=$.record_delimiter.map(function(J,Q){if(typeof J!=="string"&&!Buffer.isBuffer(J))throw new R("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${Q},`,`got ${JSON.stringify(J)}`],$);else if(J.length===0)throw new R("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${Q},`,`got ${JSON.stringify(J)}`],$);if(typeof J==="string")J=Buffer.from(J,$.encoding);return J}),typeof $.relax_column_count==="boolean");else if($.relax_column_count===void 0||$.relax_column_count===null)$.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify($.relax_column_count)}`);if(typeof $.relax_column_count_less==="boolean");else if($.relax_column_count_less===void 0||$.relax_column_count_less===null)$.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify($.relax_column_count_less)}`);if(typeof $.relax_column_count_more==="boolean");else if($.relax_column_count_more===void 0||$.relax_column_count_more===null)$.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify($.relax_column_count_more)}`);if(typeof $.relax_quotes==="boolean");else if($.relax_quotes===void 0||$.relax_quotes===null)$.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify($.relax_quotes)}`);if(typeof $.skip_empty_lines==="boolean");else if($.skip_empty_lines===void 0||$.skip_empty_lines===null)$.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify($.skip_empty_lines)}`);if(typeof $.skip_records_with_empty_values==="boolean");else if($.skip_records_with_empty_values===void 0||$.skip_records_with_empty_values===null)$.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify($.skip_records_with_empty_values)}`);if(typeof $.skip_records_with_error==="boolean");else if($.skip_records_with_error===void 0||$.skip_records_with_error===null)$.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify($.skip_records_with_error)}`);if($.rtrim===void 0||$.rtrim===null||$.rtrim===!1)$.rtrim=!1;else if($.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify($.rtrim)}`);if($.ltrim===void 0||$.ltrim===null||$.ltrim===!1)$.ltrim=!1;else if($.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify($.ltrim)}`);if($.trim===void 0||$.trim===null||$.trim===!1)$.trim=!1;else if($.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify($.trim)}`);if($.trim===!0&&W.ltrim!==!1)$.ltrim=!0;else if($.ltrim!==!0)$.ltrim=!1;if($.trim===!0&&W.rtrim!==!1)$.rtrim=!0;else if($.rtrim!==!0)$.rtrim=!1;if($.to===void 0||$.to===null)$.to=-1;else{if(typeof $.to==="string"&&/\d+/.test($.to))$.to=parseInt($.to);if(Number.isInteger($.to)){if($.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(W.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(W.to)}`)}if($.to_line===void 0||$.to_line===null)$.to_line=-1;else{if(typeof $.to_line==="string"&&/\d+/.test($.to_line))$.to_line=parseInt($.to_line);if(Number.isInteger($.to_line)){if($.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(W.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(W.to_line)}`)}return $};var Q1=function(W){return W.every(($)=>$==null||$.toString&&$.toString().trim()==="")},T8=13,C8=10,c={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},U1=function(W={}){const $={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},Z=k0(W);return{info:$,original_options:W,options:Z,state:Z1(Z),__needMoreData:function(J,Q,U){if(U)return!1;const{encoding:X,escape:G,quote:V}=this.options,{quoting:F,needMoreDataSize:N,recordDelimiterMaxLength:H}=this.state,Y=Q-J-1,K=Math.max(N,H===0?Buffer.from("\r\n",X).length:H,F?(G===null?0:G.length)+V.length:0,F?V.length+H:0);return Y<K},parse:function(J,Q,U,X){const{bom:G,comment_no_infix:V,encoding:F,from_line:N,ltrim:H,max_record_size:Y,raw:K,relax_quotes:T,rtrim:M,skip_empty_lines:O,to:w,to_line:A}=this.options;let{comment:S,escape:B,quote:k,record_delimiter:H0}=this.options;const{bomSkipped:P1,previousBuf:o,rawBuffer:A1,escapeIsQuote:w1}=this.state;let P;if(o===void 0)if(J===void 0){X();return}else P=J;else if(o!==void 0&&J===void 0)P=o;else P=Buffer.concat([o,J]);if(P1===!1)if(G===!1)this.state.bomSkipped=!0;else if(P.length<3){if(Q===!1){this.state.previousBuf=P;return}}else{for(let q in c)if(c[q].compare(P,0,c[q].length)===0){const j=c[q].length;this.state.bufBytesStart+=j,P=P.slice(j),this.options=k0({...this.original_options,encoding:q}),{comment:S,escape:B,quote:k}=this.options;break}this.state.bomSkipped=!0}const I0=P.length;let I;for(I=0;I<I0;I++){if(this.__needMoreData(I,I0,Q))break;if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1;if(A!==-1&&this.info.lines>A){this.state.stop=!0,X();return}if(this.state.quoting===!1&&H0.length===0){if(this.__autoDiscoverRecordDelimiter(P,I))H0=this.options.record_delimiter}const q=P[I];if(K===!0)A1.append(q);if((q===T8||q===C8)&&this.state.wasRowDelimiter===!1)this.state.wasRowDelimiter=!0;if(this.state.escaping===!0)this.state.escaping=!1;else{if(B!==null&&this.state.quoting===!0&&this.__isEscape(P,I,q)&&I+B.length<I0)if(w1){if(this.__isQuote(P,I+B.length)){this.state.escaping=!0,I+=B.length-1;continue}}else{this.state.escaping=!0,I+=B.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(P,I))if(this.state.quoting===!0){const C=P[I+k.length],p=M&&this.__isCharTrimable(P,I+k.length),y=S!==null&&this.__compareBytes(S,P,I+k.length,C),g=this.__isDelimiter(P,I+k.length,C),e=H0.length===0?this.__autoDiscoverRecordDelimiter(P,I+k.length):this.__isRecordDelimiter(C,P,I+k.length);if(B!==null&&this.__isEscape(P,I,q)&&this.__isQuote(P,I+B.length))I+=B.length-1;else if(!C||g||e||y||p){this.state.quoting=!1,this.state.wasQuoting=!0,I+=k.length-1;continue}else if(T===!1){const a=this.__error(new R("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(C)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(a!==void 0)return a}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(k),I+=k.length-1}else if(this.state.field.length!==0){if(T===!1){const C=this.__infoField(),p=Object.keys(c).map((g)=>c[g].equals(this.state.field.toString())?g:!1).filter(Boolean)[0],y=this.__error(new R("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(C.column)} at line ${C.lines}, value is ${JSON.stringify(this.state.field.toString(F))}`,p?`(${p} bom)`:void 0],this.options,C,{field:this.state.field}));if(y!==void 0)return y}}else{this.state.quoting=!0,I+=k.length-1;continue}if(this.state.quoting===!1){const C=this.__isRecordDelimiter(q,P,I);if(C!==0){if(this.state.commenting&&(this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0))this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=N){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),I+=C-1;continue}if(O===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,I+=C-1;continue}this.info.bytes=this.state.bufBytesStart+I;const e=this.__onField();if(e!==void 0)return e;this.info.bytes=this.state.bufBytesStart+I+C;const a=this.__onRecord(U);if(a!==void 0)return a;if(w!==-1&&this.info.records>=w){this.state.stop=!0,X();return}}this.state.commenting=!1,I+=C-1;continue}if(this.state.commenting)continue;if((S===null?0:this.__compareBytes(S,P,I,q))!==0&&(V===!1||this.state.field.length===0)){this.state.commenting=!0;continue}const y=this.__isDelimiter(P,I,q);if(y!==0){this.info.bytes=this.state.bufBytesStart+I;const g=this.__onField();if(g!==void 0)return g;I+=y-1;continue}}}if(this.state.commenting===!1){if(Y!==0&&this.state.record_length+this.state.field.length>Y)return this.__error(new R("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${Y}`,`at line ${this.info.lines}`],this.options,this.__infoField()))}const j=H===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(P,I),q1=M===!1||this.state.wasQuoting===!1;if(j===!0&&q1===!0)this.state.field.append(q);else if(M===!0&&!this.__isCharTrimable(P,I))return this.__error(new R("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));else{if(j===!1)I+=this.__isCharTrimable(P,I)-1;continue}}if(Q===!0){if(this.state.quoting===!0){const q=this.__error(new R("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(q!==void 0)return q}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+I;const q=this.__onField();if(q!==void 0)return q;const j=this.__onRecord(U);if(j!==void 0)return j}else if(this.state.wasRowDelimiter===!0)this.info.empty_lines++;else if(this.state.commenting===!0)this.info.comment_lines++}else this.state.bufBytesStart+=I,this.state.previousBuf=P.slice(I);if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1},__onRecord:function(J){const{columns:Q,group_columns_by_name:U,encoding:X,info:G,from:V,relax_column_count:F,relax_column_count_less:N,relax_column_count_more:H,raw:Y,skip_records_with_empty_values:K}=this.options,{enabled:T,record:M}=this.state;if(T===!1)return this.__resetRecord();const O=M.length;if(Q===!0){if(K===!0&&Q1(M)){this.__resetRecord();return}return this.__firstLineToColumns(M)}if(Q===!1&&this.info.records===0)this.state.expectedRecordLength=O;if(O!==this.state.expectedRecordLength){const w=Q===!1?new R("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${O} on line ${this.info.lines}`],this.options,this.__infoField(),{record:M}):new R("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${Q.length},`,`got ${O} on line ${this.info.lines}`],this.options,this.__infoField(),{record:M});if(F===!0||N===!0&&O<this.state.expectedRecordLength||H===!0&&O>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=w;else{const A=this.__error(w);if(A)return A}}if(K===!0&&Q1(M)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,V===1||this.info.records>=V){const{objname:w}=this.options;if(Q!==!1){const A={};for(let S=0,B=M.length;S<B;S++){if(Q[S]===void 0||Q[S].disabled)continue;if(U===!0&&A[Q[S].name]!==void 0)if(Array.isArray(A[Q[S].name]))A[Q[S].name]=A[Q[S].name].concat(M[S]);else A[Q[S].name]=[A[Q[S].name],M[S]];else A[Q[S].name]=M[S]}if(Y===!0||G===!0){const S=Object.assign({record:A},Y===!0?{raw:this.state.rawBuffer.toString(X)}:{},G===!0?{info:this.__infoRecord()}:{}),B=this.__push(w===void 0?S:[A[w],S],J);if(B)return B}else{const S=this.__push(w===void 0?A:[A[w],A],J);if(S)return S}}else if(Y===!0||G===!0){const A=Object.assign({record:M},Y===!0?{raw:this.state.rawBuffer.toString(X)}:{},G===!0?{info:this.__infoRecord()}:{}),S=this.__push(w===void 0?A:[M[w],A],J);if(S)return S}else{const A=this.__push(w===void 0?M:[M[w],M],J);if(A)return A}}this.__resetRecord()},__firstLineToColumns:function(J){const{firstLineToHeaders:Q}=this.state;try{const U=Q===void 0?J:Q.call(null,J);if(!Array.isArray(U))return this.__error(new R("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(U)}`],this.options,this.__infoField(),{headers:U}));const X=G0(U);this.state.expectedRecordLength=X.length,this.options.columns=X,this.__resetRecord();return}catch(U){return U}},__resetRecord:function(){if(this.options.raw===!0)this.state.rawBuffer.reset();this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:J,encoding:Q,rtrim:U,max_record_size:X}=this.options,{enabled:G,wasQuoting:V}=this.state;if(G===!1)return this.__resetField();let F=this.state.field.toString(Q);if(U===!0&&V===!1)F=F.trimRight();if(J===!0){const[N,H]=this.__cast(F);if(N!==void 0)return N;F=H}if(this.state.record.push(F),X!==0&&typeof F==="string")this.state.record_length+=F.length;this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(J,Q){const{on_record:U}=this.options;if(U!==void 0){const X=this.__infoRecord();try{J=U.call(null,J,X)}catch(G){return G}if(J===void 0||J===null)return}Q(J)},__cast:function(J){const{columns:Q,relax_column_count:U}=this.options;if(Array.isArray(Q)===!0&&U&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const G=this.__infoField();return[void 0,this.state.castField.call(null,J,G)]}catch(G){return[G]}if(this.__isFloat(J))return[void 0,parseFloat(J)];else if(this.options.cast_date!==!1){const G=this.__infoField();return[void 0,this.options.cast_date.call(null,J,G)]}return[void 0,J]},__isCharTrimable:function(J,Q){return((X,G)=>{const{timchars:V}=this.state;$:for(let F=0;F<V.length;F++){const N=V[F];for(let H=0;H<N.length;H++)if(N[H]!==X[G+H])continue $;return N.length}return 0})(J,Q)},__isFloat:function(J){return J-parseFloat(J)+1>=0},__compareBytes:function(J,Q,U,X){if(J[0]!==X)return 0;const G=J.length;for(let V=1;V<G;V++)if(J[V]!==Q[U+V])return 0;return G},__isDelimiter:function(J,Q,U){const{delimiter:X,ignore_last_delimiters:G}=this.options;if(G===!0&&this.state.record.length===this.options.columns.length-1)return 0;else if(G!==!1&&typeof G==="number"&&this.state.record.length===G-1)return 0;$:for(let V=0;V<X.length;V++){const F=X[V];if(F[0]===U){for(let N=1;N<F.length;N++)if(F[N]!==J[Q+N])continue $;return F.length}}return 0},__isRecordDelimiter:function(J,Q,U){const{record_delimiter:X}=this.options,G=X.length;$:for(let V=0;V<G;V++){const F=X[V],N=F.length;if(F[0]!==J)continue;for(let H=1;H<N;H++)if(F[H]!==Q[U+H])continue $;return F.length}return 0},__isEscape:function(J,Q,U){const{escape:X}=this.options;if(X===null)return!1;const G=X.length;if(X[0]===U){for(let V=0;V<G;V++)if(X[V]!==J[Q+V])return!1;return!0}return!1},__isQuote:function(J,Q){const{quote:U}=this.options;if(U===null)return!1;const X=U.length;for(let G=0;G<X;G++)if(U[G]!==J[Q+G])return!1;return!0},__autoDiscoverRecordDelimiter:function(J,Q){const{encoding:U}=this.options,X=[Buffer.from("\r\n",U),Buffer.from("\n",U),Buffer.from("\r",U)];$:for(let G=0;G<X.length;G++){const V=X[G].length;for(let F=0;F<V;F++)if(X[G][F]!==J[Q+F])continue $;return this.options.record_delimiter.push(X[G]),this.state.recordDelimiterMaxLength=X[G].length,X[G].length}return 0},__error:function(J){const{encoding:Q,raw:U,skip_records_with_error:X}=this.options,G=typeof J==="string"?new Error(J):J;if(X){if(this.state.recordHasError=!0,this.options.on_skip!==void 0)this.options.on_skip(G,U?this.state.rawBuffer.toString(Q):void 0);return}else return G},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:J,raw:Q,encoding:U}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:J===!0,index:this.state.record.length,raw:Q?this.state.rawBuffer.toString(U):void 0}},__infoField:function(){const{columns:J}=this.options,Q=Array.isArray(J);return{...this.__infoRecord(),column:Q===!0?J.length>this.state.record.length?J[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}};var D0=function(W,$={}){if(typeof W==="string")W=Buffer.from(W);const Z=$&&$.objname?{}:[],J=U1($),Q=(V)=>{if(J.options.objname===void 0)Z.push(V);else Z[V[0]]=V[1]},U=()=>{},X=J.parse(W,!1,Q,U);if(X!==void 0)throw X;const G=J.parse(void 0,!0,Q,U);if(G!==void 0)throw G;return Z};var u$=".".charCodeAt(0);var d$=RegExp('[^.[\\]]+|\\[(?:([^"\'][^[]*)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))',"g");var FW=Buffer.from([239,187,191]);import X1 from"stream";import x8 from"util";var s=function(W={},$){if(this.options=W,W.consume===void 0||W.consume===null)this.options.consume=!1;if(this.options.objectMode=!0,W.parallel===void 0||W.parallel===null)this.options.parallel=100;if(W.params===void 0||W.params===null)W.params=null;return this.handler=$,X1.Transform.call(this,this.options),this.state={running:0,started:0,finished:0,paused:!1},this};x8.inherits(s,X1.Transform);s.prototype._transform=function(W,$,Z){if(this.state.started++,this.state.running++,!this.state.paused&&this.state.running<this.options.parallel)Z(),Z=null;try{let J=this.handler.length;if(this.options.params!==null)J--;if(J===1){const Q=this.handler.call(this,W,this.options.params);this.__done(null,[Q],Z)}else if(J===2){const Q=(U,...X)=>this.__done(U,X,Z);this.handler.call(this,W,Q,this.options.params)}else throw Error("Invalid handler arguments");return!1}catch(J){this.__done(J)}};s.prototype._flush=function(W){if(this.state.running===0)W();else this._ending=function(){W()}};s.prototype.__done=function(W,$,Z){if(this.state.running--,W)return this.emit("error",W);this.state.finished++;for(let J of $){if(typeof J==="number")J=`${J}`;if(J!==void 0&&J!==null&&J!=="")this.state.paused=!this.push(J)}if(Z)Z();if(this._ending&&this.state.running===0)this._ending()};import h8 from"fs/promises";var m=(W,...$)=>{console.info(`${Date()}\n`,`${W}\n`,...$,"\n\n")};import L8 from"path";var F1=(W)=>L8.parse(W).name,G1=(W,$="csv")=>`${W}.${$}`,LW=(W)=>new Date(W.replace(/['"]+/g,"")),E0=Object.create(null),kW=(W)=>{if(!E0[W])E0[W]=Bun.hash(W).toString();return E0[W]},k8=(W)=>{if(!String(W).length)throw new Error(`neptune requires edges to have exactly 1 label: ${W} received`);return W},j0=(W)=>{if(!W.length)throw new Error("neptune requires at least 1 label for vertices");return W[0]},DW=(W)=>W==="v"?j0:k8,V1=(W)=>W.reduce(($,Z)=>{if(Z.status==="rejected")$.failure.push(Z.reason);else $.success.push(Z.value);return $},{success:[],failure:[]});var{t:N0,Direction:Y1,merge:V0}=E,D8=(W)=>W.edges.map(($)=>{if(!$.recordId)throw new Error(`all edges require a user supplied recordId\n${JSON.stringify($)}`);const Z=new Map(Object.entries($.p||{}));return Z.set(N0.label,$.l),Z.set(Y1.OUT,$.f),Z.set(Y1.IN,$.t),[new Map([[N0.id,$.recordId]]),Z]}),E8=(W)=>{if(!W.recordId)throw new Error("all vertices require a user supplied recordId");const $=new Map(Object.entries(W.p));return $.set(N0.label,j0(W.l)),[new Map([[N0.id,W.recordId]]),$]},H1=async(W,$)=>Promise.allSettled(W.flatMap((Z)=>{if($.type==="v"){const[J,Q]=E8(Z);return g0.mergeV(J).option(V0.onCreate,Q).option(V0.onMatch,Q).toList()}return D8(Z).map(([J,Q])=>g0.mergeE(J).option(V0.onCreate,Q).option(V0.onMatch,Q).toList())}).filter(Boolean)).then(V1);var I1=(W)=>{if(typeof W!=="string"||typeof W!=="number")throw new Error(`invalid type, expected number|string, received: ${typeof W}`);return W},R1=(W,$,Z)=>{const J={...W.inject?.p||{}},Q=W.inject?.l?.slice()??[];return Z.forEach((U,X)=>{if(W.colMap?.ignoreCols?.includes(X))return;if(W.colMap?.ignoreEmptyCol&&String(U).length===0)return;const G=$[X],V=W.colMap?.transform?.(X,U)??U;if(W.colMap?.p?.includes(X))J[G]=V;else if(W.colMap?.l?.includes(X))if(Q.length)J[G]=V;else Q.push(I1(V));else if(W.colMap?.default)switch(W.colMap.default){case"p":J[G]=V;break;default:if(Q.length)J[G]=V;else Q.push(I1(V))}}),{p:J,l:Q}},g8=(W,$,Z)=>$.map((J)=>{const Q=W.transformRecord?.(J)??J,U=R1(W,Z,Q);return{edges:W.edges.map((X)=>({f:X.f(U,Q),t:X.t(U,Q),l:X.l(U,Q),p:X.p?.(U)??{},recordId:X.recordId(U,Q)}))}}),y8=(W,$,Z)=>$.map((J)=>{const Q=W.transformRecord?.(J)??J,U=R1(W,Z,Q);return{recordId:W.recordId(U,Q),...U}}),K1=async(W,$)=>{const Z=W.transformHeaders?.($[0])??$[0];switch(W.type){case"v":return y8(W,$.slice(1),Z);case"e":return g8(W,$.slice(1),Z)}};var v=(W={})=>({files:new Set,parsed:new Map,transformed:new Map,...W}),y0=async(W,$,Z,J=v())=>{if(!J.parsed.has(W))throw new Error(`csv not parsed: ${W}`);J.transformed.set(Z||W,{spec:$,data:await K1($,J.parsed.get(W))})},M1=async(W,$,Z=v())=>{try{Z.parsed.set(W,D0(await Bun.file($).text()))}catch(J){throw new Error(`invalid csv ${W}: ${$}\n${J}`)}},m8=async(W,$=v())=>{(await h8.readdir(W)).forEach((Z)=>Z.endsWith(".csv")&&$.files.add(Z)),m("total csv files found",$.files.size)},v8=async(W,$=v())=>{if(!W.files)return;for(let[Z,J]of W.files){const Q=typeof J==="function"?J(Z):J;if(Q.recursive)await y0(Q.recursive,Q,Z,$);else{const U=G1(Z);if(!$.files.has(U))throw new Error(`could not find file: ${U}`);$.files.delete(U),await M1(Z,`${W.csvDir}/${U}`,$),await y0(Z,Q,void 0,$)}}m("transformed config.files",$.transformed.size)},_8=async(W,$=v())=>{if(!W.includeUnmappedFiles)return;if(!W.getSpec)throw new Error("Including unmapped files requires config.getSpec to be defined");let Z=0;for(let J of $.files){const Q=F1(J),U=W.getSpec(Q);if(!U)continue;Z++,$.files.delete(J),await M1(Q,`${W.csvDir}/${J}`,$),await y0(Q,U,void 0,$)}m(`
    unmapped csvs processed ${Z}
    unmapped csvs ignored: ${$.files.size}
    `)},b8=async(W,$=v())=>{if(!$.transformed.size)throw new Error(`
      no CSV files transformed. Did you correctly map CSV filenames to config specs?
      CSVs pared: ${$.parsed.size}
      CSVs ignored: ${$.files.size}
      CSVs transformed: ${$.transformed.size}
      `);for(let[Z,J]of $.transformed.entries()){const Q=await H1(J.data,J.spec);if(W.persistResultLog){const U=`${W.csvDir}/${Z}.csv.json`;Bun.write(U,JSON.stringify(Q||"result is empty")),m(`result log saved to ${U}`)}m(`loaded ${Z} into tinkergraph`,{success:Q.success.length??0,failure:Q.failure.length??0})}m("total csvs loaded in tinkergraph",$.transformed.size)},fW=async(W,$=v())=>{await m8(W.csvDir,$),await v8(W,$),await _8(W,$),await b8(W,$)},hW=()=>null;var{t}=E,{keys:l8,values:u8}=E.column,{addAll:O1}=E.operator,{flatMap:d8,identity:Y0,project:c8,select:p8,unfold:S1,union:a8,valueMap:i8}=E.__,cW=(W)=>({...W,limitX:W.limitX??0,limitY:W.limitY??(W.limitX??0)+10}),pW=(W,$)=>{if(!Array.isArray($)||!$.length)throw new Error(`${W} must be a non empty array\nreceived: ${$}`);return!1},aW=(W,...$)=>{throw new Error(`Invalid Query\n${W}\n${JSON.stringify($)}`)},iW=({as:W=[],elements:$=Y0(),elKeys:Z=[]})=>$.as(...W.concat("base")).valueMap(...Z).by(S1()).sack(O1).select("base").project("id","label").by(t.id).by(t.label).sack(O1),nW=({elements:W=Y0(),elKeys:$=[],traversals:Z=[]})=>W.local(a8(c8("id","label").by(t.id).by(t.label),i8(...$).by(S1()),...Z).unfold().group().by(l8).by(p8(u8))),rW=({elements:W=Y0(),elKeys:$=[]})=>W.group().by($[0]??t.id).by(d8(Y0()));var{traversal:n8,DriverRemoteConnection:r8,gremlin:s8}=E,g0=n8(F0).withRemote(new r8("ws://0.0.0.0:8182/gremlin")),$Z=new s8.driver.Client("ws://0.0.0.0:8182/gremlin",{traversalSource:"g",session:`${Date.now()}`});export{I1 as validateNumStr,_8 as transformUnmappedFiles,R1 as transformPropsAndLabels,v8 as transformConfigFiles,y0 as transformAndSaveTinkerData,c6 as toJsonStringified,d6 as toJson,p6 as toBunBuffer,hW as tinkergraphToNeptuneCsv,E8 as tinkerDataVertex,D8 as tinkerDataEdge,H1 as tinkerData,aW as throwInvalidQuery,pW as throwIfEmpty,V1 as recordsCreatedHandler,m8 as readCsvDir,LW as pgDateToJs,M1 as parseFile,o0 as msgpackToJsonIterator,i6 as msgpackToJson,V8 as mapTojsonReplacer,r0 as mapToJsonIterator,m as log,b8 as loadTinkerData,$$ as keys,kW as hashId,rW as groupByIdentity,H8 as go,j0 as getVertexLabel,v as getStore,DW as getLabel,k8 as getEdgeLabel,cW as getBaseOpts,g0 as g,a6 as fromBunBuffer,F1 as fnameToBname,D as extensionCodec,s0 as encoder,iW as elementProps,w0 as deepFreezeCopy,h as decoder,fW as csvToTinkergraph,y8 as csvToTinkerDataVertex,g8 as csvToTinkerDataEdge,K1 as csvToTinkerData,E as common,nW as combineProps,$Z as client,G1 as bnameTofname,Y8 as SET_EXT_TYPE,N8 as MSGPACK_HEADERS,t0 as MAP_EXT_TYPE,F0 as GroovyTraversalSource,T0 as GroovyTraversal,X0 as EDir};
