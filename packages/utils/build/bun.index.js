// @bun
var T1=Object.create;var{defineProperty:f0,getPrototypeOf:C1,getOwnPropertyNames:z1}=Object;var B1=Object.prototype.hasOwnProperty;var x1=(W,$,Z)=>{Z=W!=null?T1(C1(W)):{};const J=$||!W||!W.__esModule?f0(Z,"default",{value:W,enumerable:!0}):Z;for(let Q of z1(W))if(!B1.call(J,Q))f0(J,Q,{get:()=>W[Q],enumerable:!0});return J};var L1=(W)=>{return import.meta.require(W)};function h0(W){var $=W.length,Z=0,J=0;while(J<$){var Q=W.charCodeAt(J++);if((Q&4294967168)===0){Z++;continue}else if((Q&4294965248)===0)Z+=2;else{if(Q>=55296&&Q<=56319){if(J<$){var U=W.charCodeAt(J);if((U&64512)===56320)++J,Q=((Q&1023)<<10)+(U&1023)+65536}}if((Q&4294901760)===0)Z+=3;else Z+=4}}return Z}function k1(W,$,Z){var J=W.length,Q=Z,U=0;while(U<J){var V=W.charCodeAt(U++);if((V&4294967168)===0){$[Q++]=V;continue}else if((V&4294965248)===0)$[Q++]=V>>6&31|192;else{if(V>=55296&&V<=56319){if(U<J){var F=W.charCodeAt(U);if((F&64512)===56320)++U,V=((V&1023)<<10)+(F&1023)+65536}}if((V&4294901760)===0)$[Q++]=V>>12&15|224,$[Q++]=V>>6&63|128;else $[Q++]=V>>18&7|240,$[Q++]=V>>12&63|128,$[Q++]=V>>6&63|128}$[Q++]=V&63|128}}function j1(W,$,Z){D1.encodeInto(W,$.subarray(Z))}function m0(W,$,Z){if(W.length>E1)j1(W,$,Z);else k1(W,$,Z)}function M0(W,$,Z){var J=$,Q=J+Z,U=[],V="";while(J<Q){var F=W[J++];if((F&128)===0)U.push(F);else if((F&224)===192){var N=W[J++]&63;U.push((F&31)<<6|N)}else if((F&240)===224){var N=W[J++]&63,X=W[J++]&63;U.push((F&31)<<12|N<<6|X)}else if((F&248)===240){var N=W[J++]&63,X=W[J++]&63,G=W[J++]&63,H=(F&7)<<18|N<<12|X<<6|G;if(H>65535)H-=65536,U.push(H>>>10&1023|55296),H=56320|H&1023;U.push(H)}else U.push(F);if(U.length>=g1)V+=String.fromCharCode.apply(String,U),U.length=0}if(U.length>0)V+=String.fromCharCode.apply(String,U);return V}function h1(W,$,Z){var J=W.subarray($,$+Z);return y1.decode(J)}function v0(W,$,Z){if(Z>f1)return h1(W,$,Z);else return M0(W,$,Z)}var D1=new TextEncoder,E1=50,g1=4096,y1=new TextDecoder,f1=200;var a=function(){function W($,Z){this.type=$,this.data=Z}return W}();var m1=function(){var W=function($,Z){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,Q){J.__proto__=Q}||function(J,Q){for(var U in Q)if(Object.prototype.hasOwnProperty.call(Q,U))J[U]=Q[U]},W($,Z)};return function($,Z){if(typeof Z!=="function"&&Z!==null)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");W($,Z);function J(){this.constructor=$}$.prototype=Z===null?Object.create(Z):(J.prototype=Z.prototype,new J)}}(),x=function(W){m1($,W);function $(Z){var J=W.call(this,Z)||this,Q=Object.create($.prototype);return Object.setPrototypeOf(J,Q),Object.defineProperty(J,"name",{configurable:!0,enumerable:!1,value:$.name}),J}return $}(Error);function _0(W,$,Z){var J=Z/4294967296,Q=Z;W.setUint32($,J),W.setUint32($+4,Q)}function $0(W,$,Z){var J=Math.floor(Z/4294967296),Q=Z;W.setUint32($,J),W.setUint32($+4,Q)}function W0(W,$){var Z=W.getInt32($),J=W.getUint32($+4);return Z*4294967296+J}function b0(W,$){var Z=W.getUint32($),J=W.getUint32($+4);return Z*4294967296+J}var _=4294967295;function l1(W){var{sec:$,nsec:Z}=W;if($>=0&&Z>=0&&$<=b1)if(Z===0&&$<=_1){var J=new Uint8Array(4),Q=new DataView(J.buffer);return Q.setUint32(0,$),J}else{var U=$/4294967296,V=$&4294967295,J=new Uint8Array(8),Q=new DataView(J.buffer);return Q.setUint32(0,Z<<2|U&3),Q.setUint32(4,V),J}else{var J=new Uint8Array(12),Q=new DataView(J.buffer);return Q.setUint32(0,Z),$0(Q,4,$),J}}function u1(W){var $=W.getTime(),Z=Math.floor($/1000),J=($-Z*1000)*1e6,Q=Math.floor(J/1e9);return{sec:Z+Q,nsec:J-Q*1e9}}function d1(W){if(W instanceof Date){var $=u1(W);return l1($)}else return null}function c1(W){var $=new DataView(W.buffer,W.byteOffset,W.byteLength);switch(W.byteLength){case 4:{var Z=$.getUint32(0),J=0;return{sec:Z,nsec:J}}case 8:{var Q=$.getUint32(0),U=$.getUint32(4),Z=(Q&3)*4294967296+U,J=Q>>>2;return{sec:Z,nsec:J}}case 12:{var Z=W0($,4),J=$.getUint32(0);return{sec:Z,nsec:J}}default:throw new x("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(W.length))}}function p1(W){var $=c1(W);return new Date($.sec*1000+$.nsec/1e6)}var v1=-1,_1=4294967295,b1=17179869183,l0={type:v1,encode:d1,decode:p1};var f=function(){function W(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(l0)}return W.prototype.register=function($){var{type:Z,encode:J,decode:Q}=$;if(Z>=0)this.encoders[Z]=J,this.decoders[Z]=Q;else{var U=1+Z;this.builtInEncoders[U]=J,this.builtInDecoders[U]=Q}},W.prototype.tryToEncode=function($,Z){for(var J=0;J<this.builtInEncoders.length;J++){var Q=this.builtInEncoders[J];if(Q!=null){var U=Q($,Z);if(U!=null){var V=-1-J;return new a(V,U)}}}for(var J=0;J<this.encoders.length;J++){var Q=this.encoders[J];if(Q!=null){var U=Q($,Z);if(U!=null){var V=J;return new a(V,U)}}}if($ instanceof a)return $;return null},W.prototype.decode=function($,Z,J){var Q=Z<0?this.builtInDecoders[-1-Z]:this.decoders[Z];if(Q)return Q($,Z,J);else return new a(Z,$)},W.defaultCodec=new W,W}();function b(W){if(W instanceof Uint8Array)return W;else if(ArrayBuffer.isView(W))return new Uint8Array(W.buffer,W.byteOffset,W.byteLength);else if(W instanceof ArrayBuffer)return new Uint8Array(W);else return Uint8Array.from(W)}function u0(W){if(W instanceof ArrayBuffer)return new DataView(W);var $=b(W);return new DataView($.buffer,$.byteOffset,$.byteLength)}var i1=100,a1=2048,d0=function(){function W($){var Z,J,Q,U,V,F,N,X;this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:f.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxDepth=(Q=$===null||$===void 0?void 0:$.maxDepth)!==null&&Q!==void 0?Q:i1,this.initialBufferSize=(U=$===null||$===void 0?void 0:$.initialBufferSize)!==null&&U!==void 0?U:a1,this.sortKeys=(V=$===null||$===void 0?void 0:$.sortKeys)!==null&&V!==void 0?V:!1,this.forceFloat32=(F=$===null||$===void 0?void 0:$.forceFloat32)!==null&&F!==void 0?F:!1,this.ignoreUndefined=(N=$===null||$===void 0?void 0:$.ignoreUndefined)!==null&&N!==void 0?N:!1,this.forceIntegerToFloat=(X=$===null||$===void 0?void 0:$.forceIntegerToFloat)!==null&&X!==void 0?X:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return W.prototype.reinitializeState=function(){this.pos=0},W.prototype.encodeSharedRef=function($){return this.reinitializeState(),this.doEncode($,1),this.bytes.subarray(0,this.pos)},W.prototype.encode=function($){return this.reinitializeState(),this.doEncode($,1),this.bytes.slice(0,this.pos)},W.prototype.doEncode=function($,Z){if(Z>this.maxDepth)throw new Error("Too deep objects in depth ".concat(Z));if($==null)this.encodeNil();else if(typeof $==="boolean")this.encodeBoolean($);else if(typeof $==="number")if(!this.forceIntegerToFloat)this.encodeNumber($);else this.encodeNumberAsFloat($);else if(typeof $==="string")this.encodeString($);else if(this.useBigInt64&&typeof $==="bigint")this.encodeBigInt64($);else this.encodeObject($,Z)},W.prototype.ensureBufferSizeToWrite=function($){var Z=this.pos+$;if(this.view.byteLength<Z)this.resizeBuffer(Z*2)},W.prototype.resizeBuffer=function($){var Z=new ArrayBuffer($),J=new Uint8Array(Z),Q=new DataView(Z);J.set(this.bytes),this.view=Q,this.bytes=J},W.prototype.encodeNil=function(){this.writeU8(192)},W.prototype.encodeBoolean=function($){if($===!1)this.writeU8(194);else this.writeU8(195)},W.prototype.encodeNumber=function($){if(!this.forceIntegerToFloat&&Number.isSafeInteger($))if($>=0)if($<128)this.writeU8($);else if($<256)this.writeU8(204),this.writeU8($);else if($<65536)this.writeU8(205),this.writeU16($);else if($<4294967296)this.writeU8(206),this.writeU32($);else if(!this.useBigInt64)this.writeU8(207),this.writeU64($);else this.encodeNumberAsFloat($);else if($>=-32)this.writeU8(224|$+32);else if($>=-128)this.writeU8(208),this.writeI8($);else if($>=-32768)this.writeU8(209),this.writeI16($);else if($>=-2147483648)this.writeU8(210),this.writeI32($);else if(!this.useBigInt64)this.writeU8(211),this.writeI64($);else this.encodeNumberAsFloat($);else this.encodeNumberAsFloat($)},W.prototype.encodeNumberAsFloat=function($){if(this.forceFloat32)this.writeU8(202),this.writeF32($);else this.writeU8(203),this.writeF64($)},W.prototype.encodeBigInt64=function($){if($>=BigInt(0))this.writeU8(207),this.writeBigUint64($);else this.writeU8(211),this.writeBigInt64($)},W.prototype.writeStringHeader=function($){if($<32)this.writeU8(160+$);else if($<256)this.writeU8(217),this.writeU8($);else if($<65536)this.writeU8(218),this.writeU16($);else if($<4294967296)this.writeU8(219),this.writeU32($);else throw new Error("Too long string: ".concat($," bytes in UTF-8"))},W.prototype.encodeString=function($){var Z=5,J=h0($);this.ensureBufferSizeToWrite(Z+J),this.writeStringHeader(J),m0($,this.bytes,this.pos),this.pos+=J},W.prototype.encodeObject=function($,Z){var J=this.extensionCodec.tryToEncode($,this.context);if(J!=null)this.encodeExtension(J);else if(Array.isArray($))this.encodeArray($,Z);else if(ArrayBuffer.isView($))this.encodeBinary($);else if(typeof $==="object")this.encodeMap($,Z);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply($)))},W.prototype.encodeBinary=function($){var Z=$.byteLength;if(Z<256)this.writeU8(196),this.writeU8(Z);else if(Z<65536)this.writeU8(197),this.writeU16(Z);else if(Z<4294967296)this.writeU8(198),this.writeU32(Z);else throw new Error("Too large binary: ".concat(Z));var J=b($);this.writeU8a(J)},W.prototype.encodeArray=function($,Z){var J=$.length;if(J<16)this.writeU8(144+J);else if(J<65536)this.writeU8(220),this.writeU16(J);else if(J<4294967296)this.writeU8(221),this.writeU32(J);else throw new Error("Too large array: ".concat(J));for(var Q=0,U=$;Q<U.length;Q++){var V=U[Q];this.doEncode(V,Z+1)}},W.prototype.countWithoutUndefined=function($,Z){var J=0;for(var Q=0,U=Z;Q<U.length;Q++){var V=U[Q];if($[V]!==void 0)J++}return J},W.prototype.encodeMap=function($,Z){var J=Object.keys($);if(this.sortKeys)J.sort();var Q=this.ignoreUndefined?this.countWithoutUndefined($,J):J.length;if(Q<16)this.writeU8(128+Q);else if(Q<65536)this.writeU8(222),this.writeU16(Q);else if(Q<4294967296)this.writeU8(223),this.writeU32(Q);else throw new Error("Too large map object: ".concat(Q));for(var U=0,V=J;U<V.length;U++){var F=V[U],N=$[F];if(!(this.ignoreUndefined&&N===void 0))this.encodeString(F),this.doEncode(N,Z+1)}},W.prototype.encodeExtension=function($){var Z=$.data.length;if(Z===1)this.writeU8(212);else if(Z===2)this.writeU8(213);else if(Z===4)this.writeU8(214);else if(Z===8)this.writeU8(215);else if(Z===16)this.writeU8(216);else if(Z<256)this.writeU8(199),this.writeU8(Z);else if(Z<65536)this.writeU8(200),this.writeU16(Z);else if(Z<4294967296)this.writeU8(201),this.writeU32(Z);else throw new Error("Too large extension object: ".concat(Z));this.writeI8($.type),this.writeU8a($.data)},W.prototype.writeU8=function($){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,$),this.pos++},W.prototype.writeU8a=function($){var Z=$.length;this.ensureBufferSizeToWrite(Z),this.bytes.set($,this.pos),this.pos+=Z},W.prototype.writeI8=function($){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,$),this.pos++},W.prototype.writeU16=function($){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,$),this.pos+=2},W.prototype.writeI16=function($){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,$),this.pos+=2},W.prototype.writeU32=function($){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,$),this.pos+=4},W.prototype.writeI32=function($){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,$),this.pos+=4},W.prototype.writeF32=function($){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,$),this.pos+=4},W.prototype.writeF64=function($){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,$),this.pos+=8},W.prototype.writeU64=function($){this.ensureBufferSizeToWrite(8),_0(this.view,this.pos,$),this.pos+=8},W.prototype.writeI64=function($){this.ensureBufferSizeToWrite(8),$0(this.view,this.pos,$),this.pos+=8},W.prototype.writeBigUint64=function($){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,$),this.pos+=8},W.prototype.writeBigInt64=function($){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,$),this.pos+=8},W}();function I0(W,$){var Z=new d0($);return Z.encodeSharedRef(W)}function Z0(W){return"".concat(W<0?"-":"","0x").concat(Math.abs(W).toString(16).padStart(2,"0"))}var n1=16,r1=16,c0=function(){function W($,Z){if($===void 0)$=n1;if(Z===void 0)Z=r1;this.maxKeyLength=$,this.maxLengthPerKey=Z,this.hit=0,this.miss=0,this.caches=[];for(var J=0;J<this.maxKeyLength;J++)this.caches.push([])}return W.prototype.canBeCached=function($){return $>0&&$<=this.maxKeyLength},W.prototype.find=function($,Z,J){var Q=this.caches[J-1];$:for(var U=0,V=Q;U<V.length;U++){var F=V[U],N=F.bytes;for(var X=0;X<J;X++)if(N[X]!==$[Z+X])continue $;return F.str}return null},W.prototype.store=function($,Z){var J=this.caches[$.length-1],Q={bytes:$,str:Z};if(J.length>=this.maxLengthPerKey)J[Math.random()*J.length|0]=Q;else J.push(Q)},W.prototype.decode=function($,Z,J){var Q=this.find($,Z,J);if(Q!=null)return this.hit++,Q;this.miss++;var U=M0($,Z,J),V=Uint8Array.prototype.slice.call($,Z,Z+J);return this.store(V,U),U},W}();var s1=function(W,$,Z,J){function Q(U){return U instanceof Z?U:new Z(function(V){V(U)})}return new(Z||(Z=Promise))(function(U,V){function F(G){try{X(J.next(G))}catch(H){V(H)}}function N(G){try{X(J.throw(G))}catch(H){V(H)}}function X(G){G.done?U(G.value):Q(G.value).then(F,N)}X((J=J.apply(W,$||[])).next())})},K0=function(W,$){var Z={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},J,Q,U,V;return V={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(V[Symbol.iterator]=function(){return this}),V;function F(X){return function(G){return N([X,G])}}function N(X){if(J)throw new TypeError("Generator is already executing.");while(V&&(V=0,X[0]&&(Z=0)),Z)try{if(J=1,Q&&(U=X[0]&2?Q.return:X[0]?Q.throw||((U=Q.return)&&U.call(Q),0):Q.next)&&!(U=U.call(Q,X[1])).done)return U;if(Q=0,U)X=[X[0]&2,U.value];switch(X[0]){case 0:case 1:U=X;break;case 4:return Z.label++,{value:X[1],done:!1};case 5:Z.label++,Q=X[1],X=[0];continue;case 7:X=Z.ops.pop(),Z.trys.pop();continue;default:if((U=Z.trys,!(U=U.length>0&&U[U.length-1]))&&(X[0]===6||X[0]===2)){Z=0;continue}if(X[0]===3&&(!U||X[1]>U[0]&&X[1]<U[3])){Z.label=X[1];break}if(X[0]===6&&Z.label<U[1]){Z.label=U[1],U=X;break}if(U&&Z.label<U[2]){Z.label=U[2],Z.ops.push(X);break}if(U[2])Z.ops.pop();Z.trys.pop();continue}X=$.call(W,Z)}catch(G){X=[6,G],Q=0}finally{J=U=0}if(X[0]&5)throw X[1];return{value:X[0]?X[1]:void 0,done:!0}}},p0=function(W){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=W[Symbol.asyncIterator],Z;return $?$.call(W):(W=typeof __values==="function"?__values(W):W[Symbol.iterator](),Z={},J("next"),J("throw"),J("return"),Z[Symbol.asyncIterator]=function(){return this},Z);function J(U){Z[U]=W[U]&&function(V){return new Promise(function(F,N){V=W[U](V),Q(F,N,V.done,V.value)})}}function Q(U,V,F,N){Promise.resolve(N).then(function(X){U({value:X,done:F})},V)}},l=function(W){return this instanceof l?(this.v=W,this):new l(W)},t1=function(W,$,Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J=Z.apply(W,$||[]),Q,U=[];return Q={},V("next"),V("throw"),V("return"),Q[Symbol.asyncIterator]=function(){return this},Q;function V(Y){if(J[Y])Q[Y]=function(I){return new Promise(function(T,K){U.push([Y,I,T,K])>1||F(Y,I)})}}function F(Y,I){try{N(J[Y](I))}catch(T){H(U[0][3],T)}}function N(Y){Y.value instanceof l?Promise.resolve(Y.value.v).then(X,G):H(U[0][2],Y)}function X(Y){F("next",Y)}function G(Y){F("throw",Y)}function H(Y,I){if(Y(I),U.shift(),U.length)F(U[0][0],U[0][1])}},i0="array",J0="map_key",o1="map_value",e1=function(W){return typeof W==="string"||typeof W==="number"},n=-1,P0=new DataView(new ArrayBuffer(0)),$8=new Uint8Array(P0.buffer);try{P0.getInt8(0)}catch(W){if(!(W instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var O0=RangeError,a0=new O0("Insufficient data"),W8=new c0,Q0=function(){function W($){var Z,J,Q,U,V,F,N;this.totalPos=0,this.pos=0,this.view=P0,this.bytes=$8,this.headByte=n,this.stack=[],this.extensionCodec=(Z=$===null||$===void 0?void 0:$.extensionCodec)!==null&&Z!==void 0?Z:f.defaultCodec,this.context=$===null||$===void 0?void 0:$.context,this.useBigInt64=(J=$===null||$===void 0?void 0:$.useBigInt64)!==null&&J!==void 0?J:!1,this.maxStrLength=(Q=$===null||$===void 0?void 0:$.maxStrLength)!==null&&Q!==void 0?Q:_,this.maxBinLength=(U=$===null||$===void 0?void 0:$.maxBinLength)!==null&&U!==void 0?U:_,this.maxArrayLength=(V=$===null||$===void 0?void 0:$.maxArrayLength)!==null&&V!==void 0?V:_,this.maxMapLength=(F=$===null||$===void 0?void 0:$.maxMapLength)!==null&&F!==void 0?F:_,this.maxExtLength=(N=$===null||$===void 0?void 0:$.maxExtLength)!==null&&N!==void 0?N:_,this.keyDecoder=($===null||$===void 0?void 0:$.keyDecoder)!==void 0?$.keyDecoder:W8}return W.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=n,this.stack.length=0},W.prototype.setBuffer=function($){this.bytes=b($),this.view=u0(this.bytes),this.pos=0},W.prototype.appendBuffer=function($){if(this.headByte===n&&!this.hasRemaining(1))this.setBuffer($);else{var Z=this.bytes.subarray(this.pos),J=b($),Q=new Uint8Array(Z.length+J.length);Q.set(Z),Q.set(J,Z.length),this.setBuffer(Q)}},W.prototype.hasRemaining=function($){return this.view.byteLength-this.pos>=$},W.prototype.createExtraByteError=function($){var Z=this,J=Z.view,Q=Z.pos;return new RangeError("Extra ".concat(J.byteLength-Q," of ").concat(J.byteLength," byte(s) found at buffer[").concat($,"]"))},W.prototype.decode=function($){this.reinitializeState(),this.setBuffer($);var Z=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return Z},W.prototype.decodeMulti=function($){return K0(this,function(Z){switch(Z.label){case 0:this.reinitializeState(),this.setBuffer($),Z.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return Z.sent(),[3,1];case 3:return[2]}})},W.prototype.decodeAsync=function($){var Z,J,Q,U,V,F,N;return s1(this,void 0,void 0,function(){var X,G,H,Y,I,T,K,O;return K0(this,function(A){switch(A.label){case 0:X=!1,A.label=1;case 1:A.trys.push([1,6,7,12]),Z=!0,J=p0($),A.label=2;case 2:return[4,J.next()];case 3:if(Q=A.sent(),U=Q.done,!!U)return[3,5];N=Q.value,Z=!1;try{if(H=N,X)throw this.createExtraByteError(this.totalPos);this.appendBuffer(H);try{G=this.doDecodeSync(),X=!0}catch(w){if(!(w instanceof O0))throw w}this.totalPos+=this.pos}finally{Z=!0}A.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Y=A.sent(),V={error:Y},[3,12];case 7:if(A.trys.push([7,,10,11]),!(!Z&&!U&&(F=J.return)))return[3,9];return[4,F.call(J)];case 8:A.sent(),A.label=9;case 9:return[3,11];case 10:if(V)throw V.error;return[7];case 11:return[7];case 12:if(X){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,G]}throw I=this,T=I.headByte,K=I.pos,O=I.totalPos,new RangeError("Insufficient data in parsing ".concat(Z0(T)," at ").concat(O," (").concat(K," in the current buffer)"))}})})},W.prototype.decodeArrayStream=function($){return this.decodeMultiAsync($,!0)},W.prototype.decodeStream=function($){return this.decodeMultiAsync($,!1)},W.prototype.decodeMultiAsync=function($,Z){return t1(this,arguments,function J(){var Q,U,V,F,N,X,G,H,Y,I,T,K;return K0(this,function(O){switch(O.label){case 0:Q=Z,U=-1,O.label=1;case 1:O.trys.push([1,15,16,21]),V=!0,F=p0($),O.label=2;case 2:return[4,l(F.next())];case 3:if(N=O.sent(),Y=N.done,!!Y)return[3,14];K=N.value,V=!1,O.label=4;case 4:if(O.trys.push([4,,12,13]),X=K,Z&&U===0)throw this.createExtraByteError(this.totalPos);if(this.appendBuffer(X),Q)U=this.readArraySize(),Q=!1,this.complete();O.label=5;case 5:O.trys.push([5,10,,11]),O.label=6;case 6:return[4,l(this.doDecodeSync())];case 7:return[4,O.sent()];case 8:if(O.sent(),--U===0)return[3,9];return[3,6];case 9:return[3,11];case 10:if(G=O.sent(),!(G instanceof O0))throw G;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return V=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return H=O.sent(),I={error:H},[3,21];case 16:if(O.trys.push([16,,19,20]),!(!V&&!Y&&(T=F.return)))return[3,18];return[4,l(T.call(F))];case 17:O.sent(),O.label=18;case 18:return[3,20];case 19:if(I)throw I.error;return[7];case 20:return[7];case 21:return[2]}})})},W.prototype.doDecodeSync=function(){$:while(!0){var $=this.readHeadByte(),Z=void 0;if($>=224)Z=$-256;else if($<192)if($<128)Z=$;else if($<144){var J=$-128;if(J!==0){this.pushMapState(J),this.complete();continue $}else Z={}}else if($<160){var J=$-144;if(J!==0){this.pushArrayState(J),this.complete();continue $}else Z=[]}else{var Q=$-160;Z=this.decodeUtf8String(Q,0)}else if($===192)Z=null;else if($===194)Z=!1;else if($===195)Z=!0;else if($===202)Z=this.readF32();else if($===203)Z=this.readF64();else if($===204)Z=this.readU8();else if($===205)Z=this.readU16();else if($===206)Z=this.readU32();else if($===207)if(this.useBigInt64)Z=this.readU64AsBigInt();else Z=this.readU64();else if($===208)Z=this.readI8();else if($===209)Z=this.readI16();else if($===210)Z=this.readI32();else if($===211)if(this.useBigInt64)Z=this.readI64AsBigInt();else Z=this.readI64();else if($===217){var Q=this.lookU8();Z=this.decodeUtf8String(Q,1)}else if($===218){var Q=this.lookU16();Z=this.decodeUtf8String(Q,2)}else if($===219){var Q=this.lookU32();Z=this.decodeUtf8String(Q,4)}else if($===220){var J=this.readU16();if(J!==0){this.pushArrayState(J),this.complete();continue $}else Z=[]}else if($===221){var J=this.readU32();if(J!==0){this.pushArrayState(J),this.complete();continue $}else Z=[]}else if($===222){var J=this.readU16();if(J!==0){this.pushMapState(J),this.complete();continue $}else Z={}}else if($===223){var J=this.readU32();if(J!==0){this.pushMapState(J),this.complete();continue $}else Z={}}else if($===196){var J=this.lookU8();Z=this.decodeBinary(J,1)}else if($===197){var J=this.lookU16();Z=this.decodeBinary(J,2)}else if($===198){var J=this.lookU32();Z=this.decodeBinary(J,4)}else if($===212)Z=this.decodeExtension(1,0);else if($===213)Z=this.decodeExtension(2,0);else if($===214)Z=this.decodeExtension(4,0);else if($===215)Z=this.decodeExtension(8,0);else if($===216)Z=this.decodeExtension(16,0);else if($===199){var J=this.lookU8();Z=this.decodeExtension(J,1)}else if($===200){var J=this.lookU16();Z=this.decodeExtension(J,2)}else if($===201){var J=this.lookU32();Z=this.decodeExtension(J,4)}else throw new x("Unrecognized type byte: ".concat(Z0($)));this.complete();var U=this.stack;while(U.length>0){var V=U[U.length-1];if(V.type===i0)if(V.array[V.position]=Z,V.position++,V.position===V.size)U.pop(),Z=V.array;else continue $;else if(V.type===J0){if(!e1(Z))throw new x("The type of key must be string or number but "+typeof Z);if(Z==="__proto__")throw new x("The key __proto__ is not allowed");V.key=Z,V.type=o1;continue $}else if(V.map[V.key]=Z,V.readCount++,V.readCount===V.size)U.pop(),Z=V.map;else{V.key=null,V.type=J0;continue $}}return Z}},W.prototype.readHeadByte=function(){if(this.headByte===n)this.headByte=this.readU8();return this.headByte},W.prototype.complete=function(){this.headByte=n},W.prototype.readArraySize=function(){var $=this.readHeadByte();switch($){case 220:return this.readU16();case 221:return this.readU32();default:if($<160)return $-144;else throw new x("Unrecognized array type byte: ".concat(Z0($)))}},W.prototype.pushMapState=function($){if($>this.maxMapLength)throw new x("Max length exceeded: map length (".concat($,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:J0,size:$,key:null,readCount:0,map:{}})},W.prototype.pushArrayState=function($){if($>this.maxArrayLength)throw new x("Max length exceeded: array length (".concat($,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:i0,size:$,array:new Array($),position:0})},W.prototype.decodeUtf8String=function($,Z){var J;if($>this.maxStrLength)throw new x("Max length exceeded: UTF-8 byte length (".concat($,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+Z+$)throw a0;var Q=this.pos+Z,U;if(this.stateIsMapKey()&&((J=this.keyDecoder)===null||J===void 0?void 0:J.canBeCached($)))U=this.keyDecoder.decode(this.bytes,Q,$);else U=v0(this.bytes,Q,$);return this.pos+=Z+$,U},W.prototype.stateIsMapKey=function(){if(this.stack.length>0){var $=this.stack[this.stack.length-1];return $.type===J0}return!1},W.prototype.decodeBinary=function($,Z){if($>this.maxBinLength)throw new x("Max length exceeded: bin length (".concat($,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining($+Z))throw a0;var J=this.pos+Z,Q=this.bytes.subarray(J,J+$);return this.pos+=Z+$,Q},W.prototype.decodeExtension=function($,Z){if($>this.maxExtLength)throw new x("Max length exceeded: ext length (".concat($,") > maxExtLength (").concat(this.maxExtLength,")"));var J=this.view.getInt8(this.pos+Z),Q=this.decodeBinary($,Z+1);return this.extensionCodec.decode(Q,J,this.context)},W.prototype.lookU8=function(){return this.view.getUint8(this.pos)},W.prototype.lookU16=function(){return this.view.getUint16(this.pos)},W.prototype.lookU32=function(){return this.view.getUint32(this.pos)},W.prototype.readU8=function(){var $=this.view.getUint8(this.pos);return this.pos++,$},W.prototype.readI8=function(){var $=this.view.getInt8(this.pos);return this.pos++,$},W.prototype.readU16=function(){var $=this.view.getUint16(this.pos);return this.pos+=2,$},W.prototype.readI16=function(){var $=this.view.getInt16(this.pos);return this.pos+=2,$},W.prototype.readU32=function(){var $=this.view.getUint32(this.pos);return this.pos+=4,$},W.prototype.readI32=function(){var $=this.view.getInt32(this.pos);return this.pos+=4,$},W.prototype.readU64=function(){var $=b0(this.view,this.pos);return this.pos+=8,$},W.prototype.readI64=function(){var $=W0(this.view,this.pos);return this.pos+=8,$},W.prototype.readU64AsBigInt=function(){var $=this.view.getBigUint64(this.pos);return this.pos+=8,$},W.prototype.readI64AsBigInt=function(){var $=this.view.getBigInt64(this.pos);return this.pos+=8,$},W.prototype.readF32=function(){var $=this.view.getFloat32(this.pos);return this.pos+=4,$},W.prototype.readF64=function(){var $=this.view.getFloat64(this.pos);return this.pos+=8,$},W}();function S0(W,$){var Z=new Q0($);return Z.decode(W)}function Q8(W){return W[Symbol.asyncIterator]!=null}var U8=function(W){if(W==null)throw new Error("Assertion Failure: value must not be null nor undefined")};function V8(W){return J8(this,arguments,function $(){var Z,J,Q,U;return Z8(this,function(V){switch(V.label){case 0:Z=W.getReader(),V.label=1;case 1:V.trys.push([1,,9,10]),V.label=2;case 2:return[4,u(Z.read())];case 3:if(J=V.sent(),Q=J.done,U=J.value,!Q)return[3,5];return[4,u(void 0)];case 4:return[2,V.sent()];case 5:return U8(U),[4,u(U)];case 6:return[4,V.sent()];case 7:return V.sent(),[3,2];case 8:return[3,10];case 9:return Z.releaseLock(),[7];case 10:return[2]}})})}function n0(W){if(Q8(W))return W;else return V8(W)}var Z8=function(W,$){var Z={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},J,Q,U,V;return V={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(V[Symbol.iterator]=function(){return this}),V;function F(X){return function(G){return N([X,G])}}function N(X){if(J)throw new TypeError("Generator is already executing.");while(V&&(V=0,X[0]&&(Z=0)),Z)try{if(J=1,Q&&(U=X[0]&2?Q.return:X[0]?Q.throw||((U=Q.return)&&U.call(Q),0):Q.next)&&!(U=U.call(Q,X[1])).done)return U;if(Q=0,U)X=[X[0]&2,U.value];switch(X[0]){case 0:case 1:U=X;break;case 4:return Z.label++,{value:X[1],done:!1};case 5:Z.label++,Q=X[1],X=[0];continue;case 7:X=Z.ops.pop(),Z.trys.pop();continue;default:if((U=Z.trys,!(U=U.length>0&&U[U.length-1]))&&(X[0]===6||X[0]===2)){Z=0;continue}if(X[0]===3&&(!U||X[1]>U[0]&&X[1]<U[3])){Z.label=X[1];break}if(X[0]===6&&Z.label<U[1]){Z.label=U[1],U=X;break}if(U&&Z.label<U[2]){Z.label=U[2],Z.ops.push(X);break}if(U[2])Z.ops.pop();Z.trys.pop();continue}X=$.call(W,Z)}catch(G){X=[6,G],Q=0}finally{J=U=0}if(X[0]&5)throw X[1];return{value:X[0]?X[1]:void 0,done:!0}}},u=function(W){return this instanceof u?(this.v=W,this):new u(W)},J8=function(W,$,Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J=Z.apply(W,$||[]),Q,U=[];return Q={},V("next"),V("throw"),V("return"),Q[Symbol.asyncIterator]=function(){return this},Q;function V(Y){if(J[Y])Q[Y]=function(I){return new Promise(function(T,K){U.push([Y,I,T,K])>1||F(Y,I)})}}function F(Y,I){try{N(J[Y](I))}catch(T){H(U[0][3],T)}}function N(Y){Y.value instanceof u?Promise.resolve(Y.value.v).then(X,G):H(U[0][2],Y)}function X(Y){F("next",Y)}function G(Y){F("throw",Y)}function H(Y,I){if(Y(I),U.shift(),U.length)F(U[0][0],U[0][1])}};function w0(W,$){return X8(this,void 0,void 0,function(){var Z,J;return F8(this,function(Q){return Z=n0(W),J=new Q0($),[2,J.decodeAsync(Z)]})})}var X8=function(W,$,Z,J){function Q(U){return U instanceof Z?U:new Z(function(V){V(U)})}return new(Z||(Z=Promise))(function(U,V){function F(G){try{X(J.next(G))}catch(H){V(H)}}function N(G){try{X(J.throw(G))}catch(H){V(H)}}function X(G){G.done?U(G.value):Q(G.value).then(F,N)}X((J=J.apply(W,$||[])).next())})},F8=function(W,$){var Z={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},J,Q,U,V;return V={next:F(0),throw:F(1),return:F(2)},typeof Symbol==="function"&&(V[Symbol.iterator]=function(){return this}),V;function F(X){return function(G){return N([X,G])}}function N(X){if(J)throw new TypeError("Generator is already executing.");while(V&&(V=0,X[0]&&(Z=0)),Z)try{if(J=1,Q&&(U=X[0]&2?Q.return:X[0]?Q.throw||((U=Q.return)&&U.call(Q),0):Q.next)&&!(U=U.call(Q,X[1])).done)return U;if(Q=0,U)X=[X[0]&2,U.value];switch(X[0]){case 0:case 1:U=X;break;case 4:return Z.label++,{value:X[1],done:!1};case 5:Z.label++,Q=X[1],X=[0];continue;case 7:X=Z.ops.pop(),Z.trys.pop();continue;default:if((U=Z.trys,!(U=U.length>0&&U[U.length-1]))&&(X[0]===6||X[0]===2)){Z=0;continue}if(X[0]===3&&(!U||X[1]>U[0]&&X[1]<U[3])){Z.label=X[1];break}if(X[0]===6&&Z.label<U[1]){Z.label=U[1],U=X;break}if(U&&Z.label<U[2]){Z.label=U[2],Z.ops.push(X);break}if(U[2])Z.ops.pop();Z.trys.pop();continue}X=$.call(W,Z)}catch(G){X=[6,G],Q=0}finally{J=U=0}if(X[0]&5)throw X[1];return{value:X[0]?X[1]:void 0,done:!0}}};function A0(W){const $=Object.create(null),Z=Reflect.ownKeys(W).filter((J)=>typeof J==="string");for(let J of Z){const Q=W[J];$[J]=Q&&Q instanceof Object?A0(Q):Q}return Object.freeze($)}function r0(W){return Array.from(W).reduce(($,[Z,J])=>{return $[Z]=J instanceof Map?r0(J):J,$},Object.create(null))}function N8(W,$){if(typeof W!=="string"||typeof W!=="number")return;return $ instanceof Map?Object.fromEntries($.entries()):$}var U0=import.meta.resolveSync("bun:jsc")&&await import("bun:jsc"),d6=(W)=>A0(r0(W)),c6=(W)=>JSON.stringify(W,N8),p6=(W)=>{if(!U0)throw new Error("toBunBuffer requires the bun runtime");return U0.serialize(W)},i6=(W)=>{if(!U0)throw new Error("fromBunBuffer requires the bun runtime");return U0.deserialize(W)},s0={encode:I0},h={decode:S0,decodeAsync:w0},D=new f,G8={"Content-Type":"application/x-msgpack"},Y8=0;D.register({type:Y8,encode:(W)=>{if(W instanceof Set)return s0.encode([...W],{extensionCodec:D});else return null},decode:(W)=>{const $=h.decode(W,{extensionCodec:D});return new Set($)},decodeAsync:async(W)=>{const $=await h.decodeAsync(W,{extensionCodec:D});return new Set($)}});var t0=1;D.register({type:t0,encode:(W)=>{if(W instanceof Map)return s0.encode([...W],{extensionCodec:D});else return null},decode:(W)=>{const $=h.decode(W,{extensionCodec:D});return new Map($)},decodeAsync:async(W)=>{const $=await h.decodeAsync(W,{extensionCodec:D});return new Map($)}});var o0=(W)=>{return W.reduce(($,[Z,J])=>{return $[Z]=J?.type===t0&&J?.data instanceof Uint8Array?o0(h.decode(J.data,{extensionCodec:D})):J,$},Object.create(null))},a6=async(W)=>{if(W.headers.get("Content-Type")!==G8["Content-Type"]||!W.body)return null;return A0(o0(h.decode((await h.decodeAsync(W.body,{extensionCodec:D})).data,{extensionCodec:D})))};import L from"gremlin";var z=L.process.statics,V0;(function(Z){Z["out"]="out";Z["in"]="in"})(V0||(V0={}));var H8=(W)=>{const $={both:z.both,bothE:z.bothE,bothV:z.bothV,otherV:z.otherV,inV:z.inV,outV:z.outV,inE:z.inE,in:z.in_,outE:z.outE,out:z.out};switch(W){case V0.in:return{...$,to:{e:z.inE,v:z.in_}};case V0.out:return{...$,to:{e:z.outE,v:z.out}};default:throw new Error(`invalid: ${W}\nexpected an EDir}`)}},E={...L.process,gremlin:L,p:L.process.P,traversal:L.process.AnonymousTraversalSource.traversal,DriverRemoteConnection:L.driver.DriverRemoteConnection,__:z,textp:L.process.TextP,Direction:{BOTH:L.process.direction.both,from_:L.process.direction.in,IN:L.process.direction.in,OUT:L.process.direction.out,to:L.process.direction.out},go:H8};["P","AnonymousTraversalSource","statics","driver","TextP","direction"].forEach((W)=>delete E[W]);import q0 from"gremlin";var I8=function(){return new T0(null,null,new q0.process.Bytecode)},{GraphTraversal:R8,GraphTraversalSource:M8}=q0.process;class T0 extends R8{constructor(W,$,Z){super(W,$,Z)}keys(){return this.valueMap().select(q0.process.column.keys)}next(){return super.next()}nextMap(){return this.next()}}var $$=()=>I8().keys();class X0 extends M8{constructor(W,$,Z){super(W,$,Z,X0,T0)}}import e0 from"stream";import O8 from"util";var C0=(W)=>{return{start_time:W.duration?Date.now():null,fixed_size_buffer:"",count_written:0,count_created:0}};var r=function(W={}){if(W.seed)return W.seed=W.seed*Math.PI*100%100/100;else return Math.random()};var z0={ascii:function({options:W}){const $=[],Z=Math.ceil(r(W)*W.maxWordLength);for(let J=0;J<Z;J++){const Q=Math.floor(r(W)*32);$.push(String.fromCharCode(Q+(Q<16?65:81)))}return $.join("")},int:function({options:W}){return Math.floor(r(W)*Math.pow(2,52))},bool:function({options:W}){return Math.floor(r(W)*2)}};var K8=function(W){return W.replace(/_([a-z])/gi,function($,Z){return Z.toUpperCase()})},B0=(W)=>{if(W.object_mode)W.objectMode=W.object_mode;if(W.high_water_mark)W.highWaterMark=W.high_water_mark;const $={};for(let Q in W)$[K8(Q)]=W[Q];const Z={columns:8,delimiter:",",duration:null,encoding:null,end:null,eof:!1,fixedSize:!1,length:-1,maxWordLength:16,rowDelimiter:"\n",seed:!1,sleep:0};for(let Q in Z)if($[Q]===void 0)$[Q]=Z[Q];if($.eof===!0)$.eof=$.rowDelimiter;if(typeof $.columns==="number")$.columns=new Array($.columns);const J=Object.keys(z0).filter((Q)=>!["super_","camelize"].includes(Q));for(let Q=0;Q<$.columns.length;Q++){const U=$.columns[Q]||"ascii";if(typeof U==="string"){if(!J.includes(U))throw Error(`Invalid column type: got "${U}", default values are ${JSON.stringify(J)}`);$.columns[Q]=z0[U]}}return $};var x0=(W,$,Z,J,Q)=>{const U=[];let V=0;if(W.fixedSize){if(V=$.fixed_size_buffer.length,V!==0)U.push($.fixed_size_buffer)}while(!0){if($.count_created===W.length||W.end&&Date.now()>W.end||W.duration&&Date.now()>$.start_time+W.duration){if(U.length){if(W.objectMode)for(let X of U)J(X);else J(U.join("")+(W.eof?W.eof:""));$.end=!0}else Q();return}let F=[],N;for(let X of W.columns){const G=X({options:W,state:$}),H=typeof G;if(G!==null&&H!=="string"&&H!=="number"){Q(Error(["INVALID_VALUE:","values returned by column function must be","a string, a number or null,",`got ${JSON.stringify(G)}`].join(" ")));return}F.push(G)}if(W.objectMode){N=0;for(let X of F)N+=X.length}else F=($.count_created===0?"":W.rowDelimiter)+F.join(W.delimiter),N=F.length;if($.count_created++,V+N>Z){if(W.objectMode){U.push(F);for(let X of U)J(X)}else{if(W.fixedSize)$.fixed_size_buffer=F.substr(Z-V),U.push(F.substr(0,Z-V));else U.push(F);J(U.join(""))}return}V+=N,U.push(F)}};var d=function(W={}){return this.options=B0(W),e0.Readable.call(this,this.options),this.state=C0(this.options),this};O8.inherits(d,e0.Readable);d.prototype.end=function(){this.push(null)};d.prototype._read=function(W){setImmediate(()=>{this.__read(W)})};d.prototype.__read=function(W){x0(this.options,this.state,W,($)=>{this.__push($)},($)=>{if($)this.destroy($);else this.push(null)})};d.prototype.__push=function(W){const $=()=>{if(this.state.count_written++,this.push(W),this.state.end===!0)return this.push(null)};this.options.sleep>0?setTimeout($,this.options.sleep):$()};class M extends Error{constructor(W,$,Z,...J){if(Array.isArray($))$=$.join(" ").trim();super($);if(Error.captureStackTrace!==void 0)Error.captureStackTrace(this,M);this.code=W;for(let Q of J)for(let U in Q){const V=Q[U];this[U]=Buffer.isBuffer(V)?V.toString(Z.encoding):V==null?V:JSON.parse(JSON.stringify(V))}}}var $1=function(W){return typeof W==="object"&&W!==null&&!Array.isArray(W)};var F0=function(W){const $=[];for(let Z=0,J=W.length;Z<J;Z++){const Q=W[Z];if(Q===void 0||Q===null||Q===!1)$[Z]={disabled:!0};else if(typeof Q==="string")$[Z]={name:Q};else if($1(Q)){if(typeof Q.name!=="string")throw new M("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${Z}`,"when column is an object literal"]);$[Z]=Q}else throw new M("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(Q)} at position ${Z}`])}return $};class W1{constructor(W=100){this.size=W,this.length=0,this.buf=Buffer.allocUnsafe(W)}prepend(W){if(Buffer.isBuffer(W)){const $=this.length+W.length;if($>=this.size){if(this.resize(),$>=this.size)throw Error("INVALID_BUFFER_STATE")}const Z=this.buf;this.buf=Buffer.allocUnsafe(this.size),W.copy(this.buf,0),Z.copy(this.buf,W.length),this.length+=W.length}else{const $=this.length++;if($===this.size)this.resize();const Z=this.clone();this.buf[0]=W,Z.copy(this.buf,1,0,$)}}append(W){const $=this.length++;if($===this.size)this.resize();this.buf[$]=W}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const W=this.length;this.size=this.size*2;const $=Buffer.allocUnsafe(this.size);this.buf.copy($,0,0,W),this.buf=$}toString(W){if(W)return this.buf.slice(0,this.length).toString(W);else return Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}var L0=W1;var P8=12,S8=13,w8=10,A8=32,q8=9,Z1=function(W){return{bomSkipped:!1,bufBytesStart:0,castField:W.cast_function,commenting:!1,error:void 0,enabled:W.from_line===1,escaping:!1,escapeIsQuote:Buffer.isBuffer(W.escape)&&Buffer.isBuffer(W.quote)&&Buffer.compare(W.escape,W.quote)===0,expectedRecordLength:Array.isArray(W.columns)?W.columns.length:void 0,field:new L0(20),firstLineToHeaders:W.cast_first_line_to_header,needMoreDataSize:Math.max(W.comment!==null?W.comment.length:0,...W.delimiter.map(($)=>$.length),W.quote!==null?W.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new L0(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:W.record_delimiter.length===0?0:Math.max(...W.record_delimiter.map(($)=>$.length)),trimChars:[Buffer.from(" ",W.encoding)[0],Buffer.from("\t",W.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([S8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([w8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([P8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([A8],"utf8").toString(),W.encoding),Buffer.from(Buffer.from([q8],"utf8").toString(),W.encoding)]}};var J1=function(W){return W.replace(/([A-Z])/g,function($,Z){return"_"+Z.toLowerCase()})};var k0=function(W){const $={};for(let J in W)$[J1(J)]=W[J];if($.encoding===void 0||$.encoding===!0)$.encoding="utf8";else if($.encoding===null||$.encoding===!1)$.encoding=null;else if(typeof $.encoding!=="string"&&$.encoding!==null)throw new M("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify($.encoding)}`],$);if($.bom===void 0||$.bom===null||$.bom===!1)$.bom=!1;else if($.bom!==!0)throw new M("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify($.bom)}`],$);if($.cast_function=null,$.cast===void 0||$.cast===null||$.cast===!1||$.cast==="")$.cast=void 0;else if(typeof $.cast==="function")$.cast_function=$.cast,$.cast=!0;else if($.cast!==!0)throw new M("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify($.cast)}`],$);if($.cast_date===void 0||$.cast_date===null||$.cast_date===!1||$.cast_date==="")$.cast_date=!1;else if($.cast_date===!0)$.cast_date=function(J){const Q=Date.parse(J);return!isNaN(Q)?new Date(Q):J};else if(typeof $.cast_date!=="function")throw new M("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify($.cast_date)}`],$);if($.cast_first_line_to_header=null,$.columns===!0)$.cast_first_line_to_header=void 0;else if(typeof $.columns==="function")$.cast_first_line_to_header=$.columns,$.columns=!0;else if(Array.isArray($.columns))$.columns=F0($.columns);else if($.columns===void 0||$.columns===null||$.columns===!1)$.columns=!1;else throw new M("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify($.columns)}`],$);if($.group_columns_by_name===void 0||$.group_columns_by_name===null||$.group_columns_by_name===!1)$.group_columns_by_name=!1;else if($.group_columns_by_name!==!0)throw new M("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify($.group_columns_by_name)}`],$);else if($.columns===!1)throw new M("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],$);if($.comment===void 0||$.comment===null||$.comment===!1||$.comment==="")$.comment=null;else{if(typeof $.comment==="string")$.comment=Buffer.from($.comment,$.encoding);if(!Buffer.isBuffer($.comment))throw new M("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify($.comment)}`],$)}if($.comment_no_infix===void 0||$.comment_no_infix===null||$.comment_no_infix===!1)$.comment_no_infix=!1;else if($.comment_no_infix!==!0)throw new M("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify($.comment_no_infix)}`],$);const Z=JSON.stringify($.delimiter);if(!Array.isArray($.delimiter))$.delimiter=[$.delimiter];if($.delimiter.length===0)throw new M("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${Z}`],$);if($.delimiter=$.delimiter.map(function(J){if(J===void 0||J===null||J===!1)return Buffer.from(",",$.encoding);if(typeof J==="string")J=Buffer.from(J,$.encoding);if(!Buffer.isBuffer(J)||J.length===0)throw new M("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${Z}`],$);return J}),$.escape===void 0||$.escape===!0)$.escape=Buffer.from('"',$.encoding);else if(typeof $.escape==="string")$.escape=Buffer.from($.escape,$.encoding);else if($.escape===null||$.escape===!1)$.escape=null;if($.escape!==null){if(!Buffer.isBuffer($.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify($.escape)}`)}if($.from===void 0||$.from===null)$.from=1;else{if(typeof $.from==="string"&&/\d+/.test($.from))$.from=parseInt($.from);if(Number.isInteger($.from)){if($.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(W.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify($.from)}`)}if($.from_line===void 0||$.from_line===null)$.from_line=1;else{if(typeof $.from_line==="string"&&/\d+/.test($.from_line))$.from_line=parseInt($.from_line);if(Number.isInteger($.from_line)){if($.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(W.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(W.from_line)}`)}if($.ignore_last_delimiters===void 0||$.ignore_last_delimiters===null)$.ignore_last_delimiters=!1;else if(typeof $.ignore_last_delimiters==="number"){if($.ignore_last_delimiters=Math.floor($.ignore_last_delimiters),$.ignore_last_delimiters===0)$.ignore_last_delimiters=!1}else if(typeof $.ignore_last_delimiters!=="boolean")throw new M("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify($.ignore_last_delimiters)}`],$);if($.ignore_last_delimiters===!0&&$.columns===!1)throw new M("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],$);if($.info===void 0||$.info===null||$.info===!1)$.info=!1;else if($.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify($.info)}`);if($.max_record_size===void 0||$.max_record_size===null||$.max_record_size===!1)$.max_record_size=0;else if(Number.isInteger($.max_record_size)&&$.max_record_size>=0);else if(typeof $.max_record_size==="string"&&/\d+/.test($.max_record_size))$.max_record_size=parseInt($.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify($.max_record_size)}`);if($.objname===void 0||$.objname===null||$.objname===!1)$.objname=void 0;else if(Buffer.isBuffer($.objname)){if($.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");if($.encoding===null);else $.objname=$.objname.toString($.encoding)}else if(typeof $.objname==="string"){if($.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof $.objname==="number");else throw new Error(`Invalid Option: objname must be a string or a buffer, got ${$.objname}`);if($.objname!==void 0){if(typeof $.objname==="number"){if($.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if($.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if($.on_record===void 0||$.on_record===null)$.on_record=void 0;else if(typeof $.on_record!=="function")throw new M("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify($.on_record)}`],$);if($.quote===null||$.quote===!1||$.quote==="")$.quote=null;else{if($.quote===void 0||$.quote===!0)$.quote=Buffer.from('"',$.encoding);else if(typeof $.quote==="string")$.quote=Buffer.from($.quote,$.encoding);if(!Buffer.isBuffer($.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify($.quote)}`)}if($.raw===void 0||$.raw===null||$.raw===!1)$.raw=!1;else if($.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify($.raw)}`);if($.record_delimiter===void 0)$.record_delimiter=[];else if(typeof $.record_delimiter==="string"||Buffer.isBuffer($.record_delimiter)){if($.record_delimiter.length===0)throw new M("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify($.record_delimiter)}`],$);$.record_delimiter=[$.record_delimiter]}else if(!Array.isArray($.record_delimiter))throw new M("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify($.record_delimiter)}`],$);if($.record_delimiter=$.record_delimiter.map(function(J,Q){if(typeof J!=="string"&&!Buffer.isBuffer(J))throw new M("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${Q},`,`got ${JSON.stringify(J)}`],$);else if(J.length===0)throw new M("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${Q},`,`got ${JSON.stringify(J)}`],$);if(typeof J==="string")J=Buffer.from(J,$.encoding);return J}),typeof $.relax_column_count==="boolean");else if($.relax_column_count===void 0||$.relax_column_count===null)$.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify($.relax_column_count)}`);if(typeof $.relax_column_count_less==="boolean");else if($.relax_column_count_less===void 0||$.relax_column_count_less===null)$.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify($.relax_column_count_less)}`);if(typeof $.relax_column_count_more==="boolean");else if($.relax_column_count_more===void 0||$.relax_column_count_more===null)$.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify($.relax_column_count_more)}`);if(typeof $.relax_quotes==="boolean");else if($.relax_quotes===void 0||$.relax_quotes===null)$.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify($.relax_quotes)}`);if(typeof $.skip_empty_lines==="boolean");else if($.skip_empty_lines===void 0||$.skip_empty_lines===null)$.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify($.skip_empty_lines)}`);if(typeof $.skip_records_with_empty_values==="boolean");else if($.skip_records_with_empty_values===void 0||$.skip_records_with_empty_values===null)$.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify($.skip_records_with_empty_values)}`);if(typeof $.skip_records_with_error==="boolean");else if($.skip_records_with_error===void 0||$.skip_records_with_error===null)$.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify($.skip_records_with_error)}`);if($.rtrim===void 0||$.rtrim===null||$.rtrim===!1)$.rtrim=!1;else if($.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify($.rtrim)}`);if($.ltrim===void 0||$.ltrim===null||$.ltrim===!1)$.ltrim=!1;else if($.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify($.ltrim)}`);if($.trim===void 0||$.trim===null||$.trim===!1)$.trim=!1;else if($.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify($.trim)}`);if($.trim===!0&&W.ltrim!==!1)$.ltrim=!0;else if($.ltrim!==!0)$.ltrim=!1;if($.trim===!0&&W.rtrim!==!1)$.rtrim=!0;else if($.rtrim!==!0)$.rtrim=!1;if($.to===void 0||$.to===null)$.to=-1;else{if(typeof $.to==="string"&&/\d+/.test($.to))$.to=parseInt($.to);if(Number.isInteger($.to)){if($.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(W.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(W.to)}`)}if($.to_line===void 0||$.to_line===null)$.to_line=-1;else{if(typeof $.to_line==="string"&&/\d+/.test($.to_line))$.to_line=parseInt($.to_line);if(Number.isInteger($.to_line)){if($.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(W.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(W.to_line)}`)}return $};var Q1=function(W){return W.every(($)=>$==null||$.toString&&$.toString().trim()==="")},T8=13,C8=10,c={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},U1=function(W={}){const $={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},Z=k0(W);return{info:$,original_options:W,options:Z,state:Z1(Z),__needMoreData:function(J,Q,U){if(U)return!1;const{encoding:V,escape:F,quote:N}=this.options,{quoting:X,needMoreDataSize:G,recordDelimiterMaxLength:H}=this.state,Y=Q-J-1,I=Math.max(G,H===0?Buffer.from("\r\n",V).length:H,X?(F===null?0:F.length)+N.length:0,X?N.length+H:0);return Y<I},parse:function(J,Q,U,V){const{bom:F,comment_no_infix:N,encoding:X,from_line:G,ltrim:H,max_record_size:Y,raw:I,relax_quotes:T,rtrim:K,skip_empty_lines:O,to:A,to_line:w}=this.options;let{comment:P,escape:B,quote:k,record_delimiter:H0}=this.options;const{bomSkipped:S1,previousBuf:o,rawBuffer:w1,escapeIsQuote:A1}=this.state;let S;if(o===void 0)if(J===void 0){V();return}else S=J;else if(o!==void 0&&J===void 0)S=o;else S=Buffer.concat([o,J]);if(S1===!1)if(F===!1)this.state.bomSkipped=!0;else if(S.length<3){if(Q===!1){this.state.previousBuf=S;return}}else{for(let q in c)if(c[q].compare(S,0,c[q].length)===0){const j=c[q].length;this.state.bufBytesStart+=j,S=S.slice(j),this.options=k0({...this.original_options,encoding:q}),{comment:P,escape:B,quote:k}=this.options;break}this.state.bomSkipped=!0}const R0=S.length;let R;for(R=0;R<R0;R++){if(this.__needMoreData(R,R0,Q))break;if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1;if(w!==-1&&this.info.lines>w){this.state.stop=!0,V();return}if(this.state.quoting===!1&&H0.length===0){if(this.__autoDiscoverRecordDelimiter(S,R))H0=this.options.record_delimiter}const q=S[R];if(I===!0)w1.append(q);if((q===T8||q===C8)&&this.state.wasRowDelimiter===!1)this.state.wasRowDelimiter=!0;if(this.state.escaping===!0)this.state.escaping=!1;else{if(B!==null&&this.state.quoting===!0&&this.__isEscape(S,R,q)&&R+B.length<R0)if(A1){if(this.__isQuote(S,R+B.length)){this.state.escaping=!0,R+=B.length-1;continue}}else{this.state.escaping=!0,R+=B.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(S,R))if(this.state.quoting===!0){const C=S[R+k.length],p=K&&this.__isCharTrimable(S,R+k.length),y=P!==null&&this.__compareBytes(P,S,R+k.length,C),g=this.__isDelimiter(S,R+k.length,C),e=H0.length===0?this.__autoDiscoverRecordDelimiter(S,R+k.length):this.__isRecordDelimiter(C,S,R+k.length);if(B!==null&&this.__isEscape(S,R,q)&&this.__isQuote(S,R+B.length))R+=B.length-1;else if(!C||g||e||y||p){this.state.quoting=!1,this.state.wasQuoting=!0,R+=k.length-1;continue}else if(T===!1){const i=this.__error(new M("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(C)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(i!==void 0)return i}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(k),R+=k.length-1}else if(this.state.field.length!==0){if(T===!1){const C=this.__infoField(),p=Object.keys(c).map((g)=>c[g].equals(this.state.field.toString())?g:!1).filter(Boolean)[0],y=this.__error(new M("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(C.column)} at line ${C.lines}, value is ${JSON.stringify(this.state.field.toString(X))}`,p?`(${p} bom)`:void 0],this.options,C,{field:this.state.field}));if(y!==void 0)return y}}else{this.state.quoting=!0,R+=k.length-1;continue}if(this.state.quoting===!1){const C=this.__isRecordDelimiter(q,S,R);if(C!==0){if(this.state.commenting&&(this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0))this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=G){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),R+=C-1;continue}if(O===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,R+=C-1;continue}this.info.bytes=this.state.bufBytesStart+R;const e=this.__onField();if(e!==void 0)return e;this.info.bytes=this.state.bufBytesStart+R+C;const i=this.__onRecord(U);if(i!==void 0)return i;if(A!==-1&&this.info.records>=A){this.state.stop=!0,V();return}}this.state.commenting=!1,R+=C-1;continue}if(this.state.commenting)continue;if((P===null?0:this.__compareBytes(P,S,R,q))!==0&&(N===!1||this.state.field.length===0)){this.state.commenting=!0;continue}const y=this.__isDelimiter(S,R,q);if(y!==0){this.info.bytes=this.state.bufBytesStart+R;const g=this.__onField();if(g!==void 0)return g;R+=y-1;continue}}}if(this.state.commenting===!1){if(Y!==0&&this.state.record_length+this.state.field.length>Y)return this.__error(new M("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${Y}`,`at line ${this.info.lines}`],this.options,this.__infoField()))}const j=H===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(S,R),q1=K===!1||this.state.wasQuoting===!1;if(j===!0&&q1===!0)this.state.field.append(q);else if(K===!0&&!this.__isCharTrimable(S,R))return this.__error(new M("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));else{if(j===!1)R+=this.__isCharTrimable(S,R)-1;continue}}if(Q===!0){if(this.state.quoting===!0){const q=this.__error(new M("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(q!==void 0)return q}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+R;const q=this.__onField();if(q!==void 0)return q;const j=this.__onRecord(U);if(j!==void 0)return j}else if(this.state.wasRowDelimiter===!0)this.info.empty_lines++;else if(this.state.commenting===!0)this.info.comment_lines++}else this.state.bufBytesStart+=R,this.state.previousBuf=S.slice(R);if(this.state.wasRowDelimiter===!0)this.info.lines++,this.state.wasRowDelimiter=!1},__onRecord:function(J){const{columns:Q,group_columns_by_name:U,encoding:V,info:F,from:N,relax_column_count:X,relax_column_count_less:G,relax_column_count_more:H,raw:Y,skip_records_with_empty_values:I}=this.options,{enabled:T,record:K}=this.state;if(T===!1)return this.__resetRecord();const O=K.length;if(Q===!0){if(I===!0&&Q1(K)){this.__resetRecord();return}return this.__firstLineToColumns(K)}if(Q===!1&&this.info.records===0)this.state.expectedRecordLength=O;if(O!==this.state.expectedRecordLength){const A=Q===!1?new M("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${O} on line ${this.info.lines}`],this.options,this.__infoField(),{record:K}):new M("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${Q.length},`,`got ${O} on line ${this.info.lines}`],this.options,this.__infoField(),{record:K});if(X===!0||G===!0&&O<this.state.expectedRecordLength||H===!0&&O>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=A;else{const w=this.__error(A);if(w)return w}}if(I===!0&&Q1(K)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,N===1||this.info.records>=N){const{objname:A}=this.options;if(Q!==!1){const w={};for(let P=0,B=K.length;P<B;P++){if(Q[P]===void 0||Q[P].disabled)continue;if(U===!0&&w[Q[P].name]!==void 0)if(Array.isArray(w[Q[P].name]))w[Q[P].name]=w[Q[P].name].concat(K[P]);else w[Q[P].name]=[w[Q[P].name],K[P]];else w[Q[P].name]=K[P]}if(Y===!0||F===!0){const P=Object.assign({record:w},Y===!0?{raw:this.state.rawBuffer.toString(V)}:{},F===!0?{info:this.__infoRecord()}:{}),B=this.__push(A===void 0?P:[w[A],P],J);if(B)return B}else{const P=this.__push(A===void 0?w:[w[A],w],J);if(P)return P}}else if(Y===!0||F===!0){const w=Object.assign({record:K},Y===!0?{raw:this.state.rawBuffer.toString(V)}:{},F===!0?{info:this.__infoRecord()}:{}),P=this.__push(A===void 0?w:[K[A],w],J);if(P)return P}else{const w=this.__push(A===void 0?K:[K[A],K],J);if(w)return w}}this.__resetRecord()},__firstLineToColumns:function(J){const{firstLineToHeaders:Q}=this.state;try{const U=Q===void 0?J:Q.call(null,J);if(!Array.isArray(U))return this.__error(new M("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(U)}`],this.options,this.__infoField(),{headers:U}));const V=F0(U);this.state.expectedRecordLength=V.length,this.options.columns=V,this.__resetRecord();return}catch(U){return U}},__resetRecord:function(){if(this.options.raw===!0)this.state.rawBuffer.reset();this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:J,encoding:Q,rtrim:U,max_record_size:V}=this.options,{enabled:F,wasQuoting:N}=this.state;if(F===!1)return this.__resetField();let X=this.state.field.toString(Q);if(U===!0&&N===!1)X=X.trimRight();if(J===!0){const[G,H]=this.__cast(X);if(G!==void 0)return G;X=H}if(this.state.record.push(X),V!==0&&typeof X==="string")this.state.record_length+=X.length;this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(J,Q){const{on_record:U}=this.options;if(U!==void 0){const V=this.__infoRecord();try{J=U.call(null,J,V)}catch(F){return F}if(J===void 0||J===null)return}Q(J)},__cast:function(J){const{columns:Q,relax_column_count:U}=this.options;if(Array.isArray(Q)===!0&&U&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const F=this.__infoField();return[void 0,this.state.castField.call(null,J,F)]}catch(F){return[F]}if(this.__isFloat(J))return[void 0,parseFloat(J)];else if(this.options.cast_date!==!1){const F=this.__infoField();return[void 0,this.options.cast_date.call(null,J,F)]}return[void 0,J]},__isCharTrimable:function(J,Q){return((V,F)=>{const{timchars:N}=this.state;$:for(let X=0;X<N.length;X++){const G=N[X];for(let H=0;H<G.length;H++)if(G[H]!==V[F+H])continue $;return G.length}return 0})(J,Q)},__isFloat:function(J){return J-parseFloat(J)+1>=0},__compareBytes:function(J,Q,U,V){if(J[0]!==V)return 0;const F=J.length;for(let N=1;N<F;N++)if(J[N]!==Q[U+N])return 0;return F},__isDelimiter:function(J,Q,U){const{delimiter:V,ignore_last_delimiters:F}=this.options;if(F===!0&&this.state.record.length===this.options.columns.length-1)return 0;else if(F!==!1&&typeof F==="number"&&this.state.record.length===F-1)return 0;$:for(let N=0;N<V.length;N++){const X=V[N];if(X[0]===U){for(let G=1;G<X.length;G++)if(X[G]!==J[Q+G])continue $;return X.length}}return 0},__isRecordDelimiter:function(J,Q,U){const{record_delimiter:V}=this.options,F=V.length;$:for(let N=0;N<F;N++){const X=V[N],G=X.length;if(X[0]!==J)continue;for(let H=1;H<G;H++)if(X[H]!==Q[U+H])continue $;return X.length}return 0},__isEscape:function(J,Q,U){const{escape:V}=this.options;if(V===null)return!1;const F=V.length;if(V[0]===U){for(let N=0;N<F;N++)if(V[N]!==J[Q+N])return!1;return!0}return!1},__isQuote:function(J,Q){const{quote:U}=this.options;if(U===null)return!1;const V=U.length;for(let F=0;F<V;F++)if(U[F]!==J[Q+F])return!1;return!0},__autoDiscoverRecordDelimiter:function(J,Q){const{encoding:U}=this.options,V=[Buffer.from("\r\n",U),Buffer.from("\n",U),Buffer.from("\r",U)];$:for(let F=0;F<V.length;F++){const N=V[F].length;for(let X=0;X<N;X++)if(V[F][X]!==J[Q+X])continue $;return this.options.record_delimiter.push(V[F]),this.state.recordDelimiterMaxLength=V[F].length,V[F].length}return 0},__error:function(J){const{encoding:Q,raw:U,skip_records_with_error:V}=this.options,F=typeof J==="string"?new Error(J):J;if(V){if(this.state.recordHasError=!0,this.options.on_skip!==void 0)this.options.on_skip(F,U?this.state.rawBuffer.toString(Q):void 0);return}else return F},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:J,raw:Q,encoding:U}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:J===!0,index:this.state.record.length,raw:Q?this.state.rawBuffer.toString(U):void 0}},__infoField:function(){const{columns:J}=this.options,Q=Array.isArray(J);return{...this.__infoRecord(),column:Q===!0?J.length>this.state.record.length?J[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}};var D0=function(W,$={}){if(typeof W==="string")W=Buffer.from(W);const Z=$&&$.objname?{}:[],J=U1($),Q=(N)=>{if(J.options.objname===void 0)Z.push(N);else Z[N[0]]=N[1]},U=()=>{},V=J.parse(W,!1,Q,U);if(V!==void 0)throw V;const F=J.parse(void 0,!0,Q,U);if(F!==void 0)throw F;return Z};var u$=".".charCodeAt(0);var d$=RegExp('[^.[\\]]+|\\[(?:([^"\'][^[]*)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))',"g");var XW=Buffer.from([239,187,191]);import V1 from"stream";import x8 from"util";var s=function(W={},$){if(this.options=W,W.consume===void 0||W.consume===null)this.options.consume=!1;if(this.options.objectMode=!0,W.parallel===void 0||W.parallel===null)this.options.parallel=100;if(W.params===void 0||W.params===null)W.params=null;return this.handler=$,V1.Transform.call(this,this.options),this.state={running:0,started:0,finished:0,paused:!1},this};x8.inherits(s,V1.Transform);s.prototype._transform=function(W,$,Z){if(this.state.started++,this.state.running++,!this.state.paused&&this.state.running<this.options.parallel)Z(),Z=null;try{let J=this.handler.length;if(this.options.params!==null)J--;if(J===1){const Q=this.handler.call(this,W,this.options.params);this.__done(null,[Q],Z)}else if(J===2){const Q=(U,...V)=>this.__done(U,V,Z);this.handler.call(this,W,Q,this.options.params)}else throw Error("Invalid handler arguments");return!1}catch(J){this.__done(J)}};s.prototype._flush=function(W){if(this.state.running===0)W();else this._ending=function(){W()}};s.prototype.__done=function(W,$,Z){if(this.state.running--,W)return this.emit("error",W);this.state.finished++;for(let J of $){if(typeof J==="number")J=`${J}`;if(J!==void 0&&J!==null&&J!=="")this.state.paused=!this.push(J)}if(Z)Z();if(this._ending&&this.state.running===0)this._ending()};import h8 from"fs/promises";var m=(W,...$)=>console.info(`${Date()}\n`,`${W}\n`,...$,"\n\n");import L8 from"path";var X1=(W)=>L8.parse(W).name,F1=(W,$="csv")=>`${W}.${$}`,LW=(W)=>new Date(W.replace(/['"]+/g,"")),E0=Object.create(null),kW=(W)=>{if(!E0[W])E0[W]=Bun.hash(W).toString();return E0[W]},k8=(W)=>{if(!String(W).length)throw new Error(`neptune requires edges to have exactly 1 label: ${W} received`);return W},j0=(W)=>{if(!W.length)throw new Error("neptune requires at least 1 label for vertices");return W[0]},DW=(W)=>W==="v"?j0:k8,N1=(W)=>W.reduce(($,Z)=>{if(Z.status==="rejected")$.failure.push(Z.reason);else $.success.push(Z.value);return $},{success:[],failure:[]});var{t:G0,Direction:Y1,merge:N0}=E,D8=(W)=>{return W.edges.map(($)=>{if(!$.recordId)throw new Error(`all edges require a user supplied recordId\n${JSON.stringify($)}`);const Z=new Map(Object.entries($.p||{}));return Z.set(G0.label,$.l),Z.set(Y1.OUT,$.f),Z.set(Y1.IN,$.t),[new Map([[G0.id,$.recordId]]),Z]})},E8=(W)=>{if(!W.recordId)throw new Error("all vertices require a user supplied recordId");const $=new Map(Object.entries(W.p));return $.set(G0.label,j0(W.l)),[new Map([[G0.id,W.recordId]]),$]},H1=async(W,$)=>{return Promise.allSettled(W.flatMap((Z)=>{if($.type==="v"){const[J,Q]=E8(Z);return g0.mergeV(J).option(N0.onCreate,Q).option(N0.onMatch,Q).toList()}return D8(Z).map(([J,Q])=>g0.mergeE(J).option(N0.onCreate,Q).option(N0.onMatch,Q).toList())}).filter(Boolean)).then(N1)};var R1=(W)=>{if(typeof W!=="string"||typeof W!=="number")throw new Error(`invalid type, expected number|string, received: ${typeof W}`);return W},M1=(W,$,Z)=>{const J={...W.inject?.p||{}},Q=W.inject?.l?.slice()??[];return Z.forEach((U,V)=>{if(W.colMap?.ignoreCols?.includes(V))return;if(W.colMap?.ignoreEmptyCol&&String(U).length===0)return;const F=$[V],N=W.colMap?.transform?.(V,U)??U;if(W.colMap?.p?.includes(V))J[F]=N;else if(W.colMap?.l?.includes(V))if(Q.length)J[F]=N;else Q.push(R1(N));else if(W.colMap?.default)switch(W.colMap.default){case"p":J[F]=N;break;default:if(Q.length)J[F]=N;else Q.push(R1(N))}}),{p:J,l:Q}},g8=(W,$,Z)=>{return $.map((J)=>{const Q=W.transformRecord?.(J)??J,U=M1(W,Z,Q);return{edges:W.edges.map((V)=>{return{f:V.f(U,Q),t:V.t(U,Q),l:V.l(U,Q),p:V.p?.(U)??{},recordId:V.recordId(U,Q)}})}})},y8=(W,$,Z)=>{return $.map((J)=>{const Q=W.transformRecord?.(J)??J,U=M1(W,Z,Q);return{recordId:W.recordId(U,Q),...U}})},I1=async(W,$)=>{const Z=W.transformHeaders?.($[0])??$[0];switch(W.type){case"v":return y8(W,$.slice(1),Z);case"e":return g8(W,$.slice(1),Z)}};var v=(W={})=>({files:new Set,parsed:new Map,transformed:new Map,...W}),y0=async(W,$,Z,J=v())=>{if(!J.parsed.has(W))throw new Error(`csv not parsed: ${W}`);J.transformed.set(Z||W,{spec:$,data:await I1($,J.parsed.get(W))})},K1=async(W,$,Z=v())=>{try{Z.parsed.set(W,D0(await Bun.file($).text()))}catch(J){throw new Error(`invalid csv ${W}: ${$}\n${J}`)}},m8=async(W,$=v())=>{(await h8.readdir(W)).forEach((Z)=>Z.endsWith(".csv")&&$.files.add(Z)),m("total csv files found",$.files.size)},v8=async(W,$=v())=>{if(!W.files)return;for(let[Z,J]of W.files){const Q=typeof J==="function"?J(Z):J;if(Q.recursive)await y0(Q.recursive,Q,Z,$);else{const U=F1(Z);if(!$.files.has(U))throw new Error(`could not find file: ${U}`);$.files.delete(U),await K1(Z,`${W.csvDir}/${U}`,$),await y0(Z,Q,void 0,$)}}m("transformed config.files",$.transformed.size)},_8=async(W,$=v())=>{if(!W.includeUnmappedFiles)return;if(!W.getSpec)throw new Error("Including unmapped files requires config.getSpec to be defined");let Z=0;for(let J of $.files){const Q=X1(J),U=W.getSpec(Q);if(!U)continue;Z++,$.files.delete(J),await K1(Q,`${W.csvDir}/${J}`,$),await y0(Q,U,void 0,$)}m(`
    unmapped csvs processed ${Z}
    unmapped csvs ignored: ${$.files.size}
    `)},b8=async(W,$=v())=>{if(!$.transformed.size)throw new Error(`
      no CSV files transformed. Did you correctly map CSV filenames to config specs?
      CSVs pared: ${$.parsed.size}
      CSVs ignored: ${$.files.size}
      CSVs transformed: ${$.transformed.size}
      `);for(let[Z,J]of $.transformed.entries()){const Q=await H1(J.data,J.spec);if(W.persistResultLog){const U=`${W.csvDir}/${Z}.csv.json`;Bun.write(U,JSON.stringify(Q||"result is empty")),m(`result log saved to ${U}`)}m(`loaded ${Z} into tinkergraph`,{success:Q?.success.length??0,failure:Q?.failure.length??0})}m("total csvs loaded in tinkergraph",$.transformed.size)},fW=async(W,$=v())=>{await m8(W.csvDir,$),await v8(W,$),await _8(W,$),await b8(W,$)},hW=()=>null;var{t}=E,{keys:l8,values:u8}=E.column,{addAll:O1}=E.operator,{flatMap:d8,identity:Y0,project:c8,select:p8,unfold:P1,union:i8,valueMap:a8}=E.__,pW=(W)=>({...W,limitX:W.limitX??0,limitY:W.limitY??(W.limitX??0)+10}),iW=(W,$)=>{if(!Array.isArray($)||!$.length)throw new Error(`${W} must be a non empty array\nreceived: ${$}`);return!1},aW=(W,...$)=>{throw new Error(`Invalid Query\n${W}\n${JSON.stringify($)}`)},nW=({as:W=[],elements:$=Y0(),elKeys:Z=[]})=>{return $.as(...W.concat("base")).valueMap(...Z).by(P1()).sack(O1).select("base").project("id","label").by(t.id).by(t.label).sack(O1)},rW=({elements:W=Y0(),elKeys:$=[],traversals:Z=[]})=>{return W.local(i8(c8("id","label").by(t.id).by(t.label),a8(...$).by(P1()),...Z).unfold().group().by(l8).by(p8(u8)))},sW=({elements:W=Y0(),elKeys:$=[]})=>W.group().by($[0]??t.id).by(d8(Y0()));var{traversal:n8,DriverRemoteConnection:r8,gremlin:s8}=E,g0=n8(X0).withRemote(new r8("ws://0.0.0.0:8182/gremlin")),WZ=new s8.driver.Client("ws://0.0.0.0:8182/gremlin",{traversalSource:"g",session:`${Date.now()}`});export{R1 as validateNumStr,_8 as transformUnmappedFiles,M1 as transformPropsAndLabels,v8 as transformConfigFiles,y0 as transformAndSaveTinkerData,c6 as toJsonStringified,d6 as toJson,p6 as toBunBuffer,hW as tinkergraphToNeptuneCsv,E8 as tinkerDataVertex,D8 as tinkerDataEdge,H1 as tinkerData,aW as throwInvalidQuery,iW as throwIfEmpty,N1 as recordsCreatedHandler,m8 as readCsvDir,LW as pgDateToJs,K1 as parseFile,o0 as msgpackToJsonIterator,a6 as msgpackToJson,N8 as mapTojsonReplacer,r0 as mapToJsonIterator,m as log,b8 as loadTinkerData,$$ as keys,kW as hashId,sW as groupByIdentity,H8 as go,j0 as getVertexLabel,v as getStore,DW as getLabel,k8 as getEdgeLabel,pW as getBaseOpts,g0 as g,i6 as fromBunBuffer,X1 as fnameToBname,D as extensionCodec,s0 as encoder,nW as elementProps,A0 as deepFreezeCopy,h as decoder,fW as csvToTinkergraph,y8 as csvToTinkerDataVertex,g8 as csvToTinkerDataEdge,I1 as csvToTinkerData,E as common,rW as combineProps,WZ as client,F1 as bnameTofname,Y8 as SET_EXT_TYPE,G8 as MSGPACK_HEADERS,t0 as MAP_EXT_TYPE,X0 as GroovyTraversalSource,T0 as GroovyTraversal,V0 as EDir};
